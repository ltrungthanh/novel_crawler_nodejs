import{NumberUtilities as t,assertNever as e}from"../platform/platform.js";import{UIUtils as i,Geometry as s,Widget as n,KeyboardShortcut as o,Context as r,ARIAUtils as a,Toolbar as l,Utils as h,Icon as d,GlassPane as c}from"../ui/ui.js";import{Color as u,Settings as p,Throttler as _,ObjectWrapper as m}from"../common/common.js";import{GetStylesheet as g,SetCSSProperty as f}from"../component_helpers/component_helpers.js";import{i18n as v}from"../i18n/i18n.js";import*as x from"../third_party/lit-html/lit-html.js";import{render as S,html as w,Directives as b}from"../third_party/lit-html/lit-html.js";import{TextUtils as y}from"../text_utils/text_utils.js";import{DOMModel as C,SDKModel as I,RuntimeModel as E}from"../sdk/sdk.js";import{CSSOverviewModel as P}from"../css_overview/css_overview.js";class T{constructor(t,e,i,s,n){this.width=t,this.height=e,this.marginTop=i,this.radius=s,this.linearLine=n}static drawVelocityChart(t,e,i){const s=k;let n=["M",0,s];const o=1/40;let r=t.evaluateAt(0);for(let e=o;e<1.025;e+=o){const o=t.evaluateAt(e);let a=(o.y-r.y)/(o.x-r.x);const l=r.x*(1-e)+o.x*e;a=Math.tanh(a/1.5),n=n.concat(["L",(l*i).toFixed(2),(s-a*s).toFixed(2)]),r=o}n=n.concat(["L",i.toFixed(2),s,"Z"]),e.setAttribute("d",n.join(" "))}curveWidth(){return this.width-2*this.radius}curveHeight(){return this.height-2*this.radius-2*this.marginTop}_drawLine(t,e,s,n,o,r){const a=i.createSVGChild(t,"line",e);a.setAttribute("x1",String(s+this.radius)),a.setAttribute("y1",String(n+this.radius+this.marginTop)),a.setAttribute("x2",String(o+this.radius)),a.setAttribute("y2",String(r+this.radius+this.marginTop))}_drawControlPoints(t,e,s,n,o){this._drawLine(t,"bezier-control-line",e,s,n,o);const r=i.createSVGChild(t,"circle","bezier-control-circle");r.setAttribute("cx",String(n+this.radius)),r.setAttribute("cy",String(o+this.radius+this.marginTop)),r.setAttribute("r",String(this.radius))}drawCurve(t,e){if(!t)return;const n=this.curveWidth(),o=this.curveHeight();e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),e.removeChildren();const r=i.createSVGChild(e,"g");this.linearLine&&this._drawLine(r,"linear-line",0,o,n,0);const a=i.createSVGChild(r,"path","bezier-path"),l=[new s.Point(t.controlPoints[0].x*n+this.radius,(1-t.controlPoints[0].y)*o+this.radius+this.marginTop),new s.Point(t.controlPoints[1].x*n+this.radius,(1-t.controlPoints[1].y)*o+this.radius+this.marginTop),new s.Point(n+this.radius,this.marginTop+this.radius)];a.setAttribute("d","M"+this.radius+","+(o+this.radius+this.marginTop)+" C"+l.join(" ")),this._drawControlPoints(r,0,o,t.controlPoints[0].x*n,(1-t.controlPoints[0].y)*o),this._drawControlPoints(r,n,0,t.controlPoints[1].x*n,(1-t.controlPoints[1].y)*o)}}const k=26;var z=Object.freeze({__proto__:null,BezierUI:T,Height:k});class L extends n.VBox{constructor(t){super(!0),this._bezier=t,this.registerRequiredCSS("inline_editor/bezierEditor.css",{enableLegacyPatching:!0}),this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this._previewElement=this.contentElement.createChild("div","bezier-preview-container"),this._previewElement.createChild("div","bezier-preview-animation"),this._previewElement.addEventListener("click",this._startPreviewAnimation.bind(this)),this._previewOnion=this.contentElement.createChild("div","bezier-preview-onion"),this._previewOnion.addEventListener("click",this._startPreviewAnimation.bind(this)),this._outerContainer=this.contentElement.createChild("div","bezier-container"),this._selectedCategory=null,this._presetsContainer=this._outerContainer.createChild("div","bezier-presets"),this._presetUI=new T(40,40,0,2,!1),this._presetCategories=[];for(let t=0;t<A.length;t++)this._presetCategories[t]=this._createCategory(A[t]),this._presetsContainer.appendChild(this._presetCategories[t].icon);this._curveUI=new T(150,250,50,7,!0),this._curve=i.createSVGChild(this._outerContainer,"svg","bezier-curve"),i.installDragHandle(this._curve,this._dragStart.bind(this),this._dragMove.bind(this),this._dragEnd.bind(this),"default"),this._header=this.contentElement.createChild("div","bezier-header");const e=this._createPresetModifyIcon(this._header,"bezier-preset-minus","M 12 6 L 8 10 L 12 14"),s=this._createPresetModifyIcon(this._header,"bezier-preset-plus","M 8 6 L 12 10 L 8 14");e.addEventListener("click",this._presetModifyClicked.bind(this,!1)),s.addEventListener("click",this._presetModifyClicked.bind(this,!0)),this._label=this._header.createChild("span","source-code bezier-display-value")}setBezier(t){t&&(this._bezier=t,this._updateUI())}bezier(){return this._bezier}wasShown(){this._unselectPresets();for(const t of this._presetCategories)for(let e=0;e<t.presets.length;e++)this._bezier.asCSSText()===t.presets[e].value&&(t.presetIndex=e,this._presetCategorySelected(t));this._updateUI(),this._startPreviewAnimation()}_onchange(){this._updateUI(),this.dispatchEventToListeners(M.BezierChanged,this._bezier.asCSSText())}_updateUI(){const t=this._selectedCategory?this._selectedCategory.presets[this._selectedCategory.presetIndex].name:this._bezier.asCSSText().replace(/\s(-\d\.\d)/g,"$1");this._label.textContent=t,this._curveUI.drawCurve(this._bezier,this._curve),this._previewOnion.removeChildren()}_dragStart(e){this._mouseDownPosition=new s.Point(e.x,e.y);const i=this._curveUI;this._controlPosition=new s.Point(t.clamp((e.offsetX-i.radius)/i.curveWidth(),0,1),(i.curveHeight()+i.marginTop+i.radius-e.offsetY)/i.curveHeight());const n=this._controlPosition.distanceTo(this._bezier.controlPoints[0])<this._controlPosition.distanceTo(this._bezier.controlPoints[1]);return this._selectedPoint=n?0:1,this._bezier.controlPoints[this._selectedPoint]=this._controlPosition,this._unselectPresets(),this._onchange(),e.consume(!0),!0}_updateControlPosition(e,i){if(void 0===this._mouseDownPosition||void 0===this._controlPosition||void 0===this._selectedPoint)return;const n=(e-this._mouseDownPosition.x)/this._curveUI.curveWidth(),o=(i-this._mouseDownPosition.y)/this._curveUI.curveHeight(),r=new s.Point(t.clamp(this._controlPosition.x+n,0,1),this._controlPosition.y-o);this._bezier.controlPoints[this._selectedPoint]=r}_dragMove(t){this._updateControlPosition(t.x,t.y),this._onchange()}_dragEnd(t){this._updateControlPosition(t.x,t.y),this._onchange(),this._startPreviewAnimation()}_createCategory(t){const e=document.createElement("div");e.classList.add("bezier-preset-category");const n=i.createSVGChild(e,"svg","bezier-preset monospace"),o={presets:t,presetIndex:0,icon:e};return this._presetUI.drawCurve(s.CubicBezier.parse(o.presets[0].value),n),n.addEventListener("click",this._presetCategorySelected.bind(this,o)),o}_createPresetModifyIcon(t,e,s){const n=i.createSVGChild(t,"svg","bezier-preset-modify "+e);n.setAttribute("width","20"),n.setAttribute("height","20");return i.createSVGChild(n,"path").setAttribute("d",s),n}_unselectPresets(){for(const t of this._presetCategories)t.icon.classList.remove("bezier-preset-selected");this._selectedCategory=null,this._header.classList.remove("bezier-header-active")}_presetCategorySelected(t,e){if(this._selectedCategory===t)return;this._unselectPresets(),this._header.classList.add("bezier-header-active"),this._selectedCategory=t,this._selectedCategory.icon.classList.add("bezier-preset-selected");const i=s.CubicBezier.parse(t.presets[t.presetIndex].value);i&&(this.setBezier(i),this._onchange(),this._startPreviewAnimation()),e&&e.consume(!0)}_presetModifyClicked(t,e){if(null===this._selectedCategory)return;const i=this._selectedCategory.presets.length;this._selectedCategory.presetIndex=(this._selectedCategory.presetIndex+(t?1:-1)+i)%i;const n=s.CubicBezier.parse(this._selectedCategory.presets[this._selectedCategory.presetIndex].value);n&&(this.setBezier(n),this._onchange(),this._startPreviewAnimation())}_startPreviewAnimation(){this._previewAnimation&&this._previewAnimation.cancel();const t=1600,e=[{offset:0,transform:"translateX(0px)",easing:this._bezier.asCSSText(),opacity:1},{offset:.9,transform:"translateX(218px)",opacity:1},{offset:1,transform:"translateX(218px)",opacity:0}];this._previewAnimation=this._previewElement.animate(e,t),this._previewOnion.removeChildren();for(let e=0;e<=20;e++){const i=this._previewOnion.createChild("div","bezier-preview-animation").animate([{transform:"translateX(0px)",easing:this._bezier.asCSSText()},{transform:"translateX(218px)"}],{duration:t,fill:"forwards"});i.pause(),i.currentTime=t*e/20}}}const M={BezierChanged:Symbol("BezierChanged")},A=[[{name:"ease-in-out",value:"ease-in-out"},{name:"In Out · Sine",value:"cubic-bezier(0.45, 0.05, 0.55, 0.95)"},{name:"In Out · Quadratic",value:"cubic-bezier(0.46, 0.03, 0.52, 0.96)"},{name:"In Out · Cubic",value:"cubic-bezier(0.65, 0.05, 0.36, 1)"},{name:"Fast Out, Slow In",value:"cubic-bezier(0.4, 0, 0.2, 1)"},{name:"In Out · Back",value:"cubic-bezier(0.68, -0.55, 0.27, 1.55)"}],[{name:"Fast Out, Linear In",value:"cubic-bezier(0.4, 0, 1, 1)"},{name:"ease-in",value:"ease-in"},{name:"In · Sine",value:"cubic-bezier(0.47, 0, 0.75, 0.72)"},{name:"In · Quadratic",value:"cubic-bezier(0.55, 0.09, 0.68, 0.53)"},{name:"In · Cubic",value:"cubic-bezier(0.55, 0.06, 0.68, 0.19)"},{name:"In · Back",value:"cubic-bezier(0.6, -0.28, 0.74, 0.05)"}],[{name:"ease-out",value:"ease-out"},{name:"Out · Sine",value:"cubic-bezier(0.39, 0.58, 0.57, 1)"},{name:"Out · Quadratic",value:"cubic-bezier(0.25, 0.46, 0.45, 0.94)"},{name:"Out · Cubic",value:"cubic-bezier(0.22, 0.61, 0.36, 1)"},{name:"Linear Out, Slow In",value:"cubic-bezier(0, 0, 0.2, 1)"},{name:"Out · Back",value:"cubic-bezier(0.18, 0.89, 0.32, 1.28)"}]];var F=Object.freeze({__proto__:null,BezierEditor:L,Events:M,Presets:A,PresetCategory:undefined});const B={shiftclickToChangeColorFormat:"Shift-click to change color format"},O=v.registerUIStrings("inline_editor/ColorSwatch.ts",B),R=v.getLocalizedString.bind(void 0,O),U=g.getStyleSheets;class V extends Event{constructor(t,e){super("format-changed",{}),this.data={format:t,text:e}}}class H extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.tooltip=R(B.shiftclickToChangeColorFormat),this.text=null,this._color=null,this._format=null,this.shadow.adoptedStyleSheets=[...U("inline_editor/colorSwatch.css",{enableLegacyPatching:!1})]}static isColorSwatch(t){return"devtools-color-swatch"===t.localName}get color(){return this._color}get format(){return this._format}get anchorBox(){const t=this.shadow.querySelector(".color-swatch");return t?t.boxInWindow():null}renderColor(t,e,i){if("string"==typeof t){if(this._color=u.Color.parse(t),this.text=t,!this._color)return void this.renderTextOnly()}else this._color=t;this._format="boolean"==typeof e&&e?p.detectColorFormat(this._color):"string"==typeof e?e:this._color.format(),this.text=this._color.asString(this._format),i&&(this.tooltip=i),this.render()}renderTextOnly(){S(this.text,this.shadow,{eventContext:this})}render(){S(w`<span class="color-swatch" title="${this.tooltip}"><span class="color-swatch-inner"
        style="background-color: ${this.text};"
        @click=${this.onClick}
        @mousedown=${this.consume}
        @dblclick=${this.consume}></span></span><slot><span>${this.text}</span></slot>`,this.shadow,{eventContext:this})}onClick(t){t.stopPropagation(),t.shiftKey?this.toggleNextFormat():this.dispatchEvent(new Event("swatch-click"))}consume(t){t.stopPropagation()}toggleNextFormat(){if(!this._color||!this._format)return;let t;do{this._format=N(this._color,this._format),t=this._color.asString(this._format)}while(t===this.text);t&&(this.text=t,this.render(),this.dispatchEvent(new V(this._format,this.text)))}}function N(t,e){const i=u.Format;switch(e){case i.Original:return t.hasAlpha()?i.RGBA:i.RGB;case i.RGB:case i.RGBA:return t.hasAlpha()?i.HSLA:i.HSL;case i.HSL:case i.HSLA:return t.nickname()?i.Nickname:t.detectHEXFormat();case i.ShortHEX:return i.HEX;case i.ShortHEXA:return i.HEXA;case i.HEXA:case i.HEX:return i.Original;case i.Nickname:return t.detectHEXFormat();default:return i.RGBA}}customElements.get("devtools-color-swatch")||customElements.define("devtools-color-swatch",H);var X=Object.freeze({__proto__:null,UIStrings:B,FormatChangedEvent:V,ColorSwatch:H});const D=/(?<value>[+-]?\d*\.?\d+)(?<unit>deg|grad|rad|turn)/,$=t=>{const e=t.match(D);return e&&e.groups?{value:Number(e.groups.value),unit:e.groups.unit}:null},j=(t,e)=>{let i=t;switch(e){case"grad":i=s.radiansToGradians(t);break;case"deg":i=s.radiansToDegrees(t);break;case"turn":i=s.radiansToTurns(t)}return{value:i,unit:e}},Y=t=>{switch(t.unit){case"deg":return s.degreesToRadians(t.value);case"grad":return s.gradiansToRadians(t.value);case"turn":return s.turnsToRadians(t.value)}return t.value},G=(t,e)=>{const i=Y(t);return{translateX:Math.sin(i)*e,translateY:-Math.cos(i)*e}},K=t=>{let i=t.value;switch(t.unit){case"deg":case"grad":i=Math.round(t.value);break;case"rad":i=Math.round(1e4*t.value)/1e4;break;case"turn":i=Math.round(100*t.value)/100;break;default:e(t.unit,"Unknown angle unit: "+t.unit)}return{value:i,unit:t.unit}},W=t=>{switch(t){case"deg":return"grad";case"grad":return"rad";case"rad":return"turn";default:return"deg"}},q=(t,e)=>{if(t.unit===e)return t;const i=Y(t);return j(i,e)},Z=(t,e)=>{const s=i.getValueModificationDirection(e);if(null===s)return;let n="Up"===s?Math.PI/180:-Math.PI/180;e.shiftKey&&(n*=10);const o=Y(t);return j(o+n,t.unit)};var Q=Object.freeze({__proto__:null,CSSAngleRegex:D,parseText:$,getAngleFromRadians:j,getRadiansFromAngle:Y,get2DTranslationsForAngle:G,roundAngleByUnit:K,getNextUnit:W,convertAngleUnit:q,getNewAngleFromEvent:Z});const{render:J,html:tt}=x,et=b.styleMap;class it extends HTMLElement{constructor(){super(...arguments),this.shadow=this.attachShadow({mode:"open"}),this.angle={value:0,unit:"rad"},this.background="",this.clockRadius=38.5,this.mousemoveThrottler=new _.Throttler(16.67)}connectedCallback(){f.set(this,"--clock-dial-length","6px")}set data(t){this.angle=t.angle,this.onAngleUpdate=t.onAngleUpdate,this.background=t.background,this.render()}updateAngleFromMousePosition(t,e,i){const s=this.shadow.querySelector(".clock");if(!s||!this.onAngleUpdate)return;const{top:n,right:o,bottom:r,left:a}=s.getBoundingClientRect();this.clockRadius=(o-a)/2;const l=(a+o)/2,h=(r+n)/2,d=-Math.atan2(t-l,e-h)+Math.PI;if(i){const t=Y({value:15,unit:"deg"}),e=Math.round(d/t)*t;this.onAngleUpdate(j(e,this.angle.unit))}else this.onAngleUpdate(j(d,this.angle.unit))}onEditorMousedown(t){t.stopPropagation(),this.updateAngleFromMousePosition(t.pageX,t.pageY,t.shiftKey)}onEditorMousemove(t){1===t.buttons&&this.mousemoveThrottler.schedule((()=>(this.updateAngleFromMousePosition(t.pageX,t.pageY,t.shiftKey),Promise.resolve())))}onEditorWheel(t){if(!this.onAngleUpdate)return;const e=Z(this.angle,t);e&&this.onAngleUpdate(e),t.preventDefault()}render(){const t={background:this.background},{translateX:e,translateY:i}=G(this.angle,this.clockRadius/2),s={transform:`translate(${e}px, ${i}px) rotate(${this.angle.value}${this.angle.unit})`};J(tt`
      <style>
        .clock,
        .pointer,
        .center,
        .hand,
        .dial {
          position: absolute;
        }

        .clock {
          top: 6px;
          width: 6em;
          height: 6em;
          background-color: var(--color-background);
          border: 0.5em solid var(--border-color);
          border-radius: 9em;
          box-shadow: var(--drop-shadow), inset 0 0 15px hsl(0deg 0% 0% / 25%);
          transform: translateX(-3em);
        }

        .center,
        .hand {
          box-shadow: 0 0 2px hsl(0deg 0% 0% / 20%);
        }

        .pointer {
          margin: auto;
          top: 0;
          left: -0.4em;
          right: 0;
          width: 0;
          height: 0;
          border-style: solid;
          border-width: 0 0.9em 0.9em 0.9em;
          border-color: transparent transparent var(--border-color) transparent;
        }

        .center,
        .hand,
        .dial {
          margin: auto;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
        }

        .center {
          width: 0.7em;
          height: 0.7em;
          border-radius: 10px;
        }

        .dial {
          width: 2px;
          height: var(--clock-dial-length);
          background-color: var(--dial-color);
          border-radius: 1px;
        }

        .hand {
          height: 50%;
          width: 0.3em;
          background: var(--accent-fg-color);
        }

        .hand::before {
          content: '';
          display: inline-block;
          position: absolute;
          top: -0.6em;
          left: -0.35em;
          width: 1em;
          height: 1em;
          border-radius: 1em;
          cursor: pointer;
          box-shadow: 0 0 5px hsl(0deg 0% 0% / 30%);
        }

        .hand::before,
        .center {
          background-color: var(--accent-fg-color);
        }

        :host-context(.-theme-with-dark-background) .hand::before {
          box-shadow: 0 0 5px hsl(0deg 0% 0% / 80%);
        }

        :host-context(.-theme-with-dark-background) .center,
        :host-context(.-theme-with-dark-background) .hand {
          box-shadow: 0 0 2px hsl(0deg 0% 0% / 60%);
        }

        :host-context(.-theme-with-dark-background) .clock {
          background-color: hsl(225deg 5% 27%);
        }
      </style>

      <div class="editor">
        <span class="pointer"></span>
        <div
          class="clock"
          style=${et(t)}
          @mousedown=${this.onEditorMousedown}
          @mousemove=${this.onEditorMousemove}
          @wheel=${this.onEditorWheel}>
          ${this.renderDials()}
          <div class="hand" style=${et(s)}></div>
          <span class="center"></span>
        </div>
      </div>
    `,this.shadow,{eventContext:this})}renderDials(){return this.dialTemplates||(this.dialTemplates=[0,45,90,135,180,225,270,315].map((t=>{const e=this.clockRadius-6-3,{translateX:i,translateY:s}=G({value:t,unit:"deg"},e);return tt`<span class="dial" style=${et({transform:`translate(${i}px, ${s}px) rotate(${t}deg)`})}></span>`}))),this.dialTemplates}}customElements.get("devtools-css-angle-editor")||customElements.define("devtools-css-angle-editor",it);const{render:st,html:nt}=x,ot=b.styleMap;class rt extends HTMLElement{constructor(){super(...arguments),this.shadow=this.attachShadow({mode:"open"}),this.angle={value:0,unit:"rad"}}set data(t){this.angle=t.angle,this.render()}render(){const{translateX:t,translateY:e}=G(this.angle,2.75),i={transform:`translate(${t}px, ${e}px) rotate(${this.angle.value}${this.angle.unit})`};st(nt`
      <style>
        .swatch {
          position: relative;
          display: inline-block;
          margin-bottom: -2px;
          width: 1em;
          height: 1em;
          border: 1px solid var(--selection-inactive-fg-color);
          border-radius: 1em;
          overflow: hidden;
          cursor: pointer;
          background-color: var(--toolbar-bg-color);
        }

        .mini-hand {
          position: absolute;
          margin: auto;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          height: 55%;
          width: 2px;
          background-color: var(--accent-fg-color);
          border-radius: 5px;
        }
      </style>

      <div class="swatch">
        <span class="mini-hand" style=${ot(i)}></span>
      </div>
    `,this.shadow,{eventContext:this})}}customElements.get("devtools-css-angle-swatch")||customElements.define("devtools-css-angle-swatch",rt);const{render:at,html:lt}=x,ht=b.styleMap,dt=new Set(["color","background","background-color"]);class ct extends Event{constructor(t){super("popover-toggled",{}),this.data={open:t}}}class ut extends Event{constructor(t){super("value-changed",{}),this.data={value:t}}}class pt extends Event{constructor(t){super("unit-changed",{}),this.data={value:t}}}const _t={value:0,unit:"rad"};class mt extends HTMLElement{constructor(){super(...arguments),this.shadow=this.attachShadow({mode:"open"}),this.angle=_t,this.displayedAngle=_t,this.propertyName="",this.propertyValue="",this.angleElement=null,this.swatchElement=null,this.popoverOpen=!1,this.popoverStyleTop="",this.onMinifyingAction=this.minify.bind(this),this.onAngleUpdate=this.updateAngle.bind(this)}set data(t){const e=$(t.angleText);e&&(this.angle=e,this.displayedAngle={...e},this.propertyName=t.propertyName,this.propertyValue=t.propertyValue,this.containingPane=t.containingPane,this.render())}disconnectedCallback(){this.unbindMinifyingAction()}popover(){if(!this.containingPane)return;if(this.angleElement||(this.angleElement=this.shadow.querySelector(".css-angle")),this.swatchElement||(this.swatchElement=this.shadow.querySelector("devtools-css-angle-swatch")),!this.angleElement||!this.swatchElement)return;this.dispatchEvent(new ct(!0)),this.bindMinifyingAction();const t=this.swatchElement.getBoundingClientRect().bottom;if(t){const e=this.containingPane.getBoundingClientRect().top;this.popoverStyleTop=t-e+"px"}this.popoverOpen=!0,this.render(),this.angleElement.focus()}minify(){!1!==this.popoverOpen&&(this.popoverOpen=!1,this.dispatchEvent(new ct(!1)),this.unbindMinifyingAction(),this.render())}updateProperty(t,e){this.propertyName=t,this.propertyValue=e,this.render()}updateAngle(t){this.displayedAngle=K(q(t,this.displayedAngle.unit)),this.angle=this.displayedAngle,this.dispatchEvent(new ut(`${this.angle.value}${this.angle.unit}`))}displayNextUnit(){const t=W(this.displayedAngle.unit);this.displayedAngle=K(q(this.angle,t)),this.dispatchEvent(new pt(`${this.displayedAngle.value}${this.displayedAngle.unit}`))}bindMinifyingAction(){document.addEventListener("mousedown",this.onMinifyingAction),this.containingPane&&this.containingPane.addEventListener("scroll",this.onMinifyingAction)}unbindMinifyingAction(){document.removeEventListener("mousedown",this.onMinifyingAction),this.containingPane&&this.containingPane.removeEventListener("scroll",this.onMinifyingAction)}onMiniIconClick(t){t.stopPropagation(),!t.shiftKey||this.popoverOpen?this.popoverOpen?this.minify():this.popover():this.displayNextUnit()}consume(t){t.stopPropagation()}onKeydown(t){if(this.popoverOpen)switch(t.key){case"Escape":t.stopPropagation(),this.minify(),this.blur();break;case"ArrowUp":case"ArrowDown":{const e=Z(this.angle,t);e&&this.updateAngle(e),t.preventDefault();break}}}render(){at(lt`
      <style>
        .css-angle {
          display: inline-block;
          position: relative;
          outline: none;
        }

        devtools-css-angle-swatch {
          display: inline-block;
          margin-right: 2px;
          user-select: none;
        }

        devtools-css-angle-editor {
          --dial-color: #a3a3a3;
          --border-color: var(--toolbar-bg-color);

          position: fixed;
          z-index: 2;
        }
      </style>

      <div class="css-angle" @keydown=${this.onKeydown} tabindex="-1">
        <div class="preview">
          <devtools-css-angle-swatch
            @click=${this.onMiniIconClick}
            @mousedown=${this.consume}
            @dblclick=${this.consume}
            .data=${{angle:this.angle}}>
          </devtools-css-angle-swatch><slot></slot>
        </div>
        ${this.popoverOpen?this.renderPopover():null}
      </div>
    `,this.shadow,{eventContext:this})}renderPopover(){let t="";return dt.has(this.propertyName)&&!this.propertyValue.match(/url\(.*\)/i)&&(t=this.propertyValue),lt`
    <devtools-css-angle-editor
      class="popover popover-css-angle"
      style=${ht({top:this.popoverStyleTop})}
      .data=${{angle:this.angle,onAngleUpdate:this.onAngleUpdate,background:t}}
    ></devtools-css-angle-editor>
    `}}customElements.get("devtools-css-angle")||customElements.define("devtools-css-angle",mt);var gt=Object.freeze({__proto__:null,PopoverToggledEvent:ct,ValueChangedEvent:ut,UnitChangedEvent:pt,CSSAngle:mt});class ft{constructor(t){this._isBoxShadow=t,this._inset=!1,this._offsetX=xt.zero(),this._offsetY=xt.zero(),this._blurRadius=xt.zero(),this._spreadRadius=xt.zero(),this._color=u.Color.parse("black"),this._format=[vt.OffsetX,vt.OffsetY],this._important=!1}static parseTextShadow(t){return ft._parseShadow(t,!1)}static parseBoxShadow(t){return ft._parseShadow(t,!0)}static _parseShadow(t,e){const i=[],s=y.Utils.splitStringByRegexes(t,[u.Regex,/,/g]);let n=0;for(let e=0;e<s.length;e++)if(1===s[e].regexIndex){const o=s[e];i.push(t.substring(n,o.position)),n=o.position+1}i.push(t.substring(n,t.length));const o=[];for(let t=0;t<i.length;t++){const s=new ft(e);s._format=[];let n=!0;const a=[/!important/gi,/inset/gi,u.Regex,xt.Regex],l=y.Utils.splitStringByRegexes(i[t],a);for(let t=0;t<l.length;t++){const e=l[t];if(-1===e.regexIndex){if(/\S/.test(e.value))return[];n=!0}else{if(!n)return[];if(n=!1,0===e.regexIndex)s._important=!0,s._format.push(vt.Important);else if(1===e.regexIndex)s._inset=!0,s._format.push(vt.Inset);else if(2===e.regexIndex){const t=u.Color.parse(e.value);if(!t)return[];s._color=t,s._format.push(vt.Color)}else if(3===e.regexIndex){const t=xt.parse(e.value);if(!t)return[];const i=s._format.length>0?s._format[s._format.length-1]:"";i===vt.OffsetX?(s._offsetY=t,s._format.push(vt.OffsetY)):i===vt.OffsetY?(s._blurRadius=t,s._format.push(vt.BlurRadius)):i===vt.BlurRadius?(s._spreadRadius=t,s._format.push(vt.SpreadRadius)):(s._offsetX=t,s._format.push(vt.OffsetX))}}}if(r(s,vt.OffsetX,1,1)||r(s,vt.OffsetY,1,1)||r(s,vt.Color,0,1)||r(s,vt.BlurRadius,0,1)||r(s,vt.Inset,0,e?1:0)||r(s,vt.SpreadRadius,0,e?1:0)||r(s,vt.Important,0,1))return[];o.push(s)}return o;function r(t,e,i,s){let n=0;for(let i=0;i<t._format.length;i++)t._format[i]===e&&n++;return n<i||n>s}}setInset(t){this._inset=t,-1===this._format.indexOf(vt.Inset)&&this._format.unshift(vt.Inset)}setOffsetX(t){this._offsetX=t}setOffsetY(t){this._offsetY=t}setBlurRadius(t){if(this._blurRadius=t,-1===this._format.indexOf(vt.BlurRadius)){const t=this._format.indexOf(vt.OffsetY);this._format.splice(t+1,0,vt.BlurRadius)}}setSpreadRadius(t){if(this._spreadRadius=t,-1===this._format.indexOf(vt.SpreadRadius)){this.setBlurRadius(this._blurRadius);const t=this._format.indexOf(vt.BlurRadius);this._format.splice(t+1,0,vt.SpreadRadius)}}setColor(t){this._color=t,-1===this._format.indexOf(vt.Color)&&this._format.push(vt.Color)}isBoxShadow(){return this._isBoxShadow}inset(){return this._inset}offsetX(){return this._offsetX}offsetY(){return this._offsetY}blurRadius(){return this._blurRadius}spreadRadius(){return this._spreadRadius}color(){return this._color}asCSSText(){const t=[];for(let e=0;e<this._format.length;e++){const i=this._format[e];i===vt.Inset&&this._inset?t.push("inset"):i===vt.OffsetX?t.push(this._offsetX.asCSSText()):i===vt.OffsetY?t.push(this._offsetY.asCSSText()):i===vt.BlurRadius?t.push(this._blurRadius.asCSSText()):i===vt.SpreadRadius?t.push(this._spreadRadius.asCSSText()):i===vt.Color?t.push(this._color.asString(this._color.format())):i===vt.Important&&this._important&&t.push("!important")}return t.join(" ")}}const vt={Inset:"I",OffsetX:"X",OffsetY:"Y",BlurRadius:"B",SpreadRadius:"S",Color:"C",Important:"M"};class xt{constructor(t,e){this.amount=t,this.unit=e}static parse(t){const e=new RegExp("^(?:"+xt.Regex.source+")$","i"),i=t.match(e);return i?i.length>2&&i[2]?new xt(parseFloat(i[1]),i[2]):xt.zero():null}static zero(){return new xt(0,"")}asCSSText(){return this.amount+this.unit}}xt.Regex=new RegExp("([+-]?(?:[0-9]*[.])?[0-9]+(?:[eE][+-]?[0-9]+)?)(ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmax|vmin|vw)|[+-]?(?:0*[.])?0+(?:[eE][+-]?[0-9]+)?","gi");var St=Object.freeze({__proto__:null,CSSShadowModel:ft,_Part:vt,CSSLength:xt});const wt={type:"Type",outset:"Outset",inset:"Inset",xOffset:"X offset",yOffset:"Y offset",blur:"Blur",spread:"Spread"},bt=v.registerUIStrings("inline_editor/CSSShadowEditor.js",wt),yt=v.getLocalizedString.bind(void 0,bt);class Ct extends n.VBox{constructor(){super(!0),this.registerRequiredCSS("inline_editor/cssShadowEditor.css",{enableLegacyPatching:!0}),this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this._typeField=this.contentElement.createChild("div","shadow-editor-field shadow-editor-flex-field"),this._typeField.createChild("label","shadow-editor-label").textContent=yt(wt.type),this._outsetButton=this._typeField.createChild("button","shadow-editor-button-left"),this._outsetButton.textContent=yt(wt.outset),this._outsetButton.addEventListener("click",this._onButtonClick.bind(this),!1),this._insetButton=this._typeField.createChild("button","shadow-editor-button-right"),this._insetButton.textContent=yt(wt.inset),this._insetButton.addEventListener("click",this._onButtonClick.bind(this),!1);const t=this.contentElement.createChild("div","shadow-editor-field");this._xInput=this._createTextInput(t,yt(wt.xOffset));const e=this.contentElement.createChild("div","shadow-editor-field");this._yInput=this._createTextInput(e,yt(wt.yOffset)),this._xySlider=t.createChild("canvas","shadow-editor-2D-slider"),this._xySlider.width=88,this._xySlider.height=88,this._xySlider.tabIndex=-1,this._halfCanvasSize=44,this._innerCanvasSize=this._halfCanvasSize-6,i.installDragHandle(this._xySlider,this._dragStart.bind(this),this._dragMove.bind(this),null,"default"),this._xySlider.addEventListener("keydown",this._onCanvasArrowKey.bind(this),!1),this._xySlider.addEventListener("blur",this._onCanvasBlur.bind(this),!1);const s=this.contentElement.createChild("div","shadow-editor-field shadow-editor-flex-field shadow-editor-blur-field");this._blurInput=this._createTextInput(s,yt(wt.blur)),this._blurSlider=this._createSlider(s),this._spreadField=this.contentElement.createChild("div","shadow-editor-field shadow-editor-flex-field"),this._spreadInput=this._createTextInput(this._spreadField,yt(wt.spread)),this._spreadSlider=this._createSlider(this._spreadField),this._model,this._canvasOrigin}_createTextInput(t,e){const s=t.createChild("label","shadow-editor-label");s.textContent=e,s.setAttribute("for",e);const n=i.createInput("shadow-editor-text-input","text");return t.appendChild(n),n.id=e,n.addEventListener("keydown",this._handleValueModification.bind(this),!1),n.addEventListener("mousewheel",this._handleValueModification.bind(this),!1),n.addEventListener("input",this._onTextInput.bind(this),!1),n.addEventListener("blur",this._onTextBlur.bind(this),!1),n}_createSlider(t){const e=i.createSlider(0,20,-1);return e.addEventListener("input",this._onSliderInput.bind(this),!1),t.appendChild(e),e}wasShown(){this._updateUI()}setModel(t){this._model=t,this._typeField.classList.toggle("hidden",!t.isBoxShadow()),this._spreadField.classList.toggle("hidden",!t.isBoxShadow()),this._updateUI()}_updateUI(){this._updateButtons(),this._xInput.value=this._model.offsetX().asCSSText(),this._yInput.value=this._model.offsetY().asCSSText(),this._blurInput.value=this._model.blurRadius().asCSSText(),this._spreadInput.value=this._model.spreadRadius().asCSSText(),this._blurSlider.value=this._model.blurRadius().amount.toString(),this._spreadSlider.value=this._model.spreadRadius().amount.toString(),this._updateCanvas(!1)}_updateButtons(){this._insetButton.classList.toggle("enabled",this._model.inset()),this._outsetButton.classList.toggle("enabled",!this._model.inset())}_updateCanvas(t){const e=this._xySlider.getContext("2d");if(!e)throw new Error("Unable to obtain canvas context");e.clearRect(0,0,this._xySlider.width,this._xySlider.height),e.save(),e.setLineDash([1,1]),e.strokeStyle="rgba(210, 210, 210, 0.8)",e.beginPath(),e.moveTo(this._halfCanvasSize,0),e.lineTo(this._halfCanvasSize,88),e.moveTo(0,this._halfCanvasSize),e.lineTo(88,this._halfCanvasSize),e.stroke(),e.restore();const i=this._sliderThumbPosition();e.save(),e.translate(this._halfCanvasSize,this._halfCanvasSize),e.lineWidth=2,e.strokeStyle="rgba(130, 130, 130, 0.75)",e.beginPath(),e.moveTo(0,0),e.lineTo(i.x,i.y),e.stroke(),t&&(e.beginPath(),e.fillStyle="rgba(66, 133, 244, 0.4)",e.arc(i.x,i.y,8,0,2*Math.PI),e.fill()),e.beginPath(),e.fillStyle="#4285F4",e.arc(i.x,i.y,6,0,2*Math.PI),e.fill(),e.restore()}_onButtonClick(t){const e=t.currentTarget===this._insetButton;e&&this._model.inset()||!e&&!this._model.inset()||(this._model.setInset(e),this._updateButtons(),this.dispatchEventToListeners(It.ShadowChanged,this._model))}_handleValueModification(t){const e=t.currentTarget,s=i.createReplacementString(e.value,t,(function(t,e,i){i.length||(i="px");return t+e+i}));if(!s)return;const n=xt.parse(s);n&&(t.currentTarget===this._blurInput&&n.amount<0&&(n.amount=0),e.value=n.asCSSText(),e.selectionStart=0,e.selectionEnd=e.value.length,this._onTextInput(t),t.consume(!0))}_onTextInput(t){const e=t.currentTarget;this._changedElement=e,this._changedElement.classList.remove("invalid");const i=xt.parse(e.value);!i||e===this._blurInput&&i.amount<0||(e===this._xInput?(this._model.setOffsetX(i),this._updateCanvas(!1)):e===this._yInput?(this._model.setOffsetY(i),this._updateCanvas(!1)):e===this._blurInput?(this._model.setBlurRadius(i),this._blurSlider.value=i.amount.toString()):e===this._spreadInput&&(this._model.setSpreadRadius(i),this._spreadSlider.value=i.amount.toString()),this.dispatchEventToListeners(It.ShadowChanged,this._model))}_onTextBlur(){if(!this._changedElement)return;let t=this._changedElement.value.trim()?xt.parse(this._changedElement.value):xt.zero();if(t||(t=xt.parse(this._changedElement.value+"px")),!t)return this._changedElement.classList.add("invalid"),void(this._changedElement=null);this._changedElement===this._xInput?(this._model.setOffsetX(t),this._xInput.value=t.asCSSText(),this._updateCanvas(!1)):this._changedElement===this._yInput?(this._model.setOffsetY(t),this._yInput.value=t.asCSSText(),this._updateCanvas(!1)):this._changedElement===this._blurInput?(t.amount<0&&(t=xt.zero()),this._model.setBlurRadius(t),this._blurInput.value=t.asCSSText(),this._blurSlider.value=t.amount.toString()):this._changedElement===this._spreadInput&&(this._model.setSpreadRadius(t),this._spreadInput.value=t.asCSSText(),this._spreadSlider.value=t.amount.toString()),this._changedElement=null,this.dispatchEventToListeners(It.ShadowChanged,this._model)}_onSliderInput(t){t.currentTarget===this._blurSlider?(this._model.setBlurRadius(new xt(Number(this._blurSlider.value),this._model.blurRadius().unit||"px")),this._blurInput.value=this._model.blurRadius().asCSSText(),this._blurInput.classList.remove("invalid")):t.currentTarget===this._spreadSlider&&(this._model.setSpreadRadius(new xt(Number(this._spreadSlider.value),this._model.spreadRadius().unit||"px")),this._spreadInput.value=this._model.spreadRadius().asCSSText(),this._spreadInput.classList.remove("invalid")),this.dispatchEventToListeners(It.ShadowChanged,this._model)}_dragStart(t){this._xySlider.focus(),this._updateCanvas(!0),this._canvasOrigin=new s.Point(this._xySlider.totalOffsetLeft()+this._halfCanvasSize,this._xySlider.totalOffsetTop()+this._halfCanvasSize);const e=new s.Point(t.x-this._canvasOrigin.x,t.y-this._canvasOrigin.y),i=this._sliderThumbPosition();return e.distanceTo(i)>=6&&this._dragMove(t),!0}_dragMove(t){let e=new s.Point(t.x-this._canvasOrigin.x,t.y-this._canvasOrigin.y);t.shiftKey&&(e=this._snapToClosestDirection(e));const i=this._constrainPoint(e,this._innerCanvasSize),n=Math.round(i.x/this._innerCanvasSize*20),r=Math.round(i.y/this._innerCanvasSize*20);t.shiftKey?(this._model.setOffsetX(new xt(n,this._model.offsetX().unit||"px")),this._model.setOffsetY(new xt(r,this._model.offsetY().unit||"px"))):(t.altKey||this._model.setOffsetX(new xt(n,this._model.offsetX().unit||"px")),o.KeyboardShortcut.eventHasCtrlOrMeta(t)||this._model.setOffsetY(new xt(r,this._model.offsetY().unit||"px"))),this._xInput.value=this._model.offsetX().asCSSText(),this._yInput.value=this._model.offsetY().asCSSText(),this._xInput.classList.remove("invalid"),this._yInput.classList.remove("invalid"),this._updateCanvas(!0),this.dispatchEventToListeners(It.ShadowChanged,this._model)}_onCanvasBlur(){this._updateCanvas(!1)}_onCanvasArrowKey(e){const i=e;let s=0,n=0;if("ArrowRight"===i.key?s=1:"ArrowLeft"===i.key?s=-1:"ArrowUp"===i.key?n=-1:"ArrowDown"===i.key&&(n=1),s||n){if(e.consume(!0),s){const e=this._model.offsetX(),i=t.clamp(e.amount+s,-20,20);if(i===e.amount)return;this._model.setOffsetX(new xt(i,e.unit||"px")),this._xInput.value=this._model.offsetX().asCSSText(),this._xInput.classList.remove("invalid")}if(n){const e=this._model.offsetY(),i=t.clamp(e.amount+n,-20,20);if(i===e.amount)return;this._model.setOffsetY(new xt(i,e.unit||"px")),this._yInput.value=this._model.offsetY().asCSSText(),this._yInput.classList.remove("invalid")}this._updateCanvas(!0),this.dispatchEventToListeners(It.ShadowChanged,this._model)}}_constrainPoint(t,e){return Math.abs(t.x)<=e&&Math.abs(t.y)<=e?new s.Point(t.x,t.y):t.scale(e/Math.max(Math.abs(t.x),Math.abs(t.y)))}_snapToClosestDirection(t){let e=Number.MAX_VALUE,i=t;const n=[new s.Point(0,-1),new s.Point(1,-1),new s.Point(1,0),new s.Point(1,1)];for(const s of n){const n=t.projectOn(s),o=t.distanceTo(n);o<e&&(e=o,i=n)}return i}_sliderThumbPosition(){const t=this._model.offsetX().amount/20*this._innerCanvasSize,e=this._model.offsetY().amount/20*this._innerCanvasSize;return this._constrainPoint(new s.Point(t,e),this._innerCanvasSize)}}const It={ShadowChanged:Symbol("ShadowChanged")};var Et=Object.freeze({__proto__:null,UIStrings:wt,CSSShadowEditor:Ct,Events:It});const Pt={jumpToDefinition:"Jump to definition",sIsNotDefined:"{PH1} is not defined"},Tt=v.registerUIStrings("inline_editor/CSSVarSwatch.ts",Pt),kt=v.getLocalizedString.bind(void 0,Tt),{render:zt,html:Lt,Directives:Mt}=x,At=/(var\()(\s*--[^,)]+)(.*)/;class Ft extends HTMLElement{constructor(){super(...arguments),this.shadow=this.attachShadow({mode:"open"}),this.text="",this.computedValue=null,this.fromFallback=!1,this.onLinkClick=()=>{}}set data(t){this.text=t.text,this.computedValue=t.computedValue,this.fromFallback=t.fromFallback,this.onLinkClick=t.onLinkClick,this.render()}parseVariableFunctionParts(){const t=this.text.replace(/\s{2,}/g," ").match(At);return t?{pre:t[1],name:t[2],post:t[3]}:null}get variableName(){const t=this.text.match(/--[^,)]+/);return t?t[0]:""}renderLink(t){const e=this.computedValue&&!this.fromFallback,i=Mt.classMap({"css-var-link":!0,undefined:!e}),s=e?kt(Pt.jumpToDefinition):kt(Pt.sIsNotDefined,{PH1:t}),n=e?this.onLinkClick.bind(this,this.variableName.trim()):null;return Lt`<span class="${i}" title="${s}" @mousedown=${n} role="link" tabindex="-1">${t}</span>`}render(){const t=this.parseVariableFunctionParts();if(!t)return void zt("",this.shadow,{eventContext:this});const e=this.renderLink(t.name);zt(Lt`<style>
      .css-var-link:not(.undefined) {
        cursor: pointer;
        text-underline-position: under;
        color: var(--link-color);
      }

      .css-var-link:hover:not(.undefined) {
        text-decoration: underline;
      }

      .css-var-link:focus:not(:focus-visible) {
        outline: none;
      }
      </style><span title="${this.computedValue||""}">${t.pre}${e}${t.post}</span>`,this.shadow,{eventContext:this})}}customElements.get("devtools-css-var-swatch")||customElements.define("devtools-css-var-swatch",Ft);var Bt=Object.freeze({__proto__:null,UIStrings:Pt,CSSVarSwatch:Ft});async function Ot(t){const e=r.Context.instance().flavor(C.DOMNode);let i;if(e&&e.parentNode&&"HTML"!==e.nodeName()){const[s]=I.TargetManager.instance().models(P.CSSOverviewModel),n=t?e.parentNode.id:e.id,o=(await s.getComputedStyleForNode(n).then(Rt)).replace(/[a-z]/g,"");i=parseFloat(o)}else i=16;return i}function Rt(t){const e=t.computedStyle;let i=6;if(e[i].name&&"font-size"!==e[i].name)for(let t=0;t<e.length;t++)if("font-size"===e[t].name){i=t;break}return e[i].value}const Ut={expression:"window.innerWidth",objectGroup:void 0,includeCommandLineAPI:!1,silent:!0,contextId:void 0,returnByValue:!1,generatePreview:!1,userGesture:!1,awaitPromise:!0,throwOnSideEffect:!1,timeout:void 0,disableBreaks:!0,replMode:!1,allowUnsafeEvalBlockedByCSP:!1},Vt={expression:"window.innerHeight",objectGroup:void 0,includeCommandLineAPI:!1,silent:!0,contextId:void 0,returnByValue:!1,generatePreview:!1,userGesture:!1,awaitPromise:!0,throwOnSideEffect:!1,timeout:void 0,disableBreaks:!0,replMode:!1,allowUnsafeEvalBlockedByCSP:!1};async function Ht(){const t=r.Context.instance().flavor(E.ExecutionContext);let e,i;if(t){const s=await t.evaluate(Ut,!1,!1),n=await t.evaluate(Vt,!1,!1);if("error"in s||"error"in n)return null;s.object&&(e=s.object.value),n.object&&(i=n.object.value)}if(void 0===e||void 0===i){const t=r.Context.instance().flavor(C.DOMNode);if(!t)return null;const s=await t.domModel().target().pageAgent().invoke_getLayoutMetrics(),n=s.visualViewport.zoom?s.visualViewport.zoom:1;i=s.visualViewport.clientHeight/n,e=s.visualViewport.clientWidth/n}return{width:e,height:i}}const Nt=new Map;async function Xt(t,e,i){let s,n;""===t&&(t="em"),""===e&&(e="em");const o=Nt.get(t),r=Nt.get(e);return o&&r?(s="em"===t||"%"===t?await o(i):await o(),n="em"===e||"%"===e?await r(i):await r(),s/n):1}Nt.set("px",(function(){return 1})),Nt.set("em",Ot),Nt.set("rem",(async function(){const t=function(t){let e=t;for(;e&&"HTML"!==e.nodeName()&&e.parentNode;)e=e.parentNode;return e}(r.Context.instance().flavor(C.DOMNode));if(!t||!t.id)return 16;const[e]=I.TargetManager.instance().models(P.CSSOverviewModel),i=(await e.getComputedStyleForNode(t.id).then(Rt)).replace(/[a-z]/g,"");return parseFloat(i)})),Nt.set("%",(async function(t){return await Ot(t)/100})),Nt.set("vh",(async function(){const t=await Ht();return t?t.height/100:1})),Nt.set("vw",(async function(){const t=await Ht();return t?t.width/100:1})),Nt.set("vmin",(async function(){const t=await Ht();if(!t)return 1;const e=t.width,i=t.height;return Math.min(e,i)/100})),Nt.set("vmax",(async function(){const t=await Ht();if(!t)return 1;const e=t.width,i=t.height;return Math.max(e,i)/100})),Nt.set("cm",(function(){return 37.795})),Nt.set("mm",(function(){return 3.7795})),Nt.set("in",(function(){return 96})),Nt.set("pt",(function(){return 4/3})),Nt.set("pc",(function(){return 16}));var Dt=Object.freeze({__proto__:null,getUnitConversionMultiplier:Xt});const $t=new Set(["px","em","rem","%","vh","vw"]),jt=new Set(["","px","em","%"]),Yt=new Set(["em","rem","px"]),Gt=["","xx-small","x-small","smaller","small","medium","large","larger","x-large","xx-large"],Kt=["","normal"],Wt=["","lighter","normal","bold","bolder"],qt=["","normal"],Zt=["inherit","initial","unset"];Gt.push(...Zt),Kt.push(...Zt),Wt.push(...Zt),qt.push(...Zt);const Qt=new Set(Gt),Jt=new Set(Kt),te=new Set(Wt),ee=new Set(qt),ie=new Map([["px",{min:0,max:72,step:1}],["em",{min:0,max:4.5,step:.1}],["rem",{min:0,max:4.5,step:.1}],["%",{min:0,max:450,step:1}],["vh",{min:0,max:10,step:.1}],["vw",{min:0,max:10,step:.1}],["vmin",{min:0,max:10,step:.1}],["vmax",{min:0,max:10,step:.1}],["cm",{min:0,max:2,step:.1}],["mm",{min:0,max:20,step:.1}],["in",{min:0,max:1,step:.01}],["pt",{min:0,max:54,step:1}],["pc",{min:0,max:4.5,step:.1}]]),se=new Map([["",{min:0,max:2,step:.1}],["em",{min:0,max:2,step:.1}],["%",{min:0,max:200,step:1}],["px",{min:0,max:32,step:1}],["rem",{min:0,max:2,step:.1}],["vh",{min:0,max:4.5,step:.1}],["vw",{min:0,max:4.5,step:.1}],["vmin",{min:0,max:4.5,step:.1}],["vmax",{min:0,max:4.5,step:.1}],["cm",{min:0,max:1,step:.1}],["mm",{min:0,max:8.5,step:.1}],["in",{min:0,max:.5,step:.1}],["pt",{min:0,max:24,step:1}],["pc",{min:0,max:2,step:.1}]]),ne=new Map([["",{min:100,max:700,step:100}]]),oe=new Map([["px",{min:-10,max:10,step:.01}],["em",{min:-.625,max:.625,step:.001}],["rem",{min:-.625,max:.625,step:.001}],["%",{min:-62.5,max:62.5,step:.1}],["vh",{min:-1.5,max:1.5,step:.01}],["vw",{min:-1.5,max:1.5,step:.01}],["vmin",{min:-1.5,max:1.5,step:.01}],["vmax",{min:-1.5,max:1.5,step:.01}],["cm",{min:-.25,max:.025,step:.001}],["mm",{min:-2.5,max:2.5,step:.01}],["in",{min:-.1,max:.1,step:.001}],["pt",{min:-7.5,max:7.5,step:.01}],["pc",{min:-.625,max:.625,step:.001}]]),re={regex:/(^[\+\d\.]+)([a-zA-Z%]+)/,units:$t,keyValues:Qt,rangeMap:ie,defaultUnit:"px"},ae={regex:/(^[\+\d\.]+)([a-zA-Z%]*)/,units:jt,keyValues:Jt,rangeMap:se,defaultUnit:""},le={regex:/(^[\+\d\.]+)/,units:null,keyValues:te,rangeMap:ne,defaultUnit:null},he={regex:/([\+-0-9\.]+)([a-zA-Z%]+)/,units:Yt,keyValues:ee,rangeMap:oe,defaultUnit:"em"},de=["Arial","Bookman","Candara","Comic Sans MS","Courier New","Garamond","Georgia","Helvetica","Impact","Palatino","Roboto","Times New Roman","Verdana"],ce=["serif","sans-serif","monspace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"];async function ue(){const t=I.TargetManager.instance().models(P.CSSOverviewModel);if(t){const e=t[0];if(e){const{fontInfo:t}=await Promise.resolve(e.getNodeStyleStats());return Array.from(t.keys())}}return[]}function pe(t){switch(t){case 1:return 0;case.1:return 1;case.01:return 2;case.001:return 3;default:return 0}}var _e=Object.freeze({__proto__:null,FontPropertiesRegex:/^[^- ][a-zA-Z-]+|-?\+?(?:[0-9]+\.[0-9]+|\.[0-9]+|[0-9]+)[a-zA-Z%]{0,4}/,FontFamilyRegex:/(?:"[\w \,-]+",? ?|'[\w \,-]+',? ?|[\w \,-]+,? ?)+/,GlobalValues:Zt,FontSizeStaticParams:re,LineHeightStaticParams:ae,FontWeightStaticParams:le,LetterSpacingStaticParams:he,SystemFonts:de,GenericFonts:ce,generateComputedFontArray:ue,getRoundingPrecision:pe});const me={fontFamily:"Font Family",cssProperties:"CSS Properties",fontSize:"Font Size",lineHeight:"Line Height",fontWeight:"Font Weight",spacing:"Spacing",fallbackS:"Fallback {PH1}",thereIsNoValueToDeleteAtIndexS:"There is no value to delete at index: {PH1}",fontSelectorDeletedAtIndexS:"Font Selector deleted at index: {PH1}",deleteS:"Delete {PH1}",PleaseEnterAValidValueForSText:"* Please enter a valid value for {PH1} text input",thisPropertyIsSetToContainUnits:"This property is set to contain units but does not have a defined corresponding unitsArray: {PH1}",sSliderInput:"{PH1} Slider Input",sTextInput:"{PH1} Text Input",units:"Units",sUnitInput:"{PH1} Unit Input",sKeyValueSelector:"{PH1} Key Value Selector",sToggleInputType:"{PH1} toggle input type",selectorInputMode:"Selector Input Mode",sliderInputMode:"Slider Input Mode"},ge=v.registerUIStrings("inline_editor/FontEditor.js",me),fe=v.getLocalizedString.bind(void 0,ge);class ve extends n.VBox{constructor(t){super(!0),this.registerRequiredCSS("inline_editor/fontEditor.css",{enableLegacyPatching:!0}),this._selectedNode=r.Context.instance().flavor(C.DOMNode),this._propertyMap=t,this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this._fontSelectorSection=this.contentElement.createChild("div","font-selector-section"),this._fontSelectorSection.createChild("h2","font-section-header").textContent=fe(me.fontFamily),this._fontSelectors=[],this._fontsList=null;const e=this._propertyMap.get("font-family");this._createFontSelectorSection(e);const i=this.contentElement.createChild("div","font-section");i.createChild("h2","font-section-header").textContent=fe(me.cssProperties);const s=this._getPropertyInfo("font-size",re.regex),n=this._getPropertyInfo("line-height",ae.regex),o=this._getPropertyInfo("font-weight",le.regex),a=this._getPropertyInfo("letter-spacing",he.regex);new Se("font-size",fe(me.fontSize),i,s,re,this._updatePropertyValue.bind(this),this._resizePopout.bind(this),!0),new Se("line-height",fe(me.lineHeight),i,n,ae,this._updatePropertyValue.bind(this),this._resizePopout.bind(this),!0),new Se("font-weight",fe(me.fontWeight),i,o,le,this._updatePropertyValue.bind(this),this._resizePopout.bind(this),!1),new Se("letter-spacing",fe(me.spacing),i,a,he,this._updatePropertyValue.bind(this),this._resizePopout.bind(this),!0)}async _createFontSelectorSection(t){if(t){const e=t.split(",");if(await this._createFontSelector(e[0],!0),!Zt.includes(e[0]))for(let t=1;t<e.length+1;t++)this._createFontSelector(e[t])}else this._createFontSelector("",!0);this._resizePopout()}async _createFontsList(){const t=await ue(),e=new Map,i=this._splitComputedFontArray(t);e.set("Computed Fonts",i);const s=new Map;s.set("System Fonts",de),s.set("Generic Families",ce);const n=[];return n.push(e),n.push(s),n}_splitComputedFontArray(t){const e=[];for(const i of t)if(i.includes(",")){i.split(",").forEach((t=>{-1===e.findIndex((e=>e.toLowerCase()===t.trim().toLowerCase().replace(/"/g,"'")))&&e.push(t.trim().replace(/"/g,""))}))}else-1===e.findIndex((t=>t.toLowerCase()===i.toLowerCase().replace('"',"'")))&&e.push(i.replace(/"/g,""));return e}async _createFontSelector(t,e){if(t=t?t.trim():""){const e=t.charAt(0);"'"===e?t=t.replace(/'/g,""):'"'===e&&(t=t.replace(/"/g,""))}const i=this._fontSelectorSection.createChild("div","shadow-editor-field shadow-editor-flex-field");let s;if(this._fontsList||(this._fontsList=await this._createFontsList()),e){s=fe(me.fontFamily);const e=new Map([["Global Values",Zt]]),n=[...this._fontsList];n.push(e),this._createSelector(i,s,n,t.trim())}else s=fe(me.fallbackS,{PH1:this._fontSelectors.length}),this._createSelector(i,s,this._fontsList,t.trim())}_deleteFontSelector(t,e){let i=this._fontSelectors[t];const s=0===t;if(""===i.input.value&&!e)return void a.alert(fe(me.thereIsNoValueToDeleteAtIndexS,{PH1:t}),this.contentElement);if(s){const e=this._fontSelectors[1];let s="";e&&(s=e.input.value,i=e);this._fontSelectors[0].input.value=s,t=1}if(i.input.parentNode){const e=this._fontSelectors.length>1;if(!s||e){const e=i.input.parentElement;e&&(e.remove(),this._fontSelectors.splice(t,1),this._updateFontSelectorList())}a.alert(fe(me.fontSelectorDeletedAtIndexS,{PH1:t}),this.contentElement)}this._onFontSelectorChanged(),this._resizePopout();const n=s?0:t-1;this._fontSelectors[n].input.focus()}_updateFontSelectorList(){for(let t=0;t<this._fontSelectors.length;t++){const e=this._fontSelectors[t];let i;i=0===t?fe(me.fontFamily):fe(me.fallbackS,{PH1:t}),e.label.textContent=i,a.setAccessibleName(e.input,i),e.deleteButton.setTitle(fe(me.deleteS,{PH1:i})),e.index=t}}_getPropertyInfo(t,e){const i=this._propertyMap.get(t);if(i){const t=i,s=t.match(e);if(s){return{value:"+"===s[1].charAt(0)?s[1].substr(1):s[1],units:s[2]?s[2]:""}}return{value:t,units:null}}return{value:null,units:null}}_createSelector(t,e,s,n){const o=this._fontSelectors.length,r=i.createSelect(e,s);r.value=n;const a=i.createLabel(e,"shadow-editor-label",r);r.addEventListener("input",this._onFontSelectorChanged.bind(this),!1),r.addEventListener("keydown",(t=>{"Enter"===t.key&&t.consume()}),!1),t.appendChild(a),t.appendChild(r);const h=new l.Toolbar("",t),d=new l.ToolbarButton(fe(me.deleteS,{PH1:e}),"largeicon-trash-bin");h.appendToolbarItem(d);const c={label:a,input:r,deleteButton:d,index:o};d.addEventListener(l.ToolbarButton.Events.Click,(()=>{this._deleteFontSelector(c.index)})),d.element.addEventListener("keydown",(t=>{isEnterOrSpaceKey(t)&&(this._deleteFontSelector(c.index),t.consume())}),!1),this._fontSelectors.push(c)}_onFontSelectorChanged(){let t="";const e=Zt.includes(this._fontSelectors[0].input.value);if(e)for(let t=1;t<this._fontSelectors.length;t++)this._deleteFontSelector(t,!0);for(const e of this._fontSelectors){const i=e.input;""!==i.value&&(""===t?t=this._fontSelectors[0].input.value:t+=", "+i.value)}""!==this._fontSelectors[this._fontSelectors.length-1].input.value&&!e&&this._fontSelectors.length<10&&(this._createFontSelector(""),this._resizePopout()),this._updatePropertyValue("font-family",t)}_updatePropertyValue(t,e){this.dispatchEventToListeners(xe.FontChanged,{propertyName:t,value:e})}_resizePopout(){this.dispatchEventToListeners(xe.FontEditorResized)}}const xe={FontChanged:Symbol("FontChanged"),FontEditorResized:Symbol("FontEditorResized")};class Se{constructor(t,e,i,s,n,o,l,h){this._showSliderMode=!0;const d=i.createChild("div","shadow-editor-field shadow-editor-flex-field");if(this._errorText=i.createChild("div","error-text"),this._errorText.textContent=fe(me.PleaseEnterAValidValueForSText,{PH1:t}),this._errorText.hidden=!0,a.markAsAlert(this._errorText),this._propertyInfo=s,this._propertyName=t,this._staticParams=n,this._hasUnits=h,this._hasUnits&&this._staticParams.units&&null!==this._staticParams.defaultUnit){const t=this._staticParams.defaultUnit;this._units=null!==s.units?s.units:t,this._addedUnit=!this._staticParams.units.has(this._units)}else{if(this._hasUnits)throw new Error(fe(me.thisPropertyIsSetToContainUnits,{PH1:t}));this._units=""}this._initialRange=this._getUnitRange(),this._boundUpdateCallback=o,this._boundResizeCallback=l,this._selectedNode=r.Context.instance().flavor(C.DOMNode),this._sliderInput=this._createSliderInput(d,e),this._textBoxInput=this._createTextBoxInput(d),this._unitInput=this._createUnitInput(d),this._selectorInput=this._createSelectorInput(d),this._createTypeToggle(d),this._checkSelectorValueAndToggle(),this._applyNextInput=!1}_setInvalidTextBoxInput(t){t?this._errorText.hidden&&(this._errorText.hidden=!1,this._textBoxInput.classList.add("error-input"),this._boundResizeCallback()):this._errorText.hidden||(this._errorText.hidden=!0,this._textBoxInput.classList.remove("error-input"),this._boundResizeCallback())}_checkSelectorValueAndToggle(){return!(!this._staticParams.keyValues||null===this._propertyInfo.value||!this._staticParams.keyValues.has(this._propertyInfo.value))&&(this._toggleInputType(),!0)}_getUnitRange(){let t=0,e=100,i=1;if(null!==this._propertyInfo.value&&/\d/.test(this._propertyInfo.value))if(this._staticParams.rangeMap.get(this._units)){const s=this._staticParams.rangeMap.get(this._units);s&&(t=Math.min(s.min,parseFloat(this._propertyInfo.value)),e=Math.max(s.max,parseFloat(this._propertyInfo.value)),i=s.step)}else{const s=this._staticParams.rangeMap.get("px");s&&(t=Math.min(s.min,parseFloat(this._propertyInfo.value)),e=Math.max(s.max,parseFloat(this._propertyInfo.value)),i=s.step)}else{const s=this._staticParams.rangeMap.get(this._units);s&&(t=s.min,e=s.max,i=s.step)}return{min:t,max:e,step:i}}_createSliderInput(t,e){const s=this._initialRange.min,n=this._initialRange.max,o=this._initialRange.step,r=i.createSlider(s,n,-1);r.sliderElement.step=o.toString(),r.sliderElement.tabIndex=0;const l=i.createLabel(e,"shadow-editor-label",r);if(this._propertyInfo.value)r.value=parseFloat(this._propertyInfo.value);else{const t=(s+n)/2;r.value=t}return r.addEventListener("input",(t=>{this._onSliderInput(t,!1)})),r.addEventListener("mouseup",(t=>{this._onSliderInput(t,!0)})),r.addEventListener("keydown",(t=>{"ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key||(this._applyNextInput=!0)})),t.appendChild(l),t.appendChild(r),a.setAccessibleName(r.sliderElement,fe(me.sSliderInput,{PH1:this._propertyName})),r}_createTextBoxInput(t){const e=i.createInput("shadow-editor-text-input","number");return e.step=this._initialRange.step.toString(),e.classList.add("font-editor-text-input"),null!==this._propertyInfo.value&&("+"===this._propertyInfo.value.charAt(0)&&(this._propertyInfo.value=this._propertyInfo.value.substr(1)),e.value=this._propertyInfo.value),e.step="any",e.addEventListener("input",this._onTextBoxInput.bind(this),!1),t.appendChild(e),a.setAccessibleName(e,fe(me.sTextInput,{PH1:this._propertyName})),e}_createUnitInput(t){let e;if(this._hasUnits&&this._staticParams.units){const t=this._propertyInfo.units,s=this._staticParams.units;e=i.createSelect(fe(me.units),s),e.classList.add("font-editor-select"),this._addedUnit&&t&&e.add(new Option(t,t)),t&&(e.value=t),e.addEventListener("change",this._onUnitInput.bind(this),!1)}else e=i.createSelect(fe(me.units),[]),e.classList.add("font-editor-select"),e.disabled=!0;return e.addEventListener("keydown",(t=>{"Enter"===t.key&&t.consume()}),!1),t.appendChild(e),a.setAccessibleName(e,fe(me.sUnitInput,{PH1:this._propertyName})),e}_createSelectorInput(t){const e=i.createSelect(fe(me.sKeyValueSelector,{PH1:this._propertyName}),this._staticParams.keyValues);return e.classList.add("font-selector-input"),this._propertyInfo.value&&(e.value=this._propertyInfo.value),e.addEventListener("input",this._onSelectorInput.bind(this),!1),e.addEventListener("keydown",(t=>{"Enter"===t.key&&t.consume()}),!1),t.appendChild(e),e.hidden=!0,e}_onSelectorInput(t){if(t.currentTarget){const e=t.currentTarget.value;this._textBoxInput.value="";const i=(parseFloat(this._sliderInput.sliderElement.min)+parseFloat(this._sliderInput.sliderElement.max))/2;this._sliderInput.value=i,this._setInvalidTextBoxInput(!1),this._boundUpdateCallback(this._propertyName,e)}}_onSliderInput(t,e){const i=t.currentTarget;if(i){const t=i.value;this._textBoxInput.value=t,this._selectorInput.value="";const s=this._hasUnits?t+this._unitInput.value:t.toString();this._setInvalidTextBoxInput(!1),(e||this._applyNextInput)&&(this._boundUpdateCallback(this._propertyName,s),this._applyNextInput=!1)}}_onTextBoxInput(t){const e=t.currentTarget;if(e){const t=e.value,i=t+(""===t?"":this._unitInput.value);this._staticParams.regex.test(i)||""===t&&!e.validationMessage.length?(parseFloat(t)>parseFloat(this._sliderInput.sliderElement.max)?this._sliderInput.sliderElement.max=t:parseFloat(t)<parseFloat(this._sliderInput.sliderElement.min)&&(this._sliderInput.sliderElement.min=t),this._sliderInput.value=parseFloat(t),this._selectorInput.value="",this._setInvalidTextBoxInput(!1),this._boundUpdateCallback(this._propertyName,i)):this._setInvalidTextBoxInput(!0)}}async _onUnitInput(t){const e=t.currentTarget,i=e.hasFocus(),s=e.value;e.disabled=!0;const n=this._units,o=await Xt(n,s,"font-size"===this._propertyName);this._setInputUnits(o,s),this._textBoxInput.value&&this._boundUpdateCallback(this._propertyName,this._textBoxInput.value+s),this._units=s,e.disabled=!1,i&&e.focus()}_createTypeToggle(t){const e=t.createChild("div","spectrum-switcher");!function(t){const e=i.createSVGChild(t,"svg");e.setAttribute("height","16"),e.setAttribute("width","16");i.createSVGChild(e,"path").setAttribute("d","M5,6 L11,6 L8,2 Z M5,10 L11,10 L8,14 Z")}(e),i.setTitle(e,fe(me.sToggleInputType,{PH1:this._propertyName})),e.tabIndex=0,self.onInvokeElement(e,this._toggleInputType.bind(this)),a.markAsButton(e)}_toggleInputType(t){t&&"Enter"===t.key&&t.consume(),this._showSliderMode?(this._sliderInput.hidden=!0,this._textBoxInput.hidden=!0,this._unitInput.hidden=!0,this._selectorInput.hidden=!1,this._showSliderMode=!1,a.alert(fe(me.selectorInputMode),this._textBoxInput)):(this._sliderInput.hidden=!1,this._textBoxInput.hidden=!1,this._unitInput.hidden=!1,this._selectorInput.hidden=!0,this._showSliderMode=!0,a.alert(fe(me.sliderInputMode),this._textBoxInput))}_setInputUnits(t,e){const i=this._staticParams.rangeMap.get(e);let s,n,o;i?(s=i.min,n=i.max,o=i.step):(s=0,n=100,o=1);let r=!1;const a=pe(o);let l=(s+n)/2;this._textBoxInput.value&&(r=!0,l=parseFloat((parseFloat(this._textBoxInput.value)*t).toFixed(a))),this._sliderInput.sliderElement.min=Math.min(l,s).toString(),this._sliderInput.sliderElement.max=Math.max(l,n).toString(),this._sliderInput.sliderElement.step=o.toString(),this._textBoxInput.step=o.toString(),r&&(this._textBoxInput.value=l.toString()),this._sliderInput.value=l}}var we=Object.freeze({__proto__:null,UIStrings:me,FontEditor:ve,Events:xe});class be extends HTMLSpanElement{constructor(){super();const t=h.createShadowRootWithCoreStyles(this,{cssFile:"inline_editor/bezierSwatch.css",enableLegacyPatching:!0,delegatesFocus:void 0});this._iconElement=d.Icon.create("smallicon-bezier","bezier-swatch-icon"),t.appendChild(this._iconElement),this._textElement=this.createChild("span"),t.createChild("slot")}static create(){let t=be._constructor;return t||(t=h.registerCustomElement("span","bezier-swatch",be),be._constructor=t),t()}bezierText(){return this._textElement.textContent||""}setBezierText(t){this._textElement.textContent=t}hideText(t){this._textElement.hidden=t}iconElement(){return this._iconElement}}be._constructor=null;class ye extends HTMLSpanElement{constructor(){super();const t=h.createShadowRootWithCoreStyles(this,{cssFile:"inline_editor/cssShadowSwatch.css",enableLegacyPatching:!0,delegatesFocus:void 0});this._iconElement=d.Icon.create("smallicon-shadow","shadow-swatch-icon"),t.appendChild(this._iconElement),t.createChild("slot"),this._contentElement=this.createChild("span"),this._colorSwatch}static create(){let t=ye._constructor;return t||(t=h.registerCustomElement("span","css-shadow-swatch",ye),ye._constructor=t),t()}model(){return this._model}setCSSShadow(t){this._model=t,this._contentElement.removeChildren();const e=y.Utils.splitStringByRegexes(t.asCSSText(),[/!important/g,/inset/g,u.Regex]);for(let i=0;i<e.length;i++){const s=e[i];if(2===s.regexIndex){if(!this._colorSwatch){this._colorSwatch=new H;const t=this._colorSwatch.createChild("span");this._colorSwatch.addEventListener("format-changed",(e=>{t.textContent=e.data.text}))}this._colorSwatch.renderColor(t.color());const e=this._colorSwatch.querySelector("span");e&&(e.textContent=t.color().asString()),this._contentElement.appendChild(this._colorSwatch)}else this._contentElement.appendChild(document.createTextNode(s.value))}}hideText(t){this._contentElement.hidden=t}iconElement(){return this._iconElement}colorSwatch(){return this._colorSwatch}}ye._constructor=null;var Ce=Object.freeze({__proto__:null,BezierSwatch:be,CSSShadowSwatch:ye});class Ie extends m.ObjectWrapper{constructor(){super(),this._popover=new c.GlassPane,this._popover.registerRequiredCSS("inline_editor/swatchPopover.css",{enableLegacyPatching:!1}),this._popover.setSizeBehavior(c.SizeBehavior.MeasureContent),this._popover.setMarginBehavior(c.MarginBehavior.Arrow),this._popover.element.addEventListener("mousedown",(t=>t.consume()),!1),this._hideProxy=this.hide.bind(this,!0),this._boundOnKeyDown=this._onKeyDown.bind(this),this._boundFocusOut=this._onFocusOut.bind(this),this._isHidden=!0,this._anchorElement=null}_onFocusOut(t){const e=t.relatedTarget;!this._isHidden&&e&&this._view&&!e.isSelfOrDescendant(this._view.contentElement)&&this._hideProxy()}isShowing(){return this._popover.isShowing()}show(t,e,i){if(this._popover.isShowing()){if(this._anchorElement===e)return;this.hide(!0)}this.dispatchEventToListeners(Ee.WillShowPopover),this._isHidden=!1,this._anchorElement=e,this._view=t,this._hiddenCallback=i,this.reposition(),t.focus();const s=this._popover.element.ownerDocument;s.addEventListener("mousedown",this._hideProxy,!1),s.defaultView&&s.defaultView.addEventListener("resize",this._hideProxy,!1),this._view.contentElement.addEventListener("keydown",this._boundOnKeyDown,!1)}reposition(){if(!this._isHidden&&this._view){if(this._view.contentElement.removeEventListener("focusout",this._boundFocusOut,!1),this._view.show(this._popover.contentElement),this._anchorElement){let t=this._anchorElement.boxInWindow();if(H.isColorSwatch(this._anchorElement)){const e=this._anchorElement;if(!e.anchorBox)return;t=e.anchorBox}this._popover.setContentAnchorBox(t),this._popover.show(this._anchorElement.ownerDocument)}this._view.contentElement.addEventListener("focusout",this._boundFocusOut,!1),this._focusRestorer||(this._focusRestorer=new n.WidgetFocusRestorer(this._view))}}hide(t){if(this._isHidden)return;const e=this._popover.element.ownerDocument;this._isHidden=!0,this._popover.hide(),e.removeEventListener("mousedown",this._hideProxy,!1),e.defaultView&&e.defaultView.removeEventListener("resize",this._hideProxy,!1),this._hiddenCallback&&this._hiddenCallback.call(null,Boolean(t)),this._focusRestorer&&this._focusRestorer.restore(),this._anchorElement=null,this._view&&(this._view.detach(),this._view.contentElement.removeEventListener("keydown",this._boundOnKeyDown,!1),this._view.contentElement.removeEventListener("focusout",this._boundFocusOut,!1),delete this._view)}_onKeyDown(t){const e=t;if("Enter"===e.key)return this.hide(!0),void e.consume(!0);"Escape"===e.key&&(this.hide(!1),e.consume(!0))}}const Ee={WillShowPopover:Symbol("WillShowPopover")};var Pe=Object.freeze({__proto__:null,SwatchPopoverHelper:Ie,Events:Ee});export{F as BezierEditor,z as BezierUI,gt as CSSAngle,gt as CSSAngleImpl,Q as CSSAngleUtils,Et as CSSShadowEditor,St as CSSShadowModel,Bt as CSSVarSwatch,Bt as CSSVarSwatchImpl,X as ColorSwatch,X as ColorSwatchImpl,we as FontEditor,Dt as FontEditorUnitConverter,_e as FontEditorUtils,Pe as SwatchPopoverHelper,Ce as Swatches};
