import{ObjectWrapper as t,ColorUtils as e,Color as o,Throttler as s,Settings as i}from"../common/common.js";import{userMetrics as n,InspectorFrontendHost as a,InspectorFrontendHostAPI as r}from"../host/host.js";import{i18n as l}from"../i18n/i18n.js";import{NumberUtilities as h,StringUtilities as c}from"../platform/platform.js";import{Runtime as d}from"../root/root.js";import{UIUtils as _,Icon as C,Toolbar as g,ARIAUtils as u,Tooltip as p,Widget as m,ContextMenu as b}from"../ui/ui.js";import{SDKModel as E,CSSModel as A}from"../sdk/sdk.js";class f extends t.ObjectWrapper{constructor(t){if(super(),this._isNull=!0,this._contrastRatio=null,this._contrastRatioAPCA=null,this._contrastRatioThresholds=null,this._contrastRationAPCAThreshold=0,this._fgColor=null,this._bgColor=null,this._colorFormat,!t)return;if(!t.computedFontSize||!t.computedFontWeight||!t.backgroundColors||1!==t.backgroundColors.length)return;this._isNull=!1,this._contrastRatioThresholds=e.getContrastThreshold(t.computedFontSize,t.computedFontWeight),this._contrastRationAPCAThreshold=e.getAPCAThreshold(t.computedFontSize,t.computedFontWeight);const s=t.backgroundColors[0],i=o.Color.parse(s);i&&this._setBgColorInternal(i)}isNull(){return this._isNull}setColor(t,e){this._fgColor=t,this._colorFormat=e,this._updateContrastRatio(),this.dispatchEventToListeners(v.ContrastInfoUpdated)}colorFormat(){return this._colorFormat}color(){return this._fgColor}contrastRatio(){return this._contrastRatio}contrastRatioAPCA(){return this._contrastRatioAPCA}contrastRatioAPCAThreshold(){return this._contrastRationAPCAThreshold}setBgColor(t){this._setBgColorInternal(t),this.dispatchEventToListeners(v.ContrastInfoUpdated)}_setBgColorInternal(t){if(this._bgColor=t,!this._fgColor)return;const s=this._fgColor.rgba();if(t.hasAlpha()){const i=e.blendColors(t.rgba(),s);this._bgColor=new o.Color(i,o.Format.RGBA)}this._contrastRatio=e.contrastRatio(s,this._bgColor.rgba()),this._contrastRatioAPCA=e.contrastRatioAPCA(this._fgColor.rgba(),this._bgColor.rgba())}bgColor(){return this._bgColor}_updateContrastRatio(){this._bgColor&&this._fgColor&&(this._contrastRatio=e.contrastRatio(this._fgColor.rgba(),this._bgColor.rgba()),this._contrastRatioAPCA=e.contrastRatioAPCA(this._fgColor.rgba(),this._bgColor.rgba()))}contrastRatioThreshold(t){return this._contrastRatioThresholds?this._contrastRatioThresholds[t]:null}}const v={ContrastInfoUpdated:Symbol("ContrastInfoUpdated")};var F=Object.freeze({__proto__:null,ContrastInfo:f,Events:v,ContrastInfoType:undefined});const P={noContrastInformationAvailable:"No contrast information available",contrastRatio:"Contrast ratio",showMore:"Show more",pickBackgroundColor:"Pick background color",toggleBackgroundColorPicker:"Toggle background color picker",useSuggestedColorStoFixLow:"Use suggested color {PH1}to fix low contrast",apca:"APCA",aa:"AA",placeholderWithColon:": {PH1}",aaa:"AAA",showLess:"Show less"},w=l.registerUIStrings("color_picker/ContrastDetails.js",P),B=l.getLocalizedString.bind(void 0,w);class S extends t.ObjectWrapper{constructor(t,e,o,s,i){super(),this._contrastInfo=t,this._element=e.createChild("div","spectrum-contrast-details collapsed"),this._toggleMainColorPicker=o,this._expandedChangedCallback=s,this._colorSelectedCallback=i,this._expanded=!1,this._passesAA=!0,this._contrastUnknown=!1,this._visible=!1,this._noContrastInfoAvailable=e.createChild("div","no-contrast-info-available"),this._noContrastInfoAvailable.textContent=B(P.noContrastInformationAvailable),this._noContrastInfoAvailable.classList.add("hidden");const n=this._element.createChild("div");n.addEventListener("click",this._topRowClicked.bind(this));const a=n.createChild("div","container");_.createTextChild(a,B(P.contrastRatio)),this._contrastValueBubble=a.createChild("span","contrast-details-value"),this._contrastValue=this._contrastValueBubble.createChild("span"),this._contrastValueBubbleIcons=[],this._contrastValueBubbleIcons.push(this._contrastValueBubble.appendChild(C.Icon.create("smallicon-checkmark-square"))),this._contrastValueBubbleIcons.push(this._contrastValueBubble.appendChild(C.Icon.create("smallicon-checkmark-behind"))),this._contrastValueBubbleIcons.push(this._contrastValueBubble.appendChild(C.Icon.create("smallicon-no"))),this._contrastValueBubbleIcons.forEach((t=>t.addEventListener("click",(t=>{S._showHelp(),t.consume(!1)}))));const r=new g.Toolbar("expand",a);this._expandButton=new g.ToolbarButton(B(P.showMore),"smallicon-expand-more"),this._expandButton.addEventListener(g.ToolbarButton.Events.Click,this._expandButtonClicked.bind(this)),u.setExpanded(this._expandButton.element,!1),r.appendToolbarItem(this._expandButton),this._expandedDetails=this._element.createChild("div","expanded-details"),u.setControls(this._expandButton.element,this._expandedDetails),this._contrastThresholds=this._expandedDetails.createChild("div","contrast-thresholds"),this._contrastAA=this._contrastThresholds.createChild("div","contrast-threshold"),this._contrastPassFailAA=this._contrastAA.createChild("div","contrast-pass-fail"),this._contrastAAA=this._contrastThresholds.createChild("div","contrast-threshold"),this._contrastPassFailAAA=this._contrastAAA.createChild("div","contrast-pass-fail"),this._contrastAPCA=this._contrastThresholds.createChild("div","contrast-threshold"),this._contrastPassFailAPCA=this._contrastAPCA.createChild("div","contrast-pass-fail"),this._chooseBgColor=this._expandedDetails.createChild("div","contrast-choose-bg-color"),this._chooseBgColor.textContent=B(P.pickBackgroundColor);const l=this._expandedDetails.createChild("div","background-color"),h=new g.Toolbar("spectrum-eye-dropper",l);this._bgColorPickerButton=new g.ToolbarToggle(B(P.toggleBackgroundColorPicker),"largeicon-eyedropper"),this._bgColorPickerButton.addEventListener(g.ToolbarButton.Events.Click,this._toggleBackgroundColorPicker.bind(this,void 0,!0)),h.appendToolbarItem(this._bgColorPickerButton),this._bgColorPickedBound=this._bgColorPicked.bind(this),this._bgColorSwatch=new x(l),this._contrastInfo.addEventListener(v.ContrastInfoUpdated,this._update.bind(this))}_showNoContrastInfoAvailableMessage(){this._noContrastInfoAvailable.classList.remove("hidden")}_hideNoContrastInfoAvailableMessage(){this._noContrastInfoAvailable.classList.add("hidden")}_computeSuggestedColor(t){const e=this._contrastInfo.color(),s=this._contrastInfo.bgColor();if(!e||!s)return;if("APCA"===t){const t=this._contrastInfo.contrastRatioAPCAThreshold();if(null===t)return;return o.Color.findFgColorForContrastAPCA(e,s,t+1)}const i=this._contrastInfo.contrastRatioThreshold(t);return i?o.Color.findFgColorForContrast(e,s,i+.1):void 0}_onSuggestColor(t){n.colorFixed(t);const e=this._computeSuggestedColor(t);e&&this._colorSelectedCallback(e)}_createFixColorButton(t,e){const s=t.createChild("button","contrast-fix-button"),i=this._contrastInfo.colorFormat(),n=i&&i!==o.Format.Nickname&&i!==o.Format.Original?i:o.Format.HEXA,a=e.asString(n),r=a?a+" ":"",l=B(P.useSuggestedColorStoFixLow,{PH1:r});return u.setAccessibleName(s,l),p.Tooltip.install(s,l),s.tabIndex=0,s.style.backgroundColor=r,s}_update(){if(this._contrastInfo.isNull())return this._showNoContrastInfoAvailableMessage(),void this.setVisible(!1);this.setVisible(!0),this._hideNoContrastInfoAvailableMessage();const t=d.experiments.isEnabled("APCA"),e=this._contrastInfo.color(),o=this._contrastInfo.bgColor();if(t){const t=this._contrastInfo.contrastRatioAPCA();if(null===t||!o||!e)return this._contrastUnknown=!0,this._contrastValue.textContent="",this._contrastValueBubble.classList.add("contrast-unknown"),this._chooseBgColor.classList.remove("hidden"),this._contrastThresholds.classList.add("hidden"),void this._showNoContrastInfoAvailableMessage();this._contrastUnknown=!1,this._chooseBgColor.classList.add("hidden"),this._contrastThresholds.classList.remove("hidden"),this._contrastValueBubble.classList.remove("contrast-unknown"),this._contrastValue.textContent=h.floor(t,2)+"%";const s=this._contrastInfo.contrastRatioAPCAThreshold(),i=!(!t||!s)&&Math.abs(t)>=s;this._contrastPassFailAPCA.removeChildren();const n=this._contrastPassFailAPCA.createChild("span","contrast-link-label");if(n.textContent=B(P.apca),null!==s&&(this._contrastPassFailAPCA.createChild("span").textContent=`: ${s.toFixed(2)}%`),i)this._contrastPassFailAPCA.appendChild(C.Icon.create("smallicon-checkmark-square"));else{this._contrastPassFailAPCA.appendChild(C.Icon.create("smallicon-no"));const t=this._computeSuggestedColor("APCA");if(t){this._createFixColorButton(this._contrastPassFailAPCA,t).addEventListener("click",(()=>this._onSuggestColor("APCA")))}}return n.addEventListener("click",(t=>S._showHelp())),this._element.classList.toggle("contrast-fail",!i),void this._contrastValueBubble.classList.toggle("contrast-aa",i)}const s=this._contrastInfo.contrastRatio();if(!s||!o||!e)return this._contrastUnknown=!0,this._contrastValue.textContent="",this._contrastValueBubble.classList.add("contrast-unknown"),this._chooseBgColor.classList.remove("hidden"),this._contrastThresholds.classList.add("hidden"),void this._showNoContrastInfoAvailableMessage();this._contrastUnknown=!1,this._chooseBgColor.classList.add("hidden"),this._contrastThresholds.classList.remove("hidden"),this._contrastValueBubble.classList.remove("contrast-unknown"),this._contrastValue.textContent=String(h.floor(s,2)),this._bgColorSwatch.setColors(e,o);const i=this._contrastInfo.contrastRatioThreshold("aa")||0;this._passesAA=(this._contrastInfo.contrastRatio()||0)>=i,this._contrastPassFailAA.removeChildren();const n=this._contrastPassFailAA.createChild("span","contrast-link-label");if(n.textContent=B(P.aa),this._contrastPassFailAA.createChild("span").textContent=B(P.placeholderWithColon,i.toFixed(1)),this._passesAA)this._contrastPassFailAA.appendChild(C.Icon.create("smallicon-checkmark-square"));else{this._contrastPassFailAA.appendChild(C.Icon.create("smallicon-no"));const t=this._computeSuggestedColor("aa");if(t){this._createFixColorButton(this._contrastPassFailAA,t).addEventListener("click",(()=>this._onSuggestColor("aa")))}}const a=this._contrastInfo.contrastRatioThreshold("aaa")||0,r=(this._contrastInfo.contrastRatio()||0)>=a;this._contrastPassFailAAA.removeChildren();const l=this._contrastPassFailAAA.createChild("span","contrast-link-label");if(l.textContent=B(P.aaa),this._contrastPassFailAAA.createChild("span").textContent=B(B(P.placeholderWithColon),a.toFixed(1)),r)this._contrastPassFailAAA.appendChild(C.Icon.create("smallicon-checkmark-square"));else{this._contrastPassFailAAA.appendChild(C.Icon.create("smallicon-no"));const t=this._computeSuggestedColor("aaa");if(t){this._createFixColorButton(this._contrastPassFailAAA,t).addEventListener("click",(()=>this._onSuggestColor("aaa")))}}[n,l].forEach((t=>t.addEventListener("click",(t=>S._showHelp())))),this._element.classList.toggle("contrast-fail",!this._passesAA),this._contrastValueBubble.classList.toggle("contrast-aa",this._passesAA),this._contrastValueBubble.classList.toggle("contrast-aaa",r)}static _showHelp(){a.InspectorFrontendHostInstance.openInNewTab(_.addReferrerToURL("https://web.dev/color-and-contrast-accessibility/"))}setVisible(t){this._visible=t,this._element.classList.toggle("hidden",!t)}visible(){return this._visible}element(){return this._element}_expandButtonClicked(t){const e=this._contrastValueBubble.getComponentSelection();e&&e.empty(),this._toggleExpanded()}_topRowClicked(t){const e=this._contrastValueBubble.getComponentSelection();e&&e.empty(),this._toggleExpanded(),t.consume(!0)}_toggleExpanded(){this._expanded=!this._expanded,u.setExpanded(this._expandButton.element,this._expanded),this._element.classList.toggle("collapsed",!this._expanded),this._expanded?(this._toggleMainColorPicker(!1),this._expandButton.setGlyph("smallicon-expand-less"),this._expandButton.setTitle(B(P.showLess)),this._contrastUnknown&&this._toggleBackgroundColorPicker(!0)):(this._toggleBackgroundColorPicker(!1),this._expandButton.setGlyph("smallicon-expand-more"),this._expandButton.setTitle(B(P.showMore))),this._expandedChangedCallback()}collapse(){this._element.classList.remove("expanded"),this._toggleBackgroundColorPicker(!1),this._toggleMainColorPicker(!1)}expanded(){return this._expanded}backgroundColorPickerEnabled(){return this._bgColorPickerButton.toggled()}toggleBackgroundColorPicker(t){this._toggleBackgroundColorPicker(t,!1)}_toggleBackgroundColorPicker(t,e=!0){void 0===t&&(t=!this._bgColorPickerButton.toggled()),this._bgColorPickerButton.setToggled(t),e&&this.dispatchEventToListeners(k.BackgroundColorPickerWillBeToggled,t),a.InspectorFrontendHostInstance.setEyeDropperActive(t),t?a.InspectorFrontendHostInstance.events.addEventListener(r.Events.EyeDropperPickedColor,this._bgColorPickedBound):a.InspectorFrontendHostInstance.events.removeEventListener(r.Events.EyeDropperPickedColor,this._bgColorPickedBound)}_bgColorPicked(t){const e=t.data,s=[e.r,e.g,e.b,(e.a/2.55|0)/100],i=o.Color.fromRGBA(s);this._contrastInfo.setBgColor(i),this._toggleBackgroundColorPicker(!1),a.InspectorFrontendHostInstance.bringToFront()}}const k={BackgroundColorPickerWillBeToggled:Symbol("BackgroundColorPickerWillBeToggled")};class x{constructor(t){this._parentElement=t,this._swatchElement=t.createChild("span","swatch contrast swatch-inner-white"),this._swatchInnerElement=this._swatchElement.createChild("span","swatch-inner"),this._textPreview=this._swatchElement.createChild("div","text-preview"),this._textPreview.textContent="Aa"}setColors(t,e){this._textPreview.style.color=t.asString(o.Format.RGBA),this._swatchInnerElement.style.backgroundColor=e.asString(o.Format.RGBA),this._swatchElement.classList.toggle("swatch-inner-white",e.hsla()[2]>.9)}}var I=Object.freeze({__proto__:null,UIStrings:P,ContrastDetails:S,Events:k,Swatch:x});class y{constructor(t,e){this._contrastInfo=t,this._visible=!1,this._contrastRatioSVG=_.createSVGChild(e,"svg","spectrum-contrast-container fill"),this._contrastRatioLines=new Map,d.experiments.isEnabled("APCA")?this._contrastRatioLines.set("APCA",_.createSVGChild(this._contrastRatioSVG,"path","spectrum-contrast-line")):(this._contrastRatioLines.set("aa",_.createSVGChild(this._contrastRatioSVG,"path","spectrum-contrast-line")),this._contrastRatioLines.set("aaa",_.createSVGChild(this._contrastRatioSVG,"path","spectrum-contrast-line"))),this._width=0,this._height=0,this._contrastRatioLineBuilder=new L(this._contrastInfo),this._contrastRatioLinesThrottler=new s.Throttler(0),this._drawContrastRatioLinesBound=this._drawContrastRatioLines.bind(this),this._contrastInfo.addEventListener(v.ContrastInfoUpdated,this._update.bind(this))}_update(){this._visible&&!this._contrastInfo.isNull()&&(d.experiments.isEnabled("APCA")&&null===this._contrastInfo.contrastRatioAPCA()||this._contrastInfo.contrastRatio()&&this._contrastRatioLinesThrottler.schedule(this._drawContrastRatioLinesBound))}setDimensions(t,e){this._width=t,this._height=e,this._update()}setVisible(t){this._visible=t,this._contrastRatioSVG.classList.toggle("hidden",!t),this._update()}async _drawContrastRatioLines(){for(const[t,e]of this._contrastRatioLines){const o=this._contrastRatioLineBuilder.drawContrastRatioLine(this._width,this._height,t);o?e.setAttribute("d",o):e.removeAttribute("d")}}}class L{constructor(t){this._contrastInfo=t}drawContrastRatioLine(t,s,i){const n=d.experiments.isEnabled("APCA")?this._contrastInfo.contrastRatioAPCAThreshold():this._contrastInfo.contrastRatioThreshold(i);if(!t||!s||null===n)return null;const a=.02,r=this._contrastInfo.color(),l=this._contrastInfo.bgColor();if(!r||!l)return null;const h=r.rgba(),c=r.hsva(),_=l.rgba(),C=e.luminance(_);let g=e.blendColors(h,_);const u=e.luminance(g)>C,p=d.experiments.isEnabled("APCA")?e.desiredLuminanceAPCA(C,n,u):o.Color.desiredLuminance(C,n,u);let m=c[2],b=0;const E=[c[0],0,0,c[3]];let A=[];const f=[];o.Color.hsva2rgba(E,f),g=e.blendColors(f,_);let v,F=t=>e.luminance(e.blendColors(o.Color.fromHSVA(t).rgba(),_));for(d.experiments.isEnabled("APCA")&&(F=t=>e.luminanceAPCA(e.blendColors(o.Color.fromHSVA(t).rgba(),_))),v=0;v<1.02;v+=a){v=Math.min(1,v),E[1]=v,E[2]=m+b*a;const e=o.Color.approachColorValue(E,_,2,p,F);if(null===e)break;b=0===v?0:(e-m)/a,m=e,A.push(A.length?"L":"M"),A.push((v*t).toFixed(2)),A.push(((1-e)*s).toFixed(2))}return v<1.02&&(v-=a,E[2]=1,v=o.Color.approachColorValue(E,_,1,p,F),null!==v&&(A=A.concat(["L",(v*t).toFixed(2),"-0.1"]))),0===A.length?null:A.join(" ")}}var D=Object.freeze({__proto__:null,ContrastOverlay:y,ContrastRatioLineBuilder:L});const T={toggleColorPicker:"Toggle color picker",changeHue:"Change hue",changeAlpha:"Change alpha",hex:"HEX",changeColorFormat:"Change color format",previewPalettes:"Preview palettes",addToPalette:"Add to palette",colorPalettes:"Color Palettes",returnToColorPicker:"Return to color picker",colorS:"Color {PH1}",longclickOrLongpressSpaceToShow:"Long-click or long-press space to show alternate shades of {PH1}",removeColor:"Remove color",removeAllToTheRight:"Remove all to the right",clearPalette:"Clear palette",sInS:"{PH1} in {PH2}",copyColorToClipboard:"Copy color to clipboard",pressArrowKeysMessage:"Press arrow keys with or without modifiers to move swatch position. Arrow key with Shift key moves position largely, with Ctrl key it is less and with Alt key it is even less"},H=l.registerUIStrings("color_picker/Spectrum.js",T),R=l.getLocalizedString.bind(void 0,H),V=new WeakMap,M=new WeakMap;class O extends m.VBox{constructor(t){function e(t){const e=_.createSVGChild(t,"svg");e.setAttribute("height",String(16)),e.setAttribute("width",String(16));return _.createSVGChild(e,"path").setAttribute("d","M5,6 L11,6 L8,2 Z M5,10 L11,10 L8,14 Z"),e}super(!0),this.registerRequiredCSS("color_picker/spectrum.css",{enableLegacyPatching:!0}),this.contentElement.tabIndex=0,this._colorElement=this.contentElement.createChild("div","spectrum-color"),this._colorElement.tabIndex=0,this.setDefaultFocusedElement(this._colorElement),this._colorElement.addEventListener("keydown",this._onSliderKeydown.bind(this,p.bind(this)));const o=R(T.pressArrowKeysMessage);u.setAccessibleName(this._colorElement,o),u.markAsApplication(this._colorElement),this._colorDragElement=this._colorElement.createChild("div","spectrum-sat fill").createChild("div","spectrum-val fill").createChild("div","spectrum-dragger"),this._dragX=0,this._dragY=0;const s=this.contentElement.createChild("div","spectrum-tools"),i=new g.Toolbar("spectrum-eye-dropper",s);this._colorPickerButton=new g.ToolbarToggle(R(T.toggleColorPicker),"largeicon-eyedropper"),this._colorPickerButton.setToggled(!0),this._colorPickerButton.addEventListener(g.ToolbarButton.Events.Click,this._toggleColorPicker.bind(this,void 0)),i.appendToolbarItem(this._colorPickerButton),this._swatch=new q(s),this._hueElement=s.createChild("div","spectrum-hue"),this._hueElement.tabIndex=0,this._hueElement.addEventListener("keydown",this._onSliderKeydown.bind(this,d.bind(this))),u.setAccessibleName(this._hueElement,R(T.changeHue)),u.markAsSlider(this._hueElement,0,360),this._hueSlider=this._hueElement.createChild("div","spectrum-slider"),this._alphaElement=s.createChild("div","spectrum-alpha"),this._alphaElement.tabIndex=0,this._alphaElement.addEventListener("keydown",this._onSliderKeydown.bind(this,C.bind(this))),u.setAccessibleName(this._alphaElement,R(T.changeAlpha)),u.markAsSlider(this._alphaElement,0,1),this._alphaElementBackground=this._alphaElement.createChild("div","spectrum-alpha-background"),this._alphaSlider=this._alphaElement.createChild("div","spectrum-slider"),this._displayContainer=s.createChild("div","spectrum-text source-code"),u.markAsPoliteLiveRegion(this._displayContainer,!0),this._textValues=[];for(let t=0;t<4;++t){const t=_.createInput("spectrum-text-value");this._displayContainer.appendChild(t),t.maxLength=4,this._textValues.push(t),t.addEventListener("keydown",this._inputChanged.bind(this),!1),t.addEventListener("input",this._inputChanged.bind(this),!1),t.addEventListener("wheel",this._inputChanged.bind(this),!1),t.addEventListener("paste",this._pasted.bind(this),!1)}this._textLabels=this._displayContainer.createChild("div","spectrum-text-label"),this._hexContainer=s.createChild("div","spectrum-text spectrum-text-hex source-code"),u.markAsPoliteLiveRegion(this._hexContainer,!0),this._hexValue=_.createInput("spectrum-text-value"),this._hexContainer.appendChild(this._hexValue),this._hexValue.maxLength=9,this._hexValue.addEventListener("keydown",this._inputChanged.bind(this),!1),this._hexValue.addEventListener("input",this._inputChanged.bind(this),!1),this._hexValue.addEventListener("wheel",this._inputChanged.bind(this),!1),this._hexValue.addEventListener("paste",this._pasted.bind(this),!1);const n=this._hexContainer.createChild("div","spectrum-text-label");n.textContent=R(T.hex),u.setAccessibleName(this._hexValue,n.textContent);const a=s.createChild("div","spectrum-display-switcher spectrum-switcher");e(a),_.setTitle(a,R(T.changeColorFormat)),a.tabIndex=0,self.onInvokeElement(a,(t=>{this._formatViewSwitch(),t.consume(!0)})),u.markAsButton(a),_.installDragHandle(this._hueElement,this._dragStart.bind(this,d.bind(this)),d.bind(this),null,"pointer","default"),_.installDragHandle(this._alphaElement,this._dragStart.bind(this,C.bind(this)),C.bind(this),null,"pointer","default"),_.installDragHandle(this._colorElement,this._dragStart.bind(this,p.bind(this)),p.bind(this),null,"pointer","default"),t&&(this._contrastInfo=t,this._contrastOverlay=new y(this._contrastInfo,this._colorElement),this._contrastDetails=new S(this._contrastInfo,this.contentElement,this._toggleColorPicker.bind(this),this._contrastPanelExpanded.bind(this),this.colorSelected.bind(this)),this._contrastDetailsBackgroundColorPickedToggledBound=this._contrastDetailsBackgroundColorPickedToggled.bind(this)),this.element.classList.add("flex-none"),this._palettes=new Map,this._palettePanel=this.contentElement.createChild("div","palette-panel"),this._palettePanelShowing=!1,this._paletteSectionContainer=this.contentElement.createChild("div","spectrum-palette-container"),this._paletteContainer=this._paletteSectionContainer.createChild("div","spectrum-palette"),this._paletteContainer.addEventListener("contextmenu",this._showPaletteColorContextMenu.bind(this,-1)),this._shadesContainer=this.contentElement.createChild("div","palette-color-shades hidden"),_.installDragHandle(this._paletteContainer,this._paletteDragStart.bind(this),this._paletteDrag.bind(this),this._paletteDragEnd.bind(this),"default");const r=this._paletteSectionContainer.createChild("div","spectrum-palette-switcher spectrum-switcher");e(r),_.setTitle(r,R(T.previewPalettes)),u.markAsButton(r),r.tabIndex=0,self.onInvokeElement(r,(t=>{this._togglePalettePanel(!0),t.consume(!0)})),this._deleteIconToolbar=new g.Toolbar("delete-color-toolbar"),this._deleteButton=new g.ToolbarButton("","largeicon-trash-bin"),this._deleteIconToolbar.appendToolbarItem(this._deleteButton);this.contentElement.createChild("div","spectrum-overlay fill").addEventListener("click",this._togglePalettePanel.bind(this,!1)),this._addColorToolbar=new g.Toolbar("add-color-toolbar");const l=new g.ToolbarButton(R(T.addToPalette),"largeicon-add");function c(t,e){const o=e,s=t.getBoundingClientRect();switch(o.key){case"ArrowLeft":case"ArrowDown":return s.left-1;case"ArrowRight":case"ArrowUp":return s.right+1;default:return e.x}}function d(t){const e=this._hsv.slice(),o=1-(c(this._hueSlider,t)-this._hueElement.getBoundingClientRect().left)/this._hueAlphaWidth;e[0]=h.clamp(o,0,1),this._innerSetColor(e,"",void 0,void 0,N.Other);const s=this._color().canonicalHSLA();u.setValueNow(this._hueElement,s[0])}function C(t){const e=this._hsv.slice(),o=(c(this._alphaSlider,t)-this._hueElement.getBoundingClientRect().left)/this._hueAlphaWidth,s=Math.round(100*o)/100;e[3]=h.clamp(s,0,1),this._innerSetColor(e,"",void 0,void 0,N.Other);const i=this._color().canonicalHSLA();u.setValueText(this._alphaElement,i[3])}function p(t){const e=this._hsv.slice(),o=function(t,e){const o=t.getBoundingClientRect(),s=o.x+o.width/2,i=o.y+o.width/2,n=function(t,e){const o=e;o.altKey?t=1:o.ctrlKey?t=10:o.shiftKey&&(t=20);return t}(o.width/4,e);switch(e.key){case"ArrowLeft":return{x:o.left-n,y:i};case"ArrowRight":return{x:o.right+n,y:i};case"ArrowDown":return{x:s,y:o.bottom+n};case"ArrowUp":return{x:s,y:o.top-n};default:return{x:e.x,y:e.y}}}(this._colorDragElement,t);this._colorOffset=this._colorElement.totalOffset(),e[1]=h.clamp((o.x-this._colorOffset.left)/this.dragWidth,0,1),e[2]=h.clamp(1-(o.y-this._colorOffset.top)/this.dragHeight,0,1),this._innerSetColor(e,"",void 0,void 0,N.Other)}l.addEventListener(g.ToolbarButton.Events.Click,this._onAddColorMousedown.bind(this)),l.element.addEventListener("keydown",this._onAddColorKeydown.bind(this)),this._addColorToolbar.appendToolbarItem(l),this._colorPickedBound=this._colorPicked.bind(this),this._hsv,this._hueAlphaWidth,this.dragWidth,this.dragHeight,this._colorDragElementHeight,this.slideHelperWidth,this._numPaletteRowsShown=-1,this._loadPalettes(),this._selectedColorPalette,this._customPaletteSetting,new K((t=>{t.colors.length?this.addPalette(t):this._selectedColorPalette.get()===t.title&&this._paletteSelected(z)}))}_dragStart(t,e){return this._colorOffset=this._colorElement.totalOffset(),t(e),!0}_contrastDetailsBackgroundColorPickedToggled(t){t.data&&this._toggleColorPicker(!1)}_contrastPanelExpanded(){this._contrastOverlay&&this._contrastDetails&&(this._contrastOverlay.setVisible(this._contrastDetails.expanded()),this._resizeForSelectedPalette(!0))}_updatePalettePanel(){this._palettePanel.removeChildren();this._palettePanel.createChild("div","palette-title").textContent=R(T.colorPalettes);const t=new g.Toolbar("",this._palettePanel);this._closeButton=new g.ToolbarButton(R(T.returnToColorPicker),"largeicon-delete"),this._closeButton.addEventListener(g.ToolbarButton.Events.Click,this._togglePalettePanel.bind(this,!1)),this._closeButton.element.addEventListener("keydown",this._onCloseBtnKeydown.bind(this)),t.appendToolbarItem(this._closeButton);for(const t of this._palettes.values())this._palettePanel.appendChild(this._createPreviewPaletteElement(t))}_togglePalettePanel(t){this._palettePanelShowing!==t&&(t&&this._updatePalettePanel(),this._palettePanelShowing=t,this.contentElement.classList.toggle("palette-panel-showing",t),this._focus())}_onCloseBtnKeydown(t){(isEscKey(t)||isEnterOrSpaceKey(t))&&(this._togglePalettePanel(!1),t.consume(!0))}_onSliderKeydown(t,e){switch(e.key){case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":t(e),e.consume(!0)}}_focus(){this.isShowing()&&(this._palettePanelShowing&&this._closeButton?this._closeButton.element.focus({preventScroll:!0}):this.contentElement.focus())}_createPaletteColor(t,e,o){const s=document.createElement("div");return s.classList.add("spectrum-palette-color"),s.style.background=c.sprintf("linear-gradient(%s, %s), url(Images/checker.png)",t,t),o&&s.animate([{opacity:0},{opacity:1}],{duration:100,delay:o,fill:"backwards"}),p.Tooltip.install(s,e||t),s}_showPalette(t,e,o){this._resizeForSelectedPalette(),this._paletteContainer.removeChildren();for(let o=0;o<t.colors.length;o++){const s=e?100*o/t.colors.length:0,i=this._createPaletteColor(t.colors[o],t.colorNames[o],s);if(u.markAsButton(i),u.setAccessibleName(i,R(T.colorS,{PH1:t.colors[o]})),i.tabIndex=-1,i.addEventListener("mousedown",this._paletteColorSelected.bind(this,t.colors[o],t.colorNames[o],Boolean(t.matchUserFormat))),i.addEventListener("focus",this._paletteColorSelected.bind(this,t.colors[o],t.colorNames[o],Boolean(t.matchUserFormat))),i.addEventListener("keydown",this._onPaletteColorKeydown.bind(this,o)),t.mutable)V.set(i,!0),M.set(i,t.colors[o]),i.addEventListener("contextmenu",this._showPaletteColorContextMenu.bind(this,o));else if(t===z){i.classList.add("has-material-shades");let e=i.createChild("div","spectrum-palette-color spectrum-palette-color-shadow");e.style.background=t.colors[o],e=i.createChild("div","spectrum-palette-color spectrum-palette-color-shadow"),e.style.background=t.colors[o],p.Tooltip.install(i,R(T.longclickOrLongpressSpaceToShow,{PH1:t.colors[o]})),u.setAccessibleName(i,p.Tooltip.getContent(i)),new _.LongClickController(i,this._showLightnessShades.bind(this,i,t.colors[o]))}this._paletteContainer.appendChild(i)}this._paletteContainer.childNodes.length>0&&(this._paletteContainer.childNodes[0].tabIndex=0),this._paletteContainerMutable=t.mutable,t.mutable?(this._paletteContainer.appendChild(this._addColorToolbar.element),this._paletteContainer.appendChild(this._deleteIconToolbar.element)):(this._addColorToolbar.element.remove(),this._deleteIconToolbar.element.remove()),this._togglePalettePanel(!1),this._focus()}_showLightnessShades(t,e,o){this._shadesCloseHandler&&this._shadesCloseHandler(),this._shadesContainer.classList.remove("hidden"),this._shadesContainer.removeChildren(),this._shadesContainer.animate([{transform:"scaleY(0)",opacity:"0"},{transform:"scaleY(1)",opacity:"1"}],{duration:200,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});let s=this._paletteContainer.offsetTop+t.offsetTop+(t.parentElement?t.parentElement.offsetTop:0);this._contrastDetails&&(s+=this._contrastDetails.element().offsetHeight),this._shadesContainer.style.top=s+"px",this._shadesContainer.style.left=t.offsetLeft+"px",t.classList.add("spectrum-shades-shown");const i=j[e];for(let e=i.length-1;e>=0;e--){const o=this._createPaletteColor(i[e],void 0,200*e/i.length+100);u.markAsButton(o),u.setAccessibleName(o,R(T.colorS,{PH1:i[e]})),o.tabIndex=-1,o.addEventListener("mousedown",this._paletteColorSelected.bind(this,i[e],i[e],!1)),o.addEventListener("focus",this._paletteColorSelected.bind(this,i[e],i[e],!1)),o.addEventListener("keydown",this._onShadeColorKeydown.bind(this,t)),this._shadesContainer.appendChild(o)}this._shadesContainer.childNodes.length>0&&this._shadesContainer.childNodes[this._shadesContainer.childNodes.length-1].focus(),this._shadesCloseHandler=function(t){this._shadesContainer.classList.add("hidden"),t.classList.remove("spectrum-shades-shown"),this._shadesCloseHandler&&this._shadesContainer.ownerDocument.removeEventListener("mousedown",this._shadesCloseHandler,!0),delete this._shadesCloseHandler}.bind(this,t),this._shadesContainer.ownerDocument.addEventListener("mousedown",this._shadesCloseHandler,!0)}_slotIndexForEvent(t){const e=t,o=e.pageX-this._paletteContainer.totalOffsetLeft(),s=e.pageY-this._paletteContainer.totalOffsetTop(),i=Math.min(o/W|0,G-1),n=s/W|0;return Math.min(n*G+i,this._customPaletteSetting.get().colors.length-1)}_isDraggingToBin(t){return t.pageX>this._deleteIconToolbar.element.totalOffsetLeft()}_paletteDragStart(t){const e=_.deepElementFromEvent(t);if(!e||!V.get(e))return!1;const o=this._slotIndexForEvent(t);this._dragElement=e;const s=t;return this._dragHotSpotX=s.pageX-o%G*W,this._dragHotSpotY=s.pageY-(o/G|0)*W,!0}_paletteDrag(t){const e=t;if(e.pageX<this._paletteContainer.totalOffsetLeft()||e.pageY<this._paletteContainer.totalOffsetTop())return;if(!this._dragElement||void 0===this._dragHotSpotX||void 0===this._dragHotSpotY)return;const o=this._slotIndexForEvent(t),s=e.pageX-o%G*W,i=e.pageY-(o/G|0)*W,n=this._isDraggingToBin(t);this._deleteIconToolbar.element.classList.add("dragging"),this._deleteIconToolbar.element.classList.toggle("delete-color-toolbar-active",n);const a="translateX("+(s-this._dragHotSpotX)+"px) translateY("+(i-this._dragHotSpotY)+"px)";this._dragElement.style.transform=n?a+" scale(0.8)":a;const r=Array.prototype.slice.call(this._paletteContainer.children),l=r.indexOf(this._dragElement),h=new Map;for(const t of r)h.set(t,t.totalOffset());l!==o&&this._paletteContainer.insertBefore(this._dragElement,r[o>l?o+1:o]);for(const t of r){if(t===this._dragElement)continue;const e=h.get(t),o=t.totalOffset();!e||e.left===o.left&&e.top===o.top||t.animate([{transform:"translateX("+(e.left-o.left)+"px) translateY("+(e.top-o.top)+"px)"},{transform:"none"}],{duration:100,easing:"cubic-bezier(0, 0, 0.2, 1)"})}}_paletteDragEnd(t){if(!this._dragElement)return;this._isDraggingToBin(t)&&this._dragElement.remove(),this._dragElement.style.removeProperty("transform");const e=this._paletteContainer.children,o=[];for(let t=0;t<e.length;++t){const s=M.get(e[t]);s&&o.push(s)}const s=this._customPaletteSetting.get();s.colors=o,this._customPaletteSetting.set(s),this._showPalette(s,!1),this._deleteIconToolbar.element.classList.remove("dragging"),this._deleteIconToolbar.element.classList.remove("delete-color-toolbar-active")}_loadPalettes(){this._palettes.set(z.title,z);const t={title:"Custom",colors:[],colorNames:[],mutable:!0,matchUserFormat:void 0};this._customPaletteSetting=i.Settings.instance().createSetting("customColorPalette",t);const e=this._customPaletteSetting.get();e.colorNames=e.colorNames||[],this._palettes.set(e.title,e),this._selectedColorPalette=i.Settings.instance().createSetting("selectedColorPalette",U);const o=this._palettes.get(this._selectedColorPalette.get());o&&this._showPalette(o,!0)}addPalette(t){this._palettes.set(t.title,t),this._selectedColorPalette.get()===t.title&&this._showPalette(t,!0)}_createPreviewPaletteElement(t){const e=document.createElement("div");e.classList.add("palette-preview"),u.markAsButton(e),e.tabIndex=0;let o;for(e.createChild("div","palette-preview-title").textContent=t.title,o=0;o<5&&o<t.colors.length;o++)e.appendChild(this._createPaletteColor(t.colors[o],t.colorNames[o]));for(;o<5;o++)e.createChild("div","spectrum-palette-color empty-color");return self.onInvokeElement(e,(e=>{this._paletteSelected(t),e.consume(!0)})),e}_paletteSelected(t){this._selectedColorPalette.set(t.title),this._showPalette(t,!0)}_resizeForSelectedPalette(t){const e=this._palettes.get(this._selectedColorPalette.get());if(!e)return;let o=e.colors.length;e===this._customPaletteSetting.get()&&o++;const s=Math.max(1,Math.ceil(o/G));if(this._numPaletteRowsShown===s&&!t)return;this._numPaletteRowsShown=s;let i=236;this._contrastDetails&&(this._contrastDetails.expanded()?i+=78:i+=36),this.element.style.height=i+12+24*s+"px",this.dispatchEventToListeners(X.SizeChanged)}_paletteColorSelected(t,e,s){const i=o.Color.parse(t);i&&this._innerSetColor(i.hsva(),t,e,s?this._colorFormat:i.format(),N.Other)}_onPaletteColorKeydown(t,e){let o;switch(e.key){case"ArrowLeft":o=t-1;break;case"ArrowRight":o=t+1;break;case"ArrowUp":o=t-G;break;case"ArrowDown":o=t+G}void 0!==o&&o>-1&&o<this._paletteContainer.childNodes.length&&this._paletteContainer.childNodes[o].focus()}_onShadeColorKeydown(t,e){const o=e,s=o.target;isEscKey(e)||"Tab"===o.key?(t.focus(),this._shadesCloseHandler&&this._shadesCloseHandler(),e.consume(!0)):"ArrowUp"===o.key&&s.previousElementSibling?(s.previousElementSibling.focus(),e.consume(!0)):"ArrowDown"===o.key&&s.nextElementSibling&&(s.nextElementSibling.focus(),e.consume(!0))}_onAddColorMousedown(){this._addColorToCustomPalette()}_onAddColorKeydown(t){isEnterOrSpaceKey(t)&&(this._addColorToCustomPalette(),t.consume(!0))}_addColorToCustomPalette(){const t=this._customPaletteSetting.get();t.colors.push(this.colorString()),this._customPaletteSetting.set(t),this._showPalette(t,!1);const e=this._paletteContainer.querySelectorAll(".spectrum-palette-color");e[e.length-1].focus()}_showPaletteColorContextMenu(t,e){if(!this._paletteContainerMutable)return;const o=new b.ContextMenu(e);-1!==t&&(o.defaultSection().appendItem(R(T.removeColor),this._deletePaletteColors.bind(this,t,!1)),o.defaultSection().appendItem(R(T.removeAllToTheRight),this._deletePaletteColors.bind(this,t,!0))),o.defaultSection().appendItem(R(T.clearPalette),this._deletePaletteColors.bind(this,-1,!0)),o.show()}_deletePaletteColors(t,e){const o=this._customPaletteSetting.get();e?o.colors.splice(t+1,o.colors.length-t-1):o.colors.splice(t,1),this._customPaletteSetting.set(o),this._showPalette(o,!1)}setColor(t,e){this._originalFormat=e,this._innerSetColor(t.hsva(),"",void 0,e,N.Model);const o=this._color().canonicalHSLA();u.setValueNow(this._hueElement,o[0]),u.setValueText(this._alphaElement,o[3])}colorSelected(t){this._innerSetColor(t.hsva(),"",void 0,void 0,N.Other)}_innerSetColor(t,e,s,i,n){if(void 0!==t&&(this._hsv=t),this._colorName=s,void 0!==e&&(this._colorString=e),void 0!==i){const t=o.Format;console.assert(i!==t.Original,"Spectrum's color format cannot be Original"),i===t.RGBA?i=t.RGB:i===t.HSLA?i=t.HSL:i===t.HEXA?i=t.HEX:i===t.ShortHEXA&&(i=t.ShortHEX),this._colorFormat=i}this._contrastInfo&&this._contrastInfo.setColor(o.Color.fromHSVA(this._hsv),this._colorFormat),this._updateHelperLocations(),this._updateUI(),n!==N.Input&&this._updateInput(),n!==N.Model&&this.dispatchEventToListeners(X.ColorChanged,this.colorString())}_color(){return o.Color.fromHSVA(this._hsv)}colorName(){return this._colorName}colorString(){if(this._colorString)return this._colorString;const t=o.Format,e=this._color();let s=e.asString(this._colorFormat);return s||(s=this._colorFormat===t.Nickname?e.asString(e.hasAlpha()?t.HEXA:t.HEX):this._colorFormat===t.ShortHEX?e.asString(e.detectHEXFormat()):this._colorFormat===t.HEX?e.asString(t.HEXA):this._colorFormat===t.HSL?e.asString(t.HSLA):e.asString(t.RGBA),console.assert(Boolean(s)),s||"")}_updateHelperLocations(){const t=this._hsv[0],e=this._hsv[1],o=this._hsv[2],s=this._hsv[3];this._dragX=e*this.dragWidth,this._dragY=this.dragHeight-o*this.dragHeight;const i=Math.max(-this._colorDragElementHeight,Math.min(this.dragWidth-this._colorDragElementHeight,this._dragX-this._colorDragElementHeight)),n=Math.max(-this._colorDragElementHeight,Math.min(this.dragHeight-this._colorDragElementHeight,this._dragY-this._colorDragElementHeight));this._colorDragElement.positionAt(i,n);const a=(1-t)*this._hueAlphaWidth-this.slideHelperWidth;this._hueSlider.style.left=a+"px";const r=s*this._hueAlphaWidth-this.slideHelperWidth;this._alphaSlider.style.left=r+"px"}_updateInput(){const t=o.Format;if(this._colorFormat===t.HEX||this._colorFormat===t.ShortHEX||this._colorFormat===t.Nickname)this._hexContainer.hidden=!1,this._displayContainer.hidden=!0,this._colorFormat===t.ShortHEX?this._hexValue.value=String(this._color().asString(this._color().detectHEXFormat())):this._hexValue.value=String(this._color().asString(this._color().hasAlpha()?t.HEXA:t.HEX));else{this._hexContainer.hidden=!0,this._displayContainer.hidden=!1;const e=this._colorFormat===t.RGB;this._textLabels.textContent=e?"RGBA":"HSLA";const o=e?this._color().canonicalRGBA():this._color().canonicalHSLA();for(let t=0;t<3;++t)u.setAccessibleName(this._textValues[t],R(T.sInS,{PH1:this._textLabels.textContent.charAt(t),PH2:this._textLabels.textContent})),this._textValues[t].value=String(o[t]),e||1!==t&&2!==t||(this._textValues[t].value+="%");u.setAccessibleName(this._textValues[3],R(T.sInS,{PH1:this._textLabels.textContent.charAt(3),PH2:this._textLabels.textContent})),this._textValues[3].value=String(Math.round(100*o[3])/100)}}_updateUI(){const t=o.Color.fromHSVA([this._hsv[0],1,1,1]);this._colorElement.style.backgroundColor=t.asString(o.Format.RGB),this._contrastOverlay&&this._contrastOverlay.setDimensions(this.dragWidth,this.dragHeight),this._swatch.setColor(this._color(),this.colorString()),this._colorDragElement.style.backgroundColor=this._color().asString(o.Format.RGBA);const e=o.Color.fromHSVA(this._hsv.slice(0,3).concat(1));this._alphaElementBackground.style.backgroundImage=c.sprintf("linear-gradient(to right, rgba(0,0,0,0), %s)",e.asString(o.Format.RGB))}_formatViewSwitch(){const t=o.Format;let e=t.RGB;this._colorFormat===t.RGB?e=t.HSL:this._colorFormat===t.HSL&&(e=this._originalFormat===t.ShortHEX||this._originalFormat===t.ShortHEXA?t.ShortHEX:t.HEX),this._innerSetColor(void 0,"",void 0,e,N.Other)}_pasted(t){if(!t.clipboardData)return;const e=t.clipboardData.getData("text"),s=o.Color.parse(e);s&&(this._innerSetColor(s.hsva(),e,void 0,void 0,N.Other),t.preventDefault())}_inputChanged(t){function e(t){return t.value}const s=t.currentTarget,i=_.createReplacementString(s.value,t);i&&(s.value=i,s.selectionStart=0,s.selectionEnd=i.length,t.consume(!0));const n=o.Format;let a;if(this._colorFormat===n.Nickname||this._colorFormat===n.HEX||this._colorFormat===n.ShortHEX)a=this._hexValue.value;else{const t=this._colorFormat===n.RGB?"rgb":"hsl",o=this._textValues.slice(0,-1).map(e).join(" "),s=this._textValues.slice(-1).map(e).join(" ");a=c.sprintf("%s(%s)",t,[o,s].join(" / "))}const r=o.Color.parse(a);if(!r)return;let l=void 0;this._colorFormat!==n.HEX&&this._colorFormat!==n.ShortHEX||(l=r.detectHEXFormat()),this._innerSetColor(r.hsva(),a,void 0,l,N.Input)}wasShown(){this._hueAlphaWidth=this._hueElement.offsetWidth,this.slideHelperWidth=this._hueSlider.offsetWidth/2,this.dragWidth=this._colorElement.offsetWidth,this.dragHeight=this._colorElement.offsetHeight,this._colorDragElementHeight=this._colorDragElement.offsetHeight/2,this._innerSetColor(void 0,void 0,void 0,void 0,N.Model),this._toggleColorPicker(!0),this._contrastDetails&&this._contrastDetailsBackgroundColorPickedToggledBound&&this._contrastDetails.addEventListener(k.BackgroundColorPickerWillBeToggled,this._contrastDetailsBackgroundColorPickedToggledBound)}willHide(){this._toggleColorPicker(!1),this._contrastDetails&&this._contrastDetailsBackgroundColorPickedToggledBound&&this._contrastDetails.removeEventListener(k.BackgroundColorPickerWillBeToggled,this._contrastDetailsBackgroundColorPickedToggledBound)}_toggleColorPicker(t,e){void 0===t&&(t=!this._colorPickerButton.toggled()),this._colorPickerButton.setToggled(t),this._contrastDetails&&t&&this._contrastDetails.backgroundColorPickerEnabled()&&this._contrastDetails.toggleBackgroundColorPicker(!1),a.InspectorFrontendHostInstance.setEyeDropperActive(t),t?a.InspectorFrontendHostInstance.events.addEventListener(r.Events.EyeDropperPickedColor,this._colorPickedBound):a.InspectorFrontendHostInstance.events.removeEventListener(r.Events.EyeDropperPickedColor,this._colorPickedBound)}_colorPicked(t){const e=t.data,s=[e.r,e.g,e.b,(e.a/2.55|0)/100],i=o.Color.fromRGBA(s);this._innerSetColor(i.hsva(),"",void 0,void 0,N.Other),a.InspectorFrontendHostInstance.bringToFront()}}const N={Input:"Input",Model:"Model",Other:"Other"},X={ColorChanged:Symbol("ColorChanged"),SizeChanged:Symbol("SizeChanged")},W=24,G=8,U="Page colors";class K{constructor(t){this._callback=t,this._frequencyMap=new Map;const e=[];for(const t of E.TargetManager.instance().models(A.CSSModel))for(const o of t.allStyleSheets())e.push(this._processStylesheet(o));Promise.all(e).catch((t=>{console.error(t)})).then(this._finish.bind(this))}_frequencyComparator(t,e){return this._frequencyMap.get(e)-this._frequencyMap.get(t)}_finish(){let t=[...this._frequencyMap.keys()];t=t.sort(this._frequencyComparator.bind(this));const e=new Map;for(;e.size<24&&t.length;){const s=t.shift(),i=o.Color.parse(s);i&&"white"!==i.nickname()&&"black"!==i.nickname()&&e.set(s,i)}this._callback({title:U,colors:[...e.keys()].sort((function(t,o){const s=e.get(t).hsva(),i=e.get(o).hsva();return i[1]<.12&&s[1]<.12?i[2]*i[3]-s[2]*s[3]:i[1]<.12?-1:s[1]<.12?1:i[0]===s[0]?i[1]*i[3]-s[1]*s[3]:(i[0]+.94)%1-(s[0]+.94)%1})),colorNames:[],mutable:!1,matchUserFormat:void 0})}async _processStylesheet(t){let e=(await t.requestContent()).content||"";e=e.toLowerCase();const o=e.match(/((?:rgb|hsl)a?\([^)]+\)|#[0-9a-f]{6}|#[0-9a-f]{3})/g)||[];for(const t of o){let e=this._frequencyMap.get(t)||0;this._frequencyMap.set(t,++e)}}}const j={"#F44336":["#FFEBEE","#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#D32F2F","#C62828","#B71C1C"],"#E91E63":["#FCE4EC","#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#C2185B","#AD1457","#880E4F"],"#9C27B0":["#F3E5F5","#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#7B1FA2","#6A1B9A","#4A148C"],"#673AB7":["#EDE7F6","#D1C4E9","#B39DDB","#9575CD","#7E57C2","#673AB7","#5E35B1","#512DA8","#4527A0","#311B92"],"#3F51B5":["#E8EAF6","#C5CAE9","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E"],"#2196F3":["#E3F2FD","#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0","#0D47A1"],"#03A9F4":["#E1F5FE","#B3E5FC","#81D4FA","#4FC3F7","#29B6F6","#03A9F4","#039BE5","#0288D1","#0277BD","#01579B"],"#00BCD4":["#E0F7FA","#B2EBF2","#80DEEA","#4DD0E1","#26C6DA","#00BCD4","#00ACC1","#0097A7","#00838F","#006064"],"#009688":["#E0F2F1","#B2DFDB","#80CBC4","#4DB6AC","#26A69A","#009688","#00897B","#00796B","#00695C","#004D40"],"#4CAF50":["#E8F5E9","#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32","#1B5E20"],"#8BC34A":["#F1F8E9","#DCEDC8","#C5E1A5","#AED581","#9CCC65","#8BC34A","#7CB342","#689F38","#558B2F","#33691E"],"#CDDC39":["#F9FBE7","#F0F4C3","#E6EE9C","#DCE775","#D4E157","#CDDC39","#C0CA33","#AFB42B","#9E9D24","#827717"],"#FFEB3B":["#FFFDE7","#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FFEB3B","#FDD835","#FBC02D","#F9A825","#F57F17"],"#FFC107":["#FFF8E1","#FFECB3","#FFE082","#FFD54F","#FFCA28","#FFC107","#FFB300","#FFA000","#FF8F00","#FF6F00"],"#FF9800":["#FFF3E0","#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FF9800","#FB8C00","#F57C00","#EF6C00","#E65100"],"#FF5722":["#FBE9E7","#FFCCBC","#FFAB91","#FF8A65","#FF7043","#FF5722","#F4511E","#E64A19","#D84315","#BF360C"],"#795548":["#EFEBE9","#D7CCC8","#BCAAA4","#A1887F","#8D6E63","#795548","#6D4C41","#5D4037","#4E342E","#3E2723"],"#9E9E9E":["#FAFAFA","#F5F5F5","#EEEEEE","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#212121"],"#607D8B":["#ECEFF1","#CFD8DC","#B0BEC5","#90A4AE","#78909C","#607D8B","#546E7A","#455A64","#37474F","#263238"]},z={title:"Material",mutable:!1,matchUserFormat:!0,colors:Object.keys(j),colorNames:[]};class q{constructor(t){this._colorString;const e=t.createChild("span","swatch");this._swatchInnerElement=e.createChild("span","swatch-inner"),this._swatchOverlayElement=e.createChild("span","swatch-overlay"),u.markAsButton(this._swatchOverlayElement),u.setPressed(this._swatchOverlayElement,!1),this._swatchOverlayElement.tabIndex=0,self.onInvokeElement(this._swatchOverlayElement,this._onCopyText.bind(this)),this._swatchOverlayElement.addEventListener("mouseout",this._onCopyIconMouseout.bind(this)),this._swatchOverlayElement.addEventListener("blur",this._onCopyIconMouseout.bind(this)),this._swatchCopyIcon=C.Icon.create("largeicon-copy","copy-color-icon"),p.Tooltip.install(this._swatchCopyIcon,R(T.copyColorToClipboard)),this._swatchOverlayElement.appendChild(this._swatchCopyIcon),u.setAccessibleName(this._swatchOverlayElement,this._swatchCopyIcon.title)}setColor(t,e){this._swatchInnerElement.style.backgroundColor=t.asString(o.Format.RGBA),this._swatchInnerElement.classList.toggle("swatch-inner-white",t.hsla()[2]>.9),this._colorString=e||null,this._swatchOverlayElement.hidden=!e}_onCopyText(t){this._swatchCopyIcon.setIconType("largeicon-checkmark"),a.InspectorFrontendHostInstance.copyText(this._colorString),u.setPressed(this._swatchOverlayElement,!0),t.consume()}_onCopyIconMouseout(){this._swatchCopyIcon.setIconType("largeicon-copy"),u.setPressed(this._swatchOverlayElement,!1)}}var Y=Object.freeze({__proto__:null,UIStrings:T,Spectrum:O,ChangeSource:N,Events:X,PaletteGenerator:K,MaterialPaletteShades:j,MaterialPalette:z,Swatch:q,Palette:undefined});export{I as ContrastDetails,F as ContrastInfo,D as ContrastOverlay,Y as Spectrum};
