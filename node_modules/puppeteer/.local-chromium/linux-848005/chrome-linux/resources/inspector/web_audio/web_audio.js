import{ObjectWrapper as e}from"../common/common.js";import{MapUtilities as t,StringUtilities as n}from"../platform/platform.js";import{UIUtils as o,ListModel as d,SoftDropDown as a,Toolbar as i,Utils as s,Fragment as r,ThrottledWidget as h,Widget as c}from"../ui/ui.js";import{SDKModel as l,ResourceTreeModel as u}from"../sdk/sdk.js";import{i18n as p}from"../i18n/i18n.js";const _={In:Symbol("In"),Out:Symbol("Out"),Param:Symbol("Param")};var m=Object.freeze({__proto__:null,PortPadding:4,InputPortRadius:10,AudioParamRadius:5,LeftMarginOfText:12,RightMarginOfText:30,LeftSideTopPadding:5,BottomPaddingWithoutParam:6,BottomPaddingWithParam:8,ArrowHeadSize:12,GraphPadding:20,GraphMargin:20,TotalInputPortHeight:24,TotalOutputPortHeight:24,TotalParamPortHeight:14,NodeLabelFontStyle:"14px Segoe UI, Arial",ParamLabelFontStyle:"12px Segoe UI, Arial",PortTypes:_,Size:undefined,Point:undefined,NodeLayout:undefined,Port:undefined,NodeCreationData:undefined,ParamCreationData:undefined,NodesConnectionData:undefined,NodesDisconnectionData:undefined,NodesDisconnectionDataWithDestination:undefined,NodeParamConnectionData:undefined,NodeParamDisconnectionData:undefined});const g=e=>({x:0,y:15+24*e}),I=(e,t,n)=>{const{width:o,height:d}=t;return{x:o,y:d/2+24*(2*e-n+1)/2}},x=(e,t)=>({x:0,y:t+14*(e+1)-5});var C=Object.freeze({__proto__:null,calculateInputPortXY:g,calculateOutputPortXY:I,calculateParamPortXY:x});class v{constructor(e,t){this.id=e.nodeId,this.type=e.nodeType,this.numberOfInputs=e.numberOfInputs,this.numberOfOutputs=e.numberOfOutputs,this.label=t,this.size={width:0,height:0},this.position=null,this._layout={inputPortSectionHeight:0,outputPortSectionHeight:0,maxTextLength:0,totalHeight:0},this.ports=new Map,this._initialize(e)}_initialize(e){this._updateNodeLayoutAfterAddingNode(e),this._setupInputPorts(),this._setupOutputPorts()}addParamPort(e,t){const n=this.getPortsByType(_.Param).length,{x:o,y:d}=x(n,this._layout.inputPortSectionHeight);this._addPort({id:P(this.id,e),type:_.Param,label:t,x:o,y:d}),this._updateNodeLayoutAfterAddingParam(n+1,t),this._setupOutputPorts()}getPortsByType(e){const t=[];return this.ports.forEach((n=>{n.type===e&&t.push(n)})),t}_updateNodeLayoutAfterAddingNode(e){const t=24*Math.max(1,e.numberOfInputs)+5;this._layout.inputPortSectionHeight=t,this._layout.outputPortSectionHeight=24*e.numberOfOutputs,this._layout.totalHeight=Math.max(t+6,this._layout.outputPortSectionHeight);const n=E(this.label,"14px Segoe UI, Arial");this._layout.maxTextLength=Math.max(this._layout.maxTextLength,n),this._updateNodeSize()}_updateNodeLayoutAfterAddingParam(e,t){const n=this._layout.inputPortSectionHeight+14*e+8;this._layout.totalHeight=Math.max(n,this._layout.outputPortSectionHeight);const o=E(t,"12px Segoe UI, Arial");this._layout.maxTextLength=Math.max(this._layout.maxTextLength,o),this._updateNodeSize()}_updateNodeSize(){this.size={width:Math.ceil(12+this._layout.maxTextLength+30),height:this._layout.totalHeight}}_setupInputPorts(){for(let e=0;e<this.numberOfInputs;e++){const{x:t,y:n}=g(e);this._addPort({id:y(this.id,e),type:_.In,x:t,y:n,label:void 0})}}_setupOutputPorts(){for(let e=0;e<this.numberOfOutputs;e++){const t=b(this.id,e),{x:n,y:o}=I(e,this.size,this.numberOfOutputs);if(this.ports.has(t)){const e=this.ports.get(t);if(!e)throw new Error("Unable to find port with id "+t);e.x=n,e.y=o}else this._addPort({id:t,type:_.Out,x:n,y:o,label:void 0})}}_addPort(e){this.ports.set(e.id,e)}}const y=(e,t)=>`${e}-input-${t||0}`,b=(e,t)=>`${e}-output-${t||0}`,P=(e,t)=>`${e}-param-${t}`;class f{constructor(){this._totalNumberOfNodes=0}generateLabel(e){e.endsWith("Node")&&(e=e.slice(0,e.length-4)),this._totalNumberOfNodes+=1;return`${e} ${this._totalNumberOfNodes}`}}let w;const E=(e,t)=>{if(!w){const e=document.createElement("canvas").getContext("2d");if(!e)throw new Error("Unable to create canvas context.");w=e}const n=w;n.save(),t&&(n.font=t);const d=o.measureTextWidth(n,e);return n.restore(),d};var L=Object.freeze({__proto__:null,NodeView:v,generateInputPortId:y,generateOutputPortId:b,generateParamPortId:P,NodeLabelGenerator:f,measureTextWidth:E});class N{constructor(e,t){const n=S(e,t);if(!n)throw new Error("Unable to generate edge port IDs");const{edgeId:o,sourcePortId:d,destinationPortId:a}=n;this.id=o,this.type=t,this.sourceId=e.sourceId,this.destinationId=e.destinationId,this.sourcePortId=d,this.destinationPortId=a}}const S=(e,t)=>{if(!e.sourceId||!e.destinationId)return console.error("Undefined node message: "+JSON.stringify(e)),null;const n=b(e.sourceId,e.sourceOutputIndex),o=function(e,t){if(t===T.NodeToNode){const t=e;return y(e.destinationId,t.destinationInputIndex)}if(t===T.NodeToParam){const t=e;return P(e.destinationId,t.destinationParamId)}return console.error("Unknown edge type: "+t.toString()),""}(e,t);return{edgeId:`${n}->${o}`,sourcePortId:n,destinationPortId:o}},T={NodeToNode:Symbol("NodeToNode"),NodeToParam:Symbol("NodeToParam")};var M=Object.freeze({__proto__:null,EdgeView:N,generateEdgePortIdsByData:S,EdgeTypes:T});class D extends e.ObjectWrapper{constructor(e){super(),this.contextId=e,this._nodes=new Map,this._edges=new Map,this._outboundEdgeMap=new t.Multimap,this._inboundEdgeMap=new t.Multimap,this._nodeLabelGenerator=new f,this._paramIdToNodeIdMap=new Map}addNode(e){const t=this._nodeLabelGenerator.generateLabel(e.nodeType),n=new v(e,t);this._nodes.set(e.nodeId,n),this._notifyShouldRedraw()}removeNode(e){this._outboundEdgeMap.get(e).forEach((e=>this._removeEdge(e))),this._inboundEdgeMap.get(e).forEach((e=>this._removeEdge(e))),this._nodes.delete(e),this._notifyShouldRedraw()}addParam(e){const t=this.getNodeById(e.nodeId);t?(t.addParamPort(e.paramId,e.paramType),this._paramIdToNodeIdMap.set(e.paramId,e.nodeId),this._notifyShouldRedraw()):console.error("AudioNode should be added before AudioParam")}removeParam(e){this._paramIdToNodeIdMap.delete(e)}addNodeToNodeConnection(e){const t=new N(e,T.NodeToNode);this._addEdge(t)}removeNodeToNodeConnection(e){if(e.destinationId){const t=S(e,T.NodeToNode);if(!t)throw new Error("Unable to generate edge port IDs");const{edgeId:n}=t;this._removeEdge(n)}else this._outboundEdgeMap.get(e.sourceId).forEach((e=>this._removeEdge(e)))}addNodeToParamConnection(e){const t=new N(e,T.NodeToParam);this._addEdge(t)}removeNodeToParamConnection(e){const t=S(e,T.NodeToParam);if(!t)throw new Error("Unable to generate edge port IDs");const{edgeId:n}=t;this._removeEdge(n)}getNodeById(e){return this._nodes.get(e)||null}getNodes(){return this._nodes}getEdges(){return this._edges}getNodeIdByParamId(e){return this._paramIdToNodeIdMap.get(e)||null}_addEdge(e){const t=e.sourceId;this._outboundEdgeMap.hasValue(t,e.id)||(this._edges.set(e.id,e),this._outboundEdgeMap.set(t,e.id),this._inboundEdgeMap.set(e.destinationId,e.id),this._notifyShouldRedraw())}_removeEdge(e){const t=this._edges.get(e);t&&(this._outboundEdgeMap.delete(t.sourceId,e),this._inboundEdgeMap.delete(t.destinationId,e),this._edges.delete(e),this._notifyShouldRedraw())}_notifyShouldRedraw(){this.dispatchEventToListeners(O.ShouldRedraw,this)}}const O={ShouldRedraw:Symbol("ShouldRedraw")};var A=Object.freeze({__proto__:null,GraphView:D,Events:O});class B extends e.ObjectWrapper{constructor(){super(),this._graphMapByContextId=new Map}createContext(e){const t=new D(e);t.addEventListener(O.ShouldRedraw,this._notifyShouldRedraw,this),this._graphMapByContextId.set(e,t)}destroyContext(e){if(!this._graphMapByContextId.has(e))return;const t=this._graphMapByContextId.get(e);t&&(t.removeEventListener(O.ShouldRedraw,this._notifyShouldRedraw,this),this._graphMapByContextId.delete(e))}hasContext(e){return this._graphMapByContextId.has(e)}clearGraphs(){this._graphMapByContextId.clear()}getGraph(e){return this._graphMapByContextId.get(e)||null}_notifyShouldRedraw(e){const t=e.data;this.dispatchEventToListeners(O.ShouldRedraw,t)}}var W=Object.freeze({__proto__:null,GraphManager:B});class R extends l.SDKModel{constructor(e){super(e),this._enabled=!1,this._agent=e.webAudioAgent(),e.registerWebAudioDispatcher(this),l.TargetManager.instance().addModelListener(u.ResourceTreeModel,u.Events.FrameNavigated,this._flushContexts,this)}_flushContexts(){this.dispatchEventToListeners("ModelReset")}async suspendModel(){this.dispatchEventToListeners("ModelSuspend"),await this._agent.invoke_disable()}async resumeModel(){if(!this._enabled)return Promise.resolve();await this._agent.invoke_enable()}ensureEnabled(){this._enabled||(this._agent.invoke_enable(),this._enabled=!0)}contextCreated({context:e}){this.dispatchEventToListeners("ContextCreated",e)}contextWillBeDestroyed({contextId:e}){this.dispatchEventToListeners("ContextDestroyed",e)}contextChanged({context:e}){this.dispatchEventToListeners("ContextChanged",e)}audioListenerCreated({listener:e}){this.dispatchEventToListeners("AudioListenerCreated",e)}audioListenerWillBeDestroyed({listenerId:e,contextId:t}){this.dispatchEventToListeners("AudioListenerWillBeDestroyed",{listenerId:e,contextId:t})}audioNodeCreated({node:e}){this.dispatchEventToListeners("AudioNodeCreated",e)}audioNodeWillBeDestroyed({contextId:e,nodeId:t}){this.dispatchEventToListeners("AudioNodeWillBeDestroyed",{contextId:e,nodeId:t})}audioParamCreated({param:e}){this.dispatchEventToListeners("AudioParamCreated",e)}audioParamWillBeDestroyed({contextId:e,nodeId:t,paramId:n}){this.dispatchEventToListeners("AudioParamWillBeDestroyed",{contextId:e,nodeId:t,paramId:n})}nodesConnected({contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o,destinationInputIndex:d}){this.dispatchEventToListeners("NodesConnected",{contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o,destinationInputIndex:d})}nodesDisconnected({contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o,destinationInputIndex:d}){this.dispatchEventToListeners("NodesDisconnected",{contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o,destinationInputIndex:d})}nodeParamConnected({contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o}){this.dispatchEventToListeners("NodeParamConnected",{contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o})}nodeParamDisconnected({contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o}){this.dispatchEventToListeners("NodeParamDisconnected",{contextId:e,sourceId:t,destinationId:n,sourceOutputIndex:o})}async requestRealtimeData(e){return(await this._agent.invoke_getRealtimeData({contextId:e})).realtimeData}}l.SDKModel.register(R,l.Capability.DOM,!1);var z=Object.freeze({__proto__:null,WebAudioModel:R});const $={noRecordings:"(no recordings)",audioContextS:"Audio context: {PH1}"},G=p.registerUIStrings("web_audio/AudioContextSelector.ts",$),H=p.getLocalizedString.bind(void 0,G);class U extends e.ObjectWrapper{constructor(){super(),this._placeholderText=H($.noRecordings),this._items=new d.ListModel,this._dropDown=new a.SoftDropDown(this._items,this),this._dropDown.setPlaceholderText(this._placeholderText),this._toolbarItem=new i.ToolbarItem(this._dropDown.element),this._toolbarItem.setEnabled(!1),this._toolbarItem.setTitle(H($.audioContextS,{PH1:this._placeholderText})),this._items.addEventListener(d.Events.ItemsReplaced,this._onListItemReplaced,this),this._toolbarItem.element.classList.add("toolbar-has-dropdown"),this._selectedContext=null}_onListItemReplaced(){const e=Boolean(this._items.length);this._toolbarItem.setEnabled(e),e||this._toolbarItem.setTitle(H($.audioContextS,{PH1:this._placeholderText}))}contextCreated(e){const t=e.data;this._items.insert(this._items.length,t),1===this._items.length&&this._dropDown.selectItem(t)}contextDestroyed(e){const t=e.data,n=this._items.findIndex((e=>e.contextId===t));n>-1&&this._items.remove(n)}contextChanged(e){const t=e.data,n=this._items.findIndex((e=>e.contextId===t.contextId));n>-1&&(this._items.replace(n,t),this._selectedContext&&this._selectedContext.contextId===t.contextId&&this._dropDown.selectItem(t))}createElementForItem(e){const t=document.createElement("div"),d=s.createShadowRootWithCoreStyles(t,{cssFile:"web_audio/audioContextSelector.css",enableLegacyPatching:!1,delegatesFocus:void 0}).createChild("div","title");return o.createTextChild(d,n.trimEndWithMaxLength(this.titleFor(e),100)),t}selectedContext(){return this._selectedContext?this._selectedContext:null}highlightedItemChanged(e,t,n,o){n&&n.classList.remove("highlighted"),o&&o.classList.add("highlighted")}isItemSelectable(e){return!0}itemSelected(e){e&&(this._selectedContext&&this._selectedContext.contextId===e.contextId||(this._selectedContext=e,this._toolbarItem.setTitle(H($.audioContextS,{PH1:this.titleFor(e)}))),this.dispatchEventToListeners("ContextSelected",e))}reset(){this._items.replaceAll([])}titleFor(e){return`${e.contextType} (${e.contextId.substr(-6)})`}toolbarItem(){return this._toolbarItem}}var F=Object.freeze({__proto__:null,UIStrings:$,AudioContextSelector:U});const V={audiocontext:"AudioContext",offlineaudiocontext:"OfflineAudioContext",state:"State",sampleRate:"Sample Rate",callbackBufferSize:"Callback Buffer Size",maxOutputChannels:"Max Output Channels",currentTime:"Current Time",callbackInterval:"Callback Interval",renderCapacity:"Render Capacity"},j=p.registerUIStrings("web_audio/AudioContextContentBuilder.ts",V),k=p.getLocalizedString.bind(void 0,j);class q{constructor(e){this._fragment=document.createDocumentFragment(),this._container=document.createElement("div"),this._container.classList.add("context-detail-container"),this._fragment.appendChild(this._container),this._build(e)}_build(e){const t="realtime"===e.contextType?k(V.audiocontext):k(V.offlineaudiocontext);this._addTitle(t,e.contextId),this._addEntry(k(V.state),e.contextState),this._addEntry(k(V.sampleRate),e.sampleRate,"Hz"),"realtime"===e.contextType&&this._addEntry(k(V.callbackBufferSize),e.callbackBufferSize,"frames"),this._addEntry(k(V.maxOutputChannels),e.maxOutputChannelCount,"ch")}_addTitle(e,t){this._container.appendChild(r.html`
  <div class="context-detail-header">
  <div class="context-detail-title">${e}</div>
  <div class="context-detail-subtitle">${t}</div>
  </div>
  `)}_addEntry(e,t,n){const o=t+(n?" "+n:"");this._container.appendChild(r.html`
  <div class="context-detail-row">
  <div class="context-detail-row-entry">${e}</div>
  <div class="context-detail-row-value">${o}</div>
  </div>
  `)}getFragment(){return this._fragment}}class X{constructor(e,t){const n=t.currentTime.toFixed(3),o=(1e3*t.callbackIntervalMean).toFixed(3),d=(1e3*Math.sqrt(t.callbackIntervalVariance)).toFixed(3),a=(100*t.renderCapacity).toFixed(3);this._fragment=document.createDocumentFragment(),this._fragment.appendChild(r.html`
  <div class="context-summary-container">
  <span>${k(V.currentTime)}: ${n} s</span>
  <span>\u2758</span>
  <span>${k(V.callbackInterval)}: μ = ${o} ms, σ = ${d} ms</span>
  <span>\u2758</span>
  <span>${k(V.renderCapacity)}: ${a} %</span>
  </div>
  `)}getFragment(){return this._fragment}}var Y=Object.freeze({__proto__:null,UIStrings:V,ContextDetailBuilder:q,ContextSummaryBuilder:X});const K={openAPageThatUsesWebAudioApiTo:"Open a page that uses Web Audio API to start monitoring."},J=p.registerUIStrings("web_audio/WebAudioView.ts",K),Q=p.getLocalizedString.bind(void 0,J);let Z;class ee extends h.ThrottledWidget{constructor(){super(!0,1e3),this.element.classList.add("web-audio-drawer"),this.registerRequiredCSS("web_audio/webAudio.css",{enableLegacyPatching:!1});const e=this.contentElement.createChild("div","web-audio-toolbar-container vbox");this._contextSelector=new U;const t=new i.Toolbar("web-audio-toolbar",e);t.appendToolbarItem(i.Toolbar.createActionButtonForId("components.collect-garbage")),t.appendSeparator(),t.appendToolbarItem(this._contextSelector.toolbarItem()),this._contentContainer=this.contentElement.createChild("div","web-audio-content-container vbox flex-auto"),this._detailViewContainer=this._contentContainer.createChild("div","web-audio-details-container vbox flex-auto"),this._graphManager=new B,this._landingPage=new c.VBox,this._landingPage.contentElement.classList.add("web-audio-landing-page","fill"),this._landingPage.contentElement.appendChild(r.html`
  <div>
  <p>${Q(K.openAPageThatUsesWebAudioApiTo)}</p>
  </div>
  `),this._landingPage.show(this._detailViewContainer),this._summaryBarContainer=this._contentContainer.createChild("div","web-audio-summary-container"),this._contextSelector.addEventListener("ContextSelected",(e=>{const t=e.data;this._updateDetailView(t),this.doUpdate()})),l.TargetManager.instance().observeModels(R,this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return Z&&!t||(Z=new ee),Z}wasShown(){super.wasShown();for(const e of l.TargetManager.instance().models(R))this._addEventListeners(e)}willHide(){for(const e of l.TargetManager.instance().models(R))this._removeEventListeners(e)}modelAdded(e){this.isShowing()&&this._addEventListeners(e)}modelRemoved(e){this._removeEventListeners(e)}async doUpdate(){await this._pollRealtimeData(),this.update()}_addEventListeners(e){e.ensureEnabled(),e.addEventListener("ContextCreated",this._contextCreated,this),e.addEventListener("ContextDestroyed",this._contextDestroyed,this),e.addEventListener("ContextChanged",this._contextChanged,this),e.addEventListener("ModelReset",this._reset,this),e.addEventListener("ModelSuspend",this._suspendModel,this),e.addEventListener("AudioListenerCreated",this._audioListenerCreated,this),e.addEventListener("AudioListenerWillBeDestroyed",this._audioListenerWillBeDestroyed,this),e.addEventListener("AudioNodeCreated",this._audioNodeCreated,this),e.addEventListener("AudioNodeWillBeDestroyed",this._audioNodeWillBeDestroyed,this),e.addEventListener("AudioParamCreated",this._audioParamCreated,this),e.addEventListener("AudioParamWillBeDestroyed",this._audioParamWillBeDestroyed,this),e.addEventListener("NodesConnected",this._nodesConnected,this),e.addEventListener("NodesDisconnected",this._nodesDisconnected,this),e.addEventListener("NodeParamConnected",this._nodeParamConnected,this),e.addEventListener("NodeParamDisconnected",this._nodeParamDisconnected,this)}_removeEventListeners(e){e.removeEventListener("ContextCreated",this._contextCreated,this),e.removeEventListener("ContextDestroyed",this._contextDestroyed,this),e.removeEventListener("ContextChanged",this._contextChanged,this),e.removeEventListener("ModelReset",this._reset,this),e.removeEventListener("ModelSuspend",this._suspendModel,this),e.removeEventListener("AudioListenerCreated",this._audioListenerCreated,this),e.removeEventListener("AudioListenerWillBeDestroyed",this._audioListenerWillBeDestroyed,this),e.removeEventListener("AudioNodeCreated",this._audioNodeCreated,this),e.removeEventListener("AudioNodeWillBeDestroyed",this._audioNodeWillBeDestroyed,this),e.removeEventListener("AudioParamCreated",this._audioParamCreated,this),e.removeEventListener("AudioParamWillBeDestroyed",this._audioParamWillBeDestroyed,this),e.removeEventListener("NodesConnected",this._nodesConnected,this),e.removeEventListener("NodesDisconnected",this._nodesDisconnected,this),e.removeEventListener("NodeParamConnected",this._nodeParamConnected,this),e.removeEventListener("NodeParamDisconnected",this._nodeParamDisconnected,this)}_contextCreated(e){const t=e.data;this._graphManager.createContext(t.contextId),this._contextSelector.contextCreated(e)}_contextDestroyed(e){const t=e.data;this._graphManager.destroyContext(t),this._contextSelector.contextDestroyed(e)}_contextChanged(e){const t=e.data;this._graphManager.hasContext(t.contextId)&&this._contextSelector.contextChanged(e)}_reset(){this._landingPage.isShowing()&&this._landingPage.detach(),this._contextSelector.reset(),this._detailViewContainer.removeChildren(),this._landingPage.show(this._detailViewContainer),this._graphManager.clearGraphs()}_suspendModel(){this._graphManager.clearGraphs()}_audioListenerCreated(e){const t=e.data,n=this._graphManager.getGraph(t.contextId);n&&n.addNode({nodeId:t.listenerId,nodeType:"Listener",numberOfInputs:0,numberOfOutputs:0})}_audioListenerWillBeDestroyed(e){const{contextId:t,listenerId:n}=e.data,o=this._graphManager.getGraph(t);o&&o.removeNode(n)}_audioNodeCreated(e){const t=e.data,n=this._graphManager.getGraph(t.contextId);n&&n.addNode({nodeId:t.nodeId,nodeType:t.nodeType,numberOfInputs:t.numberOfInputs,numberOfOutputs:t.numberOfOutputs})}_audioNodeWillBeDestroyed(e){const{contextId:t,nodeId:n}=e.data,o=this._graphManager.getGraph(t);o&&o.removeNode(n)}_audioParamCreated(e){const t=e.data,n=this._graphManager.getGraph(t.contextId);n&&n.addParam({paramId:t.paramId,paramType:t.paramType,nodeId:t.nodeId})}_audioParamWillBeDestroyed(e){const{contextId:t,paramId:n}=e.data,o=this._graphManager.getGraph(t);o&&o.removeParam(n)}_nodesConnected(e){const{contextId:t,sourceId:n,destinationId:o,sourceOutputIndex:d,destinationInputIndex:a}=e.data,i=this._graphManager.getGraph(t);i&&i.addNodeToNodeConnection({sourceId:n,destinationId:o,sourceOutputIndex:d,destinationInputIndex:a})}_nodesDisconnected(e){const{contextId:t,sourceId:n,destinationId:o,sourceOutputIndex:d,destinationInputIndex:a}=e.data,i=this._graphManager.getGraph(t);i&&i.removeNodeToNodeConnection({sourceId:n,destinationId:o,sourceOutputIndex:d,destinationInputIndex:a})}_nodeParamConnected(e){const{contextId:t,sourceId:n,destinationId:o,sourceOutputIndex:d}=e.data,a=this._graphManager.getGraph(t);if(!a)return;const i=a.getNodeIdByParamId(o);i&&a.addNodeToParamConnection({sourceId:n,destinationId:i,sourceOutputIndex:d,destinationParamId:o})}_nodeParamDisconnected(e){const{contextId:t,sourceId:n,destinationId:o,sourceOutputIndex:d}=e.data,a=this._graphManager.getGraph(t);if(!a)return;const i=a.getNodeIdByParamId(o);i&&a.removeNodeToParamConnection({sourceId:n,destinationId:i,sourceOutputIndex:d,destinationParamId:o})}_updateDetailView(e){this._landingPage.isShowing()&&this._landingPage.detach();const t=new q(e);this._detailViewContainer.removeChildren(),this._detailViewContainer.appendChild(t.getFragment())}_updateSummaryBar(e,t){const n=new X(e,t);this._summaryBarContainer.removeChildren(),this._summaryBarContainer.appendChild(n.getFragment())}_clearSummaryBar(){this._summaryBarContainer.removeChildren()}async _pollRealtimeData(){const e=this._contextSelector.selectedContext();if(e)for(const t of l.TargetManager.instance().models(R))if("realtime"===e.contextType){if(!this._graphManager.hasContext(e.contextId))continue;const n=await t.requestRealtimeData(e.contextId);n&&this._updateSummaryBar(e.contextId,n)}else this._clearSummaryBar();else this._clearSummaryBar()}}var te=Object.freeze({__proto__:null,UIStrings:K,WebAudioView:ee});export{Y as AudioContextContentBuilder,F as AudioContextSelector,M as EdgeView,W as GraphManager,m as GraphStyle,A as GraphView,C as NodeRendererUtility,L as NodeView,z as WebAudioModel,te as WebAudioView};
