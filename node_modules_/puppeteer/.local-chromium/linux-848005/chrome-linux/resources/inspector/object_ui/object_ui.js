import{JavaScriptMetaData as e,Revealer as t,Console as n}from"../common/common.js";import{i18n as i}from"../i18n/i18n.js";import{Context as s,Fragment as r,UIUtils as o,Tooltip as a,TreeOutline as l,Utils as c,ContextMenu as p,TextPrompt as d,ARIAUtils as h,Icon as u,Geometry as m,GlassPane as b}from"../ui/ui.js";import{userMetrics as y,UserMetrics as _,InspectorFrontendHost as g}from"../host/host.js";import{StringUtilities as f,NumberUtilities as v}from"../platform/platform.js";import{ConsoleModel as x,RuntimeModel as C,SDKModel as w,DebuggerModel as E,RemoteObject as P,OverlayModel as j}from"../sdk/sdk.js";import{TextRange as O}from"../text_utils/text_utils.js";import{FormatterWorkerPool as S}from"../formatter/formatter.js";import{Runtime as T}from"../root/root.js";import{Linkifier as L}from"../components/components.js";const I={keys:"Keys",lexicalScopeVariables:"Lexical scope variables",keywords:"keywords"},k=i.registerUIStrings("object_ui/JavaScriptAutocomplete.js",I),N=i.getLocalizedString.bind(void 0,k);let A;class F{constructor(){this._expressionCache=new Map,x.ConsoleModel.instance().addEventListener(x.Events.CommandEvaluated,this._clearCache,this),s.Context.instance().addFlavorChangeListener(C.ExecutionContext,this._clearCache,this),w.TargetManager.instance().addModelListener(E.DebuggerModel,E.Events.DebuggerResumed,this._clearCache,this),w.TargetManager.instance().addModelListener(E.DebuggerModel,E.Events.DebuggerPaused,this._clearCache,this)}static instance(){return A||(A=new F),A}_clearCache(){this._expressionCache.clear()}async completionsForTextInCurrentContext(e,t,n){const i=e.trim(),[s,r]=await Promise.all([this._mapCompletions(i,t),this._completionsForExpression(i,t,n)]);return s.concat(r)}async argumentsHint(e){const t=await S.formatterWorkerPool().findLastFunctionCall(e);if(!t)return null;const n=s.Context.instance().flavor(C.ExecutionContext);if(!n)return null;const i=await n.evaluate({expression:t.baseExpression,objectGroup:"argumentsHint",includeCommandLineAPI:!0,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:!0,timeout:500,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0},!1,!1);if(!i||"error"in i||i.exceptionDetails||"object"in i&&(!i.object||"function"!==i.object.type))return n.runtimeModel.releaseObjectGroup("argumentsHint"),null;const r=await this._argumentsForFunction(i.object,(async()=>{const e=await n.evaluate({expression:t.receiver,objectGroup:"argumentsHint",includeCommandLineAPI:!0,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:!0,timeout:500,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0},!1,!1);return e&&!("error"in e)&&!e.exceptionDetails&&e.object?e.object:null}),t.functionName);return n.runtimeModel.releaseObjectGroup("argumentsHint"),r.length&&(1!==r.length||r[0]&&r[0].length)?{args:r,argumentIndex:t.argumentIndex}:null}async _argumentsForFunction(t,n,i){const s=t.description;if(!s)return[];if(!s.endsWith("{ [native code] }"))return[await S.formatterWorkerPool().argumentsList(s)];if("function () { [native code] }"===s){const e=(await t.getOwnProperties(!1)).internalProperties||[],n=e.find((e=>"[[TargetFunction]]"===e.name)),i=e.find((e=>"[[BoundArgs]]"===e.name)),s=e.find((e=>"[[BoundThis]]"===e.name));if(s&&n&&i&&n.value&&s.value&&i.value){const e=s.value,t=await this._argumentsForFunction(n.value,(()=>Promise.resolve(e))),r=P.RemoteObject.arrayLength(i.value),o=[];for(const e of t){const t=e.slice(0,r).findIndex((e=>e.startsWith("...")));-1!==t?o.push(e.slice(t)):o.push(e.slice(r))}return o}}const r=await T.Runtime.instance().extension(e.JavaScriptMetaData).instance(),o=/^function ([^(]*)\(/.exec(s),a=o&&o[1]||i;if(!a)return[];const l=r.signaturesForNativeFunction(a);if(l)return l;const c=await n();if(!c)return[];const p=c.className;if(p){const e=r.signaturesForInstanceMethod(a,p);if(e)return e}if(c.description&&"function"===c.type&&c.description.endsWith("{ [native code] }")){const e=/^function ([^(]*)\(/.exec(c.description);if(e){const t=e[1],n=r.signaturesForStaticMethod(a,t);if(n)return n}}let d;if(d="number"===c.type?["Number","Object"]:"string"===c.type?["String","Object"]:"symbol"===c.type?["Symbol","Object"]:"bigint"===c.type?["BigInt","Object"]:"boolean"===c.type?["Boolean","Object"]:"undefined"===c.type||"null"===c.subtype?[]:await c.callFunctionJSON((function(){const e=[];for(let t=this;t;t=Object.getPrototypeOf(t))"object"==typeof t&&t.constructor&&t.constructor.name&&(e[e.length]=t.constructor.name);return e}),[]),!d)return[];for(const e of d){const t=r.signaturesForInstanceMethod(a,e);if(t)return t}return[]}async _mapCompletions(e,t){const n=e.match(/\.\s*(get|set|delete)\s*\(\s*$/),i=s.Context.instance().flavor(C.ExecutionContext);if(!i||!n)return[];const r=await S.formatterWorkerPool().findLastExpression(e.substring(0,n.index));if(!r)return[];const o=await i.evaluate({expression:r,objectGroup:"mapCompletion",includeCommandLineAPI:!0,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:!0,timeout:500,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0},!1,!1);if("error"in o||Boolean(o.exceptionDetails)||"map"!==o.object.subtype)return[];const a=((await o.object.getOwnProperties(!1)).internalProperties||[]).find((e=>"[[Entries]]"===e.name));if(!a||!a.value)return[];const l=await a.value.callFunctionJSON((function(){const e=this,t={__proto__:null};for(let n=0;n<e.length;n++)"string"==typeof e[n].key&&(t[e[n].key]=!0);return t}),[]);i.runtimeModel.releaseObjectGroup("mapCompletion");const c=Object.keys(l),p=[],d=[],h=[],u=[];let m='"';t.startsWith("'")&&(m="'");let b=")";-1!==n[0].indexOf("set")&&(b=", ");const y=c.length<1e3?f.naturalOrderComparator:void 0,_=c.sort(y).map((e=>m+e+m));for(const e of _){if(e.length<t.length)continue;if(t.length&&-1===e.toLowerCase().indexOf(t.toLowerCase()))continue;const n=e.split("\n").join("\\n"),i=n+b;e.startsWith(t)?p.push({text:i,title:n,priority:4}):e.toLowerCase().startsWith(t.toLowerCase())?d.push({text:i,title:n,priority:3}):-1!==e.indexOf(t)?h.push({text:i,title:n,priority:2}):u.push({text:i,title:n,priority:1})}const g=p.concat(d,h,u);return g.length&&(g[0].subtitle=N(I.keys)),g}async _completionsForExpression(e,t,n){const i=s.Context.instance().flavor(C.ExecutionContext);if(!i)return[];let r;if(e.endsWith("?.")?r=await S.formatterWorkerPool().findLastExpression(e.substring(0,e.length-2)):(e.endsWith(".")||e.endsWith("["))&&(r=await S.formatterWorkerPool().findLastExpression(e.substring(0,e.length-1))),!r){if(e.endsWith("."))return[];r=""}const o=r,a=e.endsWith("."),l=Boolean(o)&&e.endsWith("[");if(o&&!isNaN(Number(o))||!o&&t&&!isNaN(Number(t)))return[];if(!t&&!o&&!n)return[];const c=i.debuggerModel.selectedCallFrame();let p;let d=this._expressionCache.get(o);if(d&&d.date+1e4>Date.now())p=await d.value;else if(!o&&c){const e=[{items:["this"],title:void 0}],t=c.scopeChain(),n=[];for(const e of t)n.push(e.object().getAllProperties(!1,!1).then((t=>({properties:t.properties,name:e.name()}))));const s=await Promise.all(n);i.runtimeModel.releaseObjectGroup("completion");for(const t of s)t.properties&&e.push({title:t.name,items:t.properties.map((e=>e.name)).sort()});d={date:Date.now(),value:Promise.resolve(e)},this._expressionCache.set(o,d),p=await d.value}else{const e=i.evaluate({expression:o,objectGroup:"completion",includeCommandLineAPI:!0,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:!0,timeout:500,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0},!1,!1);d={date:Date.now(),value:e.then((e=>h.call(this,e)))},this._expressionCache.set(o,d),p=await d.value}return this._receivedPropertyNames(p.slice(0),a,l,o,t);async function h(e){if("error"in e||Boolean(e.exceptionDetails)||!e.object)return[];if(!i)return[];let t=e.object;for(;t&&"object"===t.type&&"proxy"===t.subtype;){const e=((await t.getOwnProperties(!1)).internalProperties||[]).find((e=>"[[Target]]"===e.name));if(!e||!e.value)break;t=e.value}if(!t)return[];let n=[];if("object"===t.type||"function"===t.type)n=await t.callFunctionJSON(s,[P.RemoteObject.toCallArgument(t.subtype)])||[];else if("string"===t.type||"number"===t.type||"boolean"===t.type||"bigint"===t.type){const e=await i.evaluate({expression:"("+s+')("'+t.type+'")',objectGroup:"completion",includeCommandLineAPI:!1,silent:!0,returnByValue:!0,generatePreview:!1,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0,throwOnSideEffect:void 0,timeout:void 0},!1,!1);"error"in e||!e.object||e.exceptionDetails||(n=e.object.value||[])}if(i.runtimeModel.releaseObjectGroup("completion"),!o){const e=await i.globalLexicalScopeNames();e&&(n.length?n[0].items=n[0].items.concat(e):n.push({items:e.sort(),title:N(I.lexicalScopeVariables)}))}for(const e of n){for(let t=0;t<e.items.length;t++)e.items[t]=e.items[t].replace(/\n/g,"\\n");e.items.sort(e.items.length<1e3?this._itemComparator:void 0)}return n;function s(e){let t;t="string"===e?new String(""):"number"===e?new Number(0):"bigint"===e?Object(BigInt(0)):"boolean"===e?new Boolean(!1):this;const n=[];try{for(let i=t;i;i=Object.getPrototypeOf(i)){if(("array"===e||"typedarray"===e)&&i===t&&i.length>9999)continue;const s={items:[],title:void 0,__proto__:null};try{"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"constructor")&&i.constructor&&i.constructor.name&&(s.title=i.constructor.name)}catch(e){}n[n.length]=s;const r=Object.getOwnPropertyNames(i),o=Array.isArray(i);for(let e=0;e<r.length&&s.items.length<1e4;++e)o&&/^[0-9]/.test(r[e])||(s.items[s.items.length]=r[e])}}catch(e){}return n}}}_receivedPropertyNames(e,t,n,i,s){if(!e)return[];if(!t&&!n){const t=["dir","dirxml","keys","values","profile","profileEnd","monitorEvents","unmonitorEvents","inspect","copy","clear","getEventListeners","debug","undebug","monitor","unmonitor","table","queryObjects","$","$$","$x","$0","$_"];e.push({items:t,title:void 0})}return this._completionsForQuery(t,n,i,s,e)}_completionsForQuery(e,t,n,i,s){const r=t&&i.startsWith("'")?"'":'"';if(!n){const e=["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","exports","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","let","static","async","of"];s.push({title:N(I.keywords),items:e.sort()})}const o=new Set;let a,l=[];const c=/^[a-zA-Z_$\u008F-\uFFFF][a-zA-Z0-9_$\u008F-\uFFFF]*$/,p=i.toLowerCase();for(const e of s){const n=[],s=[],d=[],h=[];for(let a=0;a<e.items.length;a++){let l=e.items[a];if(!t&&!c.test(l))continue;if(t&&(/^[0-9]+$/.test(l)||(l=r+f.escapeCharacters(l,r+"\\")+r),l+="]"),o.has(l))continue;if(l.length<i.length)continue;const u=l.toLowerCase();i.length&&-1===u.indexOf(p)||(o.add(l),l.startsWith(i)?n.push({text:l,priority:l===i?5:4}):u.startsWith(p)?s.push({text:l,priority:3}):-1!==l.indexOf(i)?d.push({text:l,priority:2}):h.push({text:l,priority:1}))}const u=n.concat(s,d,h);u.length&&e.title!==a&&(u[0].subtitle=e.title,a=e.title),l=l.concat(u),l.forEach((e=>{e.text.endsWith("]")&&(e.title=e.text.substring(0,e.text.length-1))}))}return l}_itemComparator(e,t){const n=e.startsWith("_"),i=t.startsWith("_");return n&&!i?1:i&&!n?-1:f.naturalOrderComparator(e,t)}static async isExpressionComplete(e){const t=s.Context.instance().flavor(C.ExecutionContext);if(!t)return!0;const n=await t.runtimeModel.compileScript(e,"",!1,t.id);if(!n||!n.exceptionDetails||!n.exceptionDetails.exception)return!0;const i=n.exceptionDetails.exception.description;return!!i&&(!i.startsWith("SyntaxError: Unexpected end of input")&&!i.startsWith("SyntaxError: Unterminated template literal"))}}class M{constructor(e){this._editor=e}static createConfigForEditor(e){const t=new M(e);return{substituteRangeCallback:t._substituteRange.bind(t),suggestionsCallback:t._suggestionsCallback.bind(t),tooltipCallback:t._tooltipCallback.bind(t),anchorBehavior:void 0,isWordChar:void 0}}_substituteRange(e,t){const n=this._editor.tokenAtTextPosition(e,t);if(n&&"js-string"===n.type)return new O.TextRange(e,n.startColumn,e,t);const i=this._editor.line(e);let s;for(s=t-1;s>=0&&-1===" =:[({;,!+-*/&|^<>.\t\r\n".indexOf(i.charAt(s));s--);return new O.TextRange(e,s+1,e,t)}async _suggestionsCallback(e,t,n){const i=this._editor.text(e),s=this._editor.text(new O.TextRange(0,0,e.startLine,e.startColumn)),r=this._editor.tokenAtTextPosition(t.startLine,t.startColumn);if(r){const e=new Set(["js-comment","js-string-2","js-def"]),t=s.trim();if(t.endsWith("[")||t.match(/\.\s*(get|set|delete)\s*\(\s*$/)||e.add("js-string"),t.endsWith(".")||e.add("js-property"),e.has(r.type))return[]}const o=this._editor.line(e.startLine).substring(e.startColumn),a=await F.instance().completionsForTextInCurrentContext(s,i,n);return!n&&o&&o!==i&&a.some((e=>o.startsWith(e.text)&&i.length!==e.text.length))?[]:a}async _tooltipCallback(e,t){const n=this._editor.text(new O.TextRange(0,0,e,t)),i=await F.instance().argumentsHint(n);if(!i)return null;const s=i.argumentIndex,a=document.createElement("div");for(const e of i.args){const t=document.createElement("span");for(let n=0;n<e.length;n++)n===s||n<s&&e[n].startsWith("...")?t.appendChild(r.html`<b>${e[n]}</b>`):o.createTextChild(t,e[n]),n<e.length-1&&o.createTextChild(t,", ");a.appendChild(r.html`<div class='source-code'>\u0192(${t})</div>`)}return a}}var D=Object.freeze({__proto__:null,UIStrings:I,JavaScriptAutocomplete:F,JavaScriptAutocompleteConfig:M,CompletionGroup:undefined});const R={emptyD:"empty × {PH1}",empty:"empty",thePropertyIsComputedWithAGetter:"The property is computed with a getter"},W=i.registerUIStrings("object_ui/RemoteObjectPreviewFormatter.js",R),B=i.getLocalizedString.bind(void 0,W);class V{static _objectPropertyComparator(e,t){return n(e)-n(t);function n(e){const t=$;return e.name===t.PromiseState?1:e.name===t.PromiseResult?2:e.name===t.GeneratorState||e.name===t.PrimitiveValue?3:e.type===Protocol.Runtime.PropertyPreviewType.Function||e.name.startsWith("#")?5:4}}appendObjectPreview(e,t,n){const i=t.description,s=new Set(["null","regexp","error","internal#entry","trustedtype"]);if(t.type!==Protocol.Runtime.ObjectPreviewType.Object||t.subtype&&s.has(t.subtype)||n)return void e.appendChild(this.renderPropertyPreview(t.type,t.subtype,t.className,i));const r=t.subtype===Protocol.Runtime.ObjectPreviewSubtype.Array||"typedarray"===t.subtype;if(i){let n;if(r){const e=P.RemoteObject.arrayLength(t),s=e>1?"("+e+")":"",r=P.RemoteObject.arrayNameFromDescription(i);n="Array"===r?s:r+s}else{n="Object"===i?"":i}n.length>0&&(e.createChild("span","object-description").textContent=n+" ")}const a=e.createChild("span","object-properties-preview");if(o.createTextChild(a,r?"[":"{"),t.entries?this._appendEntriesPreview(a,t):r?this._appendArrayPropertiesPreview(a,t):this._appendObjectPropertiesPreview(a,t),t.overflow){const e=a.textContent&&a.textContent.length>1?", …":"…";a.createChild("span").textContent=e}o.createTextChild(a,r?"]":"}")}_abbreviateFullQualifiedClassName(e){const t=e.split(".");for(let e=0;e<t.length-1;++e)t[e]=f.trimMiddle(t[e],3);return t.join(".")}_appendObjectPropertiesPreview(e,t){const n=$,i=t.properties.filter((e=>"accessor"!==e.type)).sort(V._objectPropertyComparator);for(let s=0;s<i.length;++s){s>0&&o.createTextChild(e,", ");const r=i[s],a=r.name;if("promise"===t.subtype&&a===n.PromiseState){e.appendChild(this._renderDisplayName("<"+r.value+">"));const t=s+1<i.length?i[s+1]:null;t&&t.name===n.PromiseResult&&("pending"!==r.value&&(o.createTextChild(e,": "),e.appendChild(this._renderPropertyPreviewOrAccessor([t]))),s++)}else"generator"===t.subtype&&a===n.GeneratorState?e.appendChild(this._renderDisplayName("<"+r.value+">")):(a===n.PrimitiveValue||(e.appendChild(this._renderDisplayName(a)),o.createTextChild(e,": ")),e.appendChild(this._renderPropertyPreviewOrAccessor([r])))}}_appendArrayPropertiesPreview(e,t){const n=P.RemoteObject.arrayLength(t),i=t.properties.filter((e=>-1!==r(e.name))).sort((function(e,t){return r(e.name)-r(t.name)})),s=t.properties.filter((e=>-1===r(e.name))).sort(V._objectPropertyComparator);function r(e){const t=Number(e)>>>0;return String(t)===e&&t<n?t:-1}const a=!t.overflow;let l=-1,c=!1;for(let t=0;t<i.length;++t){c&&o.createTextChild(e,", ");const n=i[t],s=r(n.name);a&&s-l>1&&(p(s),o.createTextChild(e,", ")),a||t===s||(e.appendChild(this._renderDisplayName(n.name)),o.createTextChild(e,": ")),e.appendChild(this._renderPropertyPreviewOrAccessor([n])),l=s,c=!0}a&&n-l>1&&(c&&o.createTextChild(e,", "),p(n));for(let t=0;t<s.length;++t){c&&o.createTextChild(e,", ");const n=s[t];e.appendChild(this._renderDisplayName(n.name)),o.createTextChild(e,": "),e.appendChild(this._renderPropertyPreviewOrAccessor([n])),c=!0}function p(t){const n=e.createChild("span","object-value-undefined"),i=t-l-1;n.textContent=1!==i?B(R.emptyD,{PH1:i}):B(R.empty),c=!0}}_appendEntriesPreview(e,t){if(t.entries)for(let n=0;n<t.entries.length;++n){n>0&&o.createTextChild(e,", ");const i=t.entries[n];i.key&&(this.appendObjectPreview(e,i.key,!0),o.createTextChild(e," => ")),this.appendObjectPreview(e,i.value,!0)}}_renderDisplayName(e){const t=document.createElement("span");t.classList.add("name");const n=/^\s|\s$|^$|\n/.test(e);return t.textContent=n?'"'+e.replace(/\n/g,"↵")+'"':e,t}_renderPropertyPreviewOrAccessor(e){const t=e[e.length-1];if(!t)throw new Error("Could not find property");return this.renderPropertyPreview(t.type,t.subtype,t.name,t.value)}renderPropertyPreview(e,t,n,i){const s=document.createElement("span");if(s.classList.add("object-value-"+(t||e)),i=i||"","accessor"===e)return s.textContent="(...)",a.Tooltip.install(s,B(R.thePropertyIsComputedWithAGetter)),s;if("function"===e)return s.textContent="ƒ",s;if("object"===e&&"trustedtype"===t&&n)return H(s,i,n),s;if("object"===e&&"node"===t&&i)return G(s,i),s;if("string"===e)return o.createTextChildren(s,'"',i.replace(/\n/g,"↵"),'"'),s;if("object"===e&&!t){let e=this._abbreviateFullQualifiedClassName(i);return"Object"===e&&(e="{…}"),s.textContent=e,a.Tooltip.install(s,i),s}return s.textContent=i,s}}const $={GeneratorState:"[[GeneratorState]]",PrimitiveValue:"[[PrimitiveValue]]",PromiseState:"[[PromiseState]]",PromiseResult:"[[PromiseResult]]"},G=function(e,t){const n=t.match(/([^#.]+)(#[^.]+)?(\..*)?/);n&&(e.createChild("span","webkit-html-tag-name").textContent=n[1],n[2]&&(e.createChild("span","webkit-html-attribute-value").textContent=n[2]),n[3]&&(e.createChild("span","webkit-html-attribute-name").textContent=n[3]))},H=function(e,t,n){o.createTextChildren(e,n+" ");const i=document.createElement("span");i.classList.add("object-value-string"),o.createTextChildren(i,'"',t.replace(/\n/g,"↵"),'"'),e.appendChild(i)};var J=Object.freeze({__proto__:null,UIStrings:R,RemoteObjectPreviewFormatter:V,createSpansForNodeTitle:G,createSpanForTrustedType:H});class U{static wrapObjectLiteral(e){if(!/^\s*\{/.test(e)||!/\}\s*$/.test(e))return e;const t=(async()=>0).constructor;try{t("return "+e+";");const n="("+e+")";return t(n),n}catch(t){return e}}static preprocessExpression(e){return U.wrapObjectLiteral(e)}static async evaluateAndBuildPreview(e,t,n,i,r){const o=window.ObjectUI.JavaScriptREPL,a=s.Context.instance().flavor(C.ExecutionContext),l=void 0!==o._MaxLengthForEvaluation?o._MaxLengthForEvaluation:z,c=e.length>l;if(!e||!a||t&&c)return{preview:document.createDocumentFragment(),result:null};const p={expression:U.preprocessExpression(e),generatePreview:!0,includeCommandLineAPI:!0,throwOnSideEffect:t,timeout:n,objectGroup:r,disableBreaks:!0,replMode:!0,silent:void 0,returnByValue:void 0,allowUnsafeEvalBlockedByCSP:void 0},d=await a.evaluate(p,!1,!1);return{preview:U._buildEvaluationPreview(d,i),result:d}}static _buildEvaluationPreview(e,t){const n=document.createDocumentFragment();if("error"in e)return n;if(e.exceptionDetails&&e.exceptionDetails.exception&&e.exceptionDetails.exception.description){const i=e.exceptionDetails.exception.description;return(i.startsWith("TypeError: ")||t)&&(n.createChild("span").textContent=e.exceptionDetails.text+" "+i),n}const i=new V,{preview:s,type:r,subtype:o,className:a,description:l}=e.object;if(s&&"object"===r&&"node"!==o&&"trustedtype"!==o)i.appendObjectPreview(n,s,!1);else{const e=i.renderPropertyPreview(r,o,a,f.trimEndWithMaxLength(l||"",400));n.appendChild(e)}return n}}const z=2e3;var q=Object.freeze({__proto__:null,JavaScriptREPL:U,MaxLengthForEvaluation:z});const K={exceptionS:"[Exception: {PH1}]",unknown:"unknown",expandRecursively:"Expand recursively",collapseChildren:"Collapse children",noProperties:"No properties",dots:"(...)",invokePropertyGetter:"Invoke property getter",showAllD:"Show all {PH1}",unreadable:"<unreadable>",noPropertyGetter:"No property getter",copyValue:"Copy value",copyPropertyPath:"Copy property path",stringIsTooLargeToEdit:"<string is too large to edit>",showMoreS:"Show more ({PH1})",longTextWasTruncatedS:"long text was truncated ({PH1})",copy:"Copy"},Q=i.registerUIStrings("object_ui/ObjectPropertiesSection.js",K),X=i.getLocalizedString.bind(void 0,Q),Z=new WeakMap,Y=new WeakMap;class ee extends l.TreeOutlineInShadow{constructor(e,t,n,i,s,r,o){super(),this._object=e,this._editable=!0,o||this.hideOverflow(),this.setFocusable(!0),this.setShowSelectionOnKeyboardFocus(!0),this._objectTreeElement=new ie(e,n,i,s,r),this.appendChild(this._objectTreeElement),"string"!=typeof t&&t?(this.titleElement=t,this.element.appendChild(t)):(this.titleElement=this.element.createChild("span"),this.titleElement.textContent=t||""),this.titleElement instanceof HTMLElement&&!this.titleElement.hasAttribute("tabIndex")&&(this.titleElement.tabIndex=-1),Y.set(this.element,this),this.registerRequiredCSS("object_ui/objectValue.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("object_ui/objectPropertiesSection.css",{enableLegacyPatching:!0}),this.rootElement().childrenListElement.classList.add("source-code","object-properties-section")}static defaultObjectPresentation(e,t,n,i){const s=ee.defaultObjectPropertiesSection(e,t,n,i);return e.hasChildren?s.element:s.titleElement}static defaultObjectPropertiesSection(e,t,n,i){const s=document.createElement("span");s.classList.add("source-code");const r=c.createShadowRootWithCoreStyles(s,{cssFile:"object_ui/objectValue.css",enableLegacyPatching:!0,delegatesFocus:void 0}),o=ee.createPropertyValue(e,!1,!0);r.appendChild(o.element);const a=new ee(e,s,t);return a._editable=!1,n&&a.skipProto(),i&&a.setEditable(!1),a}static CompareProperties(e,t){const n=e.name,i=t.name;return"__proto__"===n?1:"__proto__"===i?-1:!e.enumerable&&t.enumerable?1:!t.enumerable&&e.enumerable?-1:n.startsWith("_")&&!i.startsWith("_")?1:i.startsWith("_")&&!n.startsWith("_")?-1:e.symbol&&!t.symbol?1:t.symbol&&!e.symbol?-1:e.private&&!t.private?1:t.private&&!e.private?-1:f.naturalOrderComparator(n,i)}static createNameElement(e,t){return null===e?r.html`<span class="name"></span>`:/^\s|\s$|^$|\n/.test(e)?r.html`<span class="name">"${e.replace(/\n/g,"↵")}"</span>`:t?r.html`<span class="name">
        <span class="private-property-hash">${e[0]}</span>${e.substring(1)}
      </span>`:r.html`<span class="name">${e}</span>`}static valueElementForFunctionDescription(e,t,n){const i=document.createElement("span");i.classList.add("object-value-function");const s=(e=e||"").replace(/^function [gs]et /,"function ").replace(/^function [gs]et\(/,"function(").replace(/^[gs]et /,"");n=n||"";const r=s.match(/^(async\s+function)/),l=s.startsWith("function*"),c=s.startsWith("*"),p=!l&&s.startsWith("function"),d=s.startsWith("class ")||s.startsWith("class{"),h=s.indexOf("=>"),u=!r&&!l&&!p&&!d&&h>0;let m;if(d){m=s.substring("class".length);const e=/^[^{\s]+/.exec(m.trim());let t=n;e&&(t=e[0].trim()||n),y("class",m,t)}else if(r)m=s.substring(r[1].length),y("async ƒ",m,b(m));else if(l)m=s.substring("function*".length),y("ƒ*",m,b(m));else if(c)m=s.substring("*".length),y("ƒ*",m,b(m));else if(p)m=s.substring("function".length),y("ƒ",m,b(m));else if(u){const e=60;let t=s;n?t=n+"()":s.length>e&&(t=s.substring(0,h+2)+" {…}"),y("",s,t)}else y("ƒ",s,b(s));return a.Tooltip.install(i,f.trimEndWithMaxLength(e,500)),i;function b(e){const t=e.indexOf("("),i=e.match(/\)\s*{/);if(-1!==t&&i&&void 0!==i.index&&i.index>t){return(e.substring(0,t).trim()||n)+e.substring(t,i.index+1)}return n+"()"}function y(e,n,s){e.length&&(i.createChild("span","object-value-function-prefix").textContent=e+" "),t?o.createTextChild(i,f.trimEndWithMaxLength(n.trim(),200)):o.createTextChild(i,s.replace(/\n/g," "))}}static createPropertyValueWithCustomSupport(e,t,n,i,s){if(e.customPreview()){const t=new ye(e).element;return t.classList.add("object-properties-section-custom-section"),new ce(t)}return ee.createPropertyValue(e,t,n,i,s)}static createPropertyValue(e,n,s,r,l){let c;const p=e.type,d=e.subtype,h=e.description||"",u=e.className;if("object"===p&&"internal#location"===d){const t=e.debuggerModel().createRawLocationByScriptId(e.value.scriptId,e.value.lineNumber,e.value.columnNumber);if(t&&l)return new ce(l.linkifyRawLocation(t,""));c=new ce(function(){const e=document.createElement("span");return e.textContent="<"+X(K.unknown)+">",a.Tooltip.install(e,h||""),e}())}else if("string"===p&&"string"==typeof h)c=m();else if("object"===p&&"trustedtype"===d)c=function(){const e=document.createElement("span");e.classList.add("object-value-trustedtype");const t=`${u} "${h}"`;let n;if(t.length>(self.ObjectUI.ObjectPropertiesSection._maxRenderableStringLength||te))n=new pe(e,t,50);else{const i=m();o.createTextChild(e,u+" "),e.appendChild(i.element),n=new ce(e),a.Tooltip.install(e,t)}return n}();else if("function"===p)c=new ce(ee.valueElementForFunctionDescription(h));else if("object"===p&&"node"===d&&h)c=new ce(function(){const n=document.createElement("span");return n.classList.add("object-value-node"),G(n,h),n.addEventListener("click",(n=>{t.reveal(e),n.consume(!0)}),!1),n.addEventListener("mousemove",(()=>j.OverlayModel.highlightObjectAsDOMNode(e)),!1),n.addEventListener("mouseleave",(()=>j.OverlayModel.hideDOMNodeHighlight()),!1),n}());else{const t=document.createElement("span");if(t.classList.add("object-value-"+(d||p)),e.preview&&s){(new V).appendObjectPreview(t,e.preview,!1),c=new ce(t),a.Tooltip.install(c.element,h||"")}else h.length>(self.ObjectUI.ObjectPropertiesSection._maxRenderableStringLength||te)?c=new pe(t,h,50):(c=new ce(t),c.element.textContent=h,a.Tooltip.install(c.element,h))}if(n){const e=document.createElement("span");e.classList.add("error"),e.classList.add("value"),e.appendChild(i.getFormatLocalizedString(Q,K.exceptionS,{PH1:c.element})),c.element=e}return c.element.classList.add("value"),c;function m(){const e=document.createElement("span");e.classList.add("object-value-string");const t=h.replace(/\n/g,"↵");let n;return e.createChild("span","object-value-string-quote").textContent='"',h.length>(self.ObjectUI.ObjectPropertiesSection._maxRenderableStringLength||te)?n=new pe(e,t,50):(o.createTextChild(e,t),n=new ce(e),a.Tooltip.install(e,h||"")),e.createChild("span","object-value-string-quote").textContent='"',n}}static formatObjectAsFunction(e,n,i,s){return e.debuggerModel().functionDetailsPromise(e).then((function(r){i&&r&&r.location&&(n.classList.add("linkified"),n.addEventListener("click",(()=>t.reveal(r.location)&&!1)));let o=s?"":"anonymous";r&&r.functionName&&(o=r.functionName);const a=ee.valueElementForFunctionDescription(e.description,s,o);n.appendChild(a)}))}static _isDisplayableProperty(e,t){if(!t||!t.synthetic)return!0;const n=e.name;return!("[[Entries]]"===t.name&&("length"===n||"__proto__"===n))}skipProto(){this._skipProto=!0}expand(){this._objectTreeElement.expand()}setEditable(e){this._editable=e}objectTreeElement(){return this._objectTreeElement}enableContextMenu(){this.element.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),!1)}_contextMenuEventFired(e){const t=new p.ContextMenu(e);t.appendApplicableItems(this._object),this._object instanceof P.LocalJSONObject&&(t.viewSection().appendItem(X(K.expandRecursively),this._objectTreeElement.expandRecursively.bind(this._objectTreeElement,Number.MAX_VALUE)),t.viewSection().appendItem(X(K.collapseChildren),this._objectTreeElement.collapseChildren.bind(this._objectTreeElement))),t.show()}titleLessMode(){this._objectTreeElement.listItemElement.classList.add("hidden"),this._objectTreeElement.childrenListElement.classList.add("title-less-mode"),this._objectTreeElement.expand()}}const te=1e4;class ne extends l.TreeOutlineInShadow{constructor(e){super(),this.registerRequiredCSS("object_ui/objectValue.css",{enableLegacyPatching:!0}),this.registerRequiredCSS("object_ui/objectPropertiesSection.css",{enableLegacyPatching:!0}),this._editable=!(e&&e.readOnly),this.contentElement.classList.add("source-code"),this.contentElement.classList.add("object-properties-section"),this.hideOverflow()}}class ie extends l.TreeElement{constructor(e,t,n,i,s){super(document.createElement("slot")),this._object=e,this._extraProperties=s||[],this._ignoreHasOwnProperty=Boolean(i),this._emptyPlaceholder=n,this.setExpandable(!0),this.selectable=!0,this.toggleOnClick=!0,this.listItemElement.classList.add("object-properties-section-root-element"),this._linkifier=t}onexpand(){this.treeOutline&&this.treeOutline.element.classList.add("expanded")}oncollapse(){this.treeOutline&&this.treeOutline.element.classList.remove("expanded")}ondblclick(e){return!0}async onpopulate(){const e=this.treeOutline,t=!!e&&Boolean(e._skipProto);return se._populate(this,this._object,t,this._linkifier,this._emptyPlaceholder,this._ignoreHasOwnProperty,this._extraProperties)}}class se extends l.TreeElement{constructor(e,t){super(),this.property=e,this.toggleOnClick=!0,this._highlightChanges=[],this._linkifier=t,this._maxNumPropertiesToShow=200,this.listItemElement.addEventListener("contextmenu",this._contextMenuFired.bind(this),!1),this.listItemElement.dataset.objectPropertyNameForTest=e.name,this.nameElement,this.valueElement,this._rowContainer,this._readOnly,this._prompt,this._editableDiv}static async _populate(e,t,n,i,s,r,o,a){if(t.arrayLength()>100)return e.removeChildren(),void re._populateArray(e,t,0,t.arrayLength()-1,i);let l;l=r?await t.getAllProperties(!1,!0):await P.RemoteObject.loadFromObjectPerProto(t,!0);const c=l.properties,p=l.internalProperties;if(e.removeChildren(),c){o=o||[];for(let e=0;e<o.length;++e)c.push(o[e]);se.populateWithProperties(e,c,p,n,a||t,i,s)}}static populateWithProperties(e,t,n,i,s,r,o){t.sort(ee.CompareProperties);const a=(n=n||[]).find((e=>"[[Entries]]"===e.name));if(a){Z.set(a,s);const t=new se(a,r);t.setExpandable(!0),t.expand(),e.appendChild(t)}const l=[];let c=null;for(let n=0;n<t.length;++n){const i=t[n];if(Z.set(i,s),!ee._isDisplayableProperty(i,e.property))continue;if("__proto__"===i.name&&!i.isAccessorProperty()){c=i;continue}if(i.isOwn&&i.getter){const e=new P.RemoteObjectProperty("get "+i.name,i.getter,!1);Z.set(e,s),l.push(e)}if(i.isOwn&&i.setter){const e=new P.RemoteObjectProperty("set "+i.name,i.setter,!1);Z.set(e,s),l.push(e)}(i.getter||!i.isAccessorProperty())&&"__proto__"!==i.name&&e.appendChild(new se(i,r))}for(let t=0;t<l.length;++t)e.appendChild(new se(l[t],r));!i&&c&&e.appendChild(new se(c,r));for(const t of n){Z.set(t,s);const n=new se(t,r);"[[Entries]]"!==t.name&&e.appendChild(n)}se._appendEmptyPlaceholderIfNeeded(e,o)}static _appendEmptyPlaceholderIfNeeded(e,t){if(e.childCount())return;const n=document.createElement("div");n.classList.add("gray-info-message"),n.textContent=t||X(K.noProperties);const i=new l.TreeElement(n);e.appendChild(i)}static createRemoteObjectAccessorPropertySpan(e,t,n){const i=document.createElement("span"),s=i.createChild("span");if(s.textContent=X(K.dots),!e)return i;function r(e){let t=this;const n=JSON.parse(e);for(let e=0,i=n.length;e<i;++e)t=t[n[e]];return t}return s.classList.add("object-value-calculate-value-button"),a.Tooltip.install(s,X(K.invokePropertyGetter)),s.addEventListener("click",(function(i){i.consume(),e&&e.callFunction(r,[{value:JSON.stringify(t)}]).then(n)}),!1),i}setSearchRegex(e,t){let n=o.highlightedSearchResultClassName;if(t&&(n+=" "+t),this.revertHighlightChanges(),this._applySearch(e,this.nameElement,n),this.property.value){"object"!==this.property.value.type&&this._applySearch(e,this.valueElement,n)}return Boolean(this._highlightChanges.length)}_applySearch(e,t,n){const i=[],s=t.textContent||"";e.lastIndex=0;let r=e.exec(s);for(;r;)i.push(new O.SourceRange(r.index,r[0].length)),r=e.exec(s);i.length&&o.highlightRangesWithStyleClass(t,i,n,this._highlightChanges)}_showAllPropertiesElementSelected(e){return this.removeChild(e),this.children().forEach((e=>{e.hidden=!1})),!1}_createShowAllPropertiesButton(){const e=document.createElement("div");e.classList.add("object-value-calculate-value-button"),e.textContent=X(K.dots),a.Tooltip.install(e,X(K.showAllD,{PH1:this.childCount()}));const t=this.children();for(let e=this._maxNumPropertiesToShow;e<this.childCount();++e)t[e].hidden=!0;const n=new l.TreeElement(e);n.onselect=this._showAllPropertiesElementSelected.bind(this,n),this.appendChild(n)}revertHighlightChanges(){o.revertDomChanges(this._highlightChanges),this._highlightChanges=[]}async onpopulate(){const e=this.property.value;console.assert(void 0!==e);const t=this.treeOutline,n=!!t&&Boolean(t._skipProto),i="__proto__"!==this.property.name?e:Z.get(this.property);i&&(await se._populate(this,e,n,this._linkifier,void 0,void 0,void 0,i),this.childCount()>this._maxNumPropertiesToShow&&this._createShowAllPropertiesButton())}ondblclick(e){const t=e.target,n=t.isSelfOrDescendant(this.valueElement)||this.expandedValueElement&&t.isSelfOrDescendant(this.expandedValueElement);return this.property.value&&!this.property.value.customPreview()&&n&&(this.property.writable||this.property.setter)&&this._startEditing(),!1}onenter(){return!(!this.property.value||this.property.value.customPreview()||!this.property.writable&&!this.property.setter)&&(this._startEditing(),!0)}onattach(){this.update(),this._updateExpandable()}onexpand(){this._showExpandedValueElement(!0)}oncollapse(){this._showExpandedValueElement(!1)}_showExpandedValueElement(e){this.expandedValueElement&&(e?this._rowContainer.replaceChild(this.expandedValueElement,this.valueElement):this._rowContainer.replaceChild(this.valueElement,this.expandedValueElement))}_createExpandedValueElement(e){if(!(e.hasChildren&&!e.customPreview()&&"node"!==e.subtype&&"function"!==e.type&&("object"!==e.type||e.preview)))return null;const t=document.createElement("span");return t.classList.add("value"),"Object"===e.description?t.textContent="":t.setTextContentTruncatedIfNeeded(e.description||""),t.classList.add("object-value-"+(e.subtype||e.type)),a.Tooltip.install(t,e.description||""),t}update(){this.nameElement=ee.createNameElement(this.property.name,this.property.private),this.property.enumerable||this.nameElement.classList.add("object-properties-section-dimmed"),this.property.synthetic&&this.nameElement.classList.add("synthetic-property"),this._updatePropertyPath();const e=this.property.synthetic&&"[[Entries]]"===this.property.name;if(e)this.valueElement=document.createElement("span"),this.valueElement.classList.add("value");else if(this.property.value){const e="__proto__"!==this.property.name;this.propertyValue=ee.createPropertyValueWithCustomSupport(this.property.value,this.property.wasThrown,e,this.listItemElement,this._linkifier),this.valueElement=this.propertyValue.element}else this.property.getter?this.valueElement=se.createRemoteObjectAccessorPropertySpan(Z.get(this.property),[this.property.name],this._onInvokeGetterClick.bind(this)):(this.valueElement=document.createElement("span"),this.valueElement.classList.add("object-value-undefined"),this.valueElement.textContent=X(K.unreadable),a.Tooltip.install(this.valueElement,X(K.noPropertyGetter)));const t=this.valueElement.textContent;let n;this.property.value&&t&&!this.property.wasThrown&&(this.expandedValueElement=this._createExpandedValueElement(this.property.value)),this.listItemElement.removeChildren(),n=e?r.html`<span class='name-and-value'>${this.nameElement}</span>`:r.html`<span class='name-and-value'>${this.nameElement}: ${this.valueElement}</span>`,this._rowContainer=n,this.listItemElement.appendChild(this._rowContainer)}_updatePropertyPath(){if(a.Tooltip.getContent(this.nameElement))return;const e=this.property.name;if(this.property.synthetic)return void a.Tooltip.install(this.nameElement,e);const t=this.parent instanceof se&&this.parent.nameElement&&!this.parent.property.synthetic?a.Tooltip.getContent(this.parent.nameElement):"";this.property.private||/^(?:[$_\p{ID_Start}])(?:[$_\u200C\u200D\p{ID_Continue}])*$/u.test(e)?a.Tooltip.install(this.nameElement,t?`${t}.${e}`:e):/^(?:0|[1-9]\d*)$/.test(e)?a.Tooltip.install(this.nameElement,`${t}[${e}]`):a.Tooltip.install(this.nameElement,`${t}[${JSON.stringify(e)}]`)}_contextMenuFired(e){const t=new p.ContextMenu(e);if(t.appendApplicableItems(this),this.property.symbol&&t.appendApplicableItems(this.property.symbol),this.property.value&&(t.appendApplicableItems(this.property.value),Z.get(this.property)instanceof P.LocalJSONObject)){const{value:{value:e}}=this.property,n="object"==typeof e?JSON.stringify(e,null,2):e,i=()=>{y.actionTaken(_.Action.NetworkPanelCopyValue),g.InspectorFrontendHostInstance.copyText(n)};t.clipboardSection().appendItem(X(K.copyValue),i)}if(!this.property.synthetic&&this.nameElement&&a.Tooltip.getContent(this.nameElement)){const e=g.InspectorFrontendHostInstance.copyText.bind(g.InspectorFrontendHostInstance,a.Tooltip.getContent(this.nameElement));t.clipboardSection().appendItem(X(K.copyPropertyPath),e)}Z.get(this.property)instanceof P.LocalJSONObject&&(t.viewSection().appendItem(X(K.expandRecursively),this.expandRecursively.bind(this,Number.MAX_VALUE)),t.viewSection().appendItem(X(K.collapseChildren),this.collapseChildren.bind(this))),this.propertyValue&&this.propertyValue.appendApplicableItems(e,t,{}),t.show()}_startEditing(){const e=this.treeOutline;if(this._prompt||!e||!e._editable||this._readOnly)return;if(this._editableDiv=this._rowContainer.createChild("span","editable-div"),this.property.value){let e=this.property.value.description;"string"===this.property.value.type&&"string"==typeof e&&(e=`"${e}"`),this._editableDiv.setTextContentTruncatedIfNeeded(e,X(K.stringIsTooLargeToEdit))}const t=this._editableDiv.textContent||"";this.setExpandable(!1),this.listItemElement.classList.add("editing-sub-part"),this.valueElement.classList.add("hidden"),this._prompt=new oe;const n=this._prompt.attachAndStartEditing(this._editableDiv,this._editingCommitted.bind(this,t));n.classList.add("property-prompt");const i=this.listItemElement.getComponentSelection();i&&i.selectAllChildren(this._editableDiv),n.addEventListener("keydown",this._promptKeyDown.bind(this,t),!1)}_editingEnded(){this._prompt&&(this._prompt.detach(),delete this._prompt),this._editableDiv.remove(),this._updateExpandable(),this.listItemElement.scrollLeft=0,this.listItemElement.classList.remove("editing-sub-part"),this.select()}_editingCancelled(){this.valueElement.classList.remove("hidden"),this._editingEnded()}async _editingCommitted(e){const t=this._prompt?this._prompt.text():"";t!==e?(this._editingEnded(),await this._applyExpression(t)):this._editingCancelled()}_promptKeyDown(e,t){const n=t;return"Enter"===n.key?(n.consume(),void this._editingCommitted(e)):"Escape"===n.key?(n.consume(),void this._editingCancelled()):void 0}async _applyExpression(e){const t=P.RemoteObject.toCallArgument(this.property.symbol||this.property.name);if(e=U.wrapObjectLiteral(e.trim()),this.property.synthetic){let t=!1;if(e&&(t=await this.property.setSyntheticValue(e)),t){const e=this.parent;e&&(e.invalidateChildren(),e.onpopulate())}else this.update();return}const n=Z.get(this.property),i=e?n.setPropertyValue(t,e):n.deleteProperty(t);if(await i)this.update();else if(e){const e=this.parent;e&&(e.invalidateChildren(),e.onpopulate())}else this.parent&&this.parent.removeChild(this)}_onInvokeGetterClick(e){e.object&&(this.property.value=e.object,this.property.wasThrown=e.wasThrown||!1,this.update(),this.invalidateChildren(),this._updateExpandable())}_updateExpandable(){this.property.value?this.setExpandable(!this.property.value.customPreview()&&this.property.value.hasChildren&&!this.property.wasThrown):this.setExpandable(!1)}path(){return a.Tooltip.getContent(this.nameElement)}}class re extends l.TreeElement{constructor(e,t,n,i,s){super(f.sprintf("[%d … %d]",t,n),!0),this.toggleOnClick=!0,this._fromIndex=t,this._toIndex=n,this._object=e,this._readOnly=!0,this._propertyCount=i,this._linkifier=s}static async _populateArray(e,t,n,i,s){await re._populateRanges(e,t,n,i,!0,s)}static async _populateRanges(e,t,n,i,s,r){const o=await t.callFunctionJSON((function(e,t,n,i,s){if(void 0===e||void 0===t||void 0===i||void 0===s||void 0===n)return;let r=null;const o=t-e>=i&&ArrayBuffer.isView(this),a=o&&t-e>=s;function*l(n){if(void 0!==e&&void 0!==t&&void 0!==i&&void 0!==s)if(t-e<i)for(let i=e;i<=t;++i)i in n&&(yield i);else{r=r||Object.getOwnPropertyNames(n);for(let n=0;n<r.length;++n){const i=r[n],s=Number(i)>>>0;String(s)===i&&e<=s&&s<=t&&(yield s)}}}let c=0;if(o)c=t-e+1;else for(const e of l(this))++c;let p=c;p=c<=n?c:Math.pow(n,Math.ceil(Math.log(c)/Math.log(n))-1);const d=[];if(o)for(let n=e;n<=t;n+=p){const e=n;let i=e+p-1;i>t&&(i=t),d.push([e,i,i-e+1])}else{c=0;let e=-1,t=0;for(const n of l(this))-1===e&&(e=n),t=n,++c===p&&(d.push([e,t,c]),c=0,e=-1);c>0&&d.push([e,t,c])}return{ranges:d,skipGetOwnPropertyNames:a}}),[{value:n},{value:i},{value:re._bucketThreshold},{value:re._sparseIterationThreshold},{value:re._getOwnPropertyNamesThreshold}]);await async function(n){if(!n)return;const i=n.ranges;if(1===i.length)await re._populateAsFragment(e,t,i[0][0],i[0][1],r);else for(let n=0;n<i.length;++n){const s=i[n][0],o=i[n][1],a=i[n][2];s===o?await re._populateAsFragment(e,t,s,o,r):e.appendChild(new re(t,s,o,a,r))}s&&await re._populateNonIndexProperties(e,t,n.skipGetOwnPropertyNames,r)}(o)}static async _populateAsFragment(e,t,n,i,s){const r=await t.callFunction((function(e,t,n){const i=Object.create(null);if(void 0===e||void 0===t||void 0===n)return;if(t-e<n)for(let n=e;n<=t;++n)n in this&&(i[n]=this[n]);else{const n=Object.getOwnPropertyNames(this);for(let s=0;s<n.length;++s){const r=n[s],o=Number(r)>>>0;String(o)===r&&e<=o&&o<=t&&(i[o]=this[o])}}return i}),[{value:n},{value:i},{value:re._sparseIterationThreshold}]);if(!r.object||r.wasThrown)return;const o=r.object,a=await o.getAllProperties(!1,!0);o.release();const l=a.properties;if(l){l.sort(ee.CompareProperties);for(let t=0;t<l.length;++t){Z.set(l[t],this._object);const n=new se(l[t],s);n._readOnly=!0,e.appendChild(n)}}}static async _populateNonIndexProperties(e,t,n,i){const s=await t.callFunction((function(e){const t={__proto__:this.__proto__};if(e)return t;const n=Object.getOwnPropertyNames(this);for(let e=0;e<n.length;++e){const i=n[e];if(String(Number(i)>>>0)===i&&Number(i)>>>0!=4294967295)continue;const s=Object.getOwnPropertyDescriptor(this,i);s&&Object.defineProperty(t,i,s)}return t}),[{value:n}]);if(!s.object||s.wasThrown)return;const r=await s.object.getOwnProperties(!0);if(s.object.release(),!r.properties)return;const o=r.properties;o.sort(ee.CompareProperties);for(const t of o){if(Z.set(t,this._object),!ee._isDisplayableProperty(t,e.property))continue;const n=new se(t,i);n._readOnly=!0,e.appendChild(n)}}async onpopulate(){this._propertyCount>=re._bucketThreshold?await re._populateRanges(this,this._object,this._fromIndex,this._toIndex,!1,this._linkifier):await re._populateAsFragment(this,this._object,this._fromIndex,this._toIndex,this._linkifier)}onattach(){this.listItemElement.classList.add("object-properties-section-name")}}re._bucketThreshold=100,re._sparseIterationThreshold=25e4,re._getOwnPropertyNamesThreshold=5e5;class oe extends d.TextPrompt{constructor(){super();const e=F.instance();this.initialize(e.completionsForTextInCurrentContext.bind(e))}}const ae=new Map,le=new Map;class ce{constructor(e){this.element=e}appendApplicableItems(e,t,n){}}class pe extends ce{constructor(e,t,n){super(e);const i=e.createChild("span");this._text=t,this._maxLength=n,i.textContent=t.slice(0,n),a.Tooltip.install(i,t.slice(0,n)+"…"),this._expandElement=i.createChild("span"),this._maxDisplayableTextLength=1e7;const s=f.countWtf8Bytes(t),r=v.bytesToString(s);this._text.length<this._maxDisplayableTextLength?(this._expandElementText=X(K.showMoreS,{PH1:r}),this._expandElement.setAttribute("data-text",this._expandElementText),this._expandElement.classList.add("expandable-inline-button"),this._expandElement.addEventListener("click",this._expandText.bind(this)),this._expandElement.addEventListener("keydown",(e=>{const t=e;"Enter"!==t.key&&" "!==t.key||this._expandText()})),h.markAsButton(this._expandElement)):(this._expandElement.setAttribute("data-text",X(K.longTextWasTruncatedS,{PH1:r})),this._expandElement.classList.add("undisplayable-text")),this._copyButtonText=X(K.copy);const o=i.createChild("span","expandable-inline-button");o.setAttribute("data-text",this._copyButtonText),o.addEventListener("click",this._copyText.bind(this)),o.addEventListener("keydown",(e=>{const t=e;"Enter"!==t.key&&" "!==t.key||this._copyText()})),h.markAsButton(o)}appendApplicableItems(e,t,n){this._text.length<this._maxDisplayableTextLength&&this._expandElement&&t.clipboardSection().appendItem(this._expandElementText||"",this._expandText.bind(this)),t.clipboardSection().appendItem(this._copyButtonText,this._copyText.bind(this))}_expandText(){this._expandElement&&(this._expandElement.parentElement&&this._expandElement.parentElement.insertBefore(document.createTextNode(this._text.slice(this._maxLength)),this._expandElement),this._expandElement.remove(),this._expandElement=null)}_copyText(){g.InspectorFrontendHostInstance.copyText(this._text)}}var de=Object.freeze({__proto__:null,UIStrings:K,getObjectPropertiesSectionFrom:e=>Y.get(e),ObjectPropertiesSection:ee,maxRenderableStringLength:te,ObjectPropertiesSectionsTreeOutline:ne,RootElement:ie,InitialVisibleChildrenLimit:200,ObjectPropertyTreeElement:se,ArrayGroupingTreeElement:re,ObjectPropertyPrompt:oe,ObjectPropertiesSectionsTreeExpandController:class{constructor(e){this._expandedProperties=new Set,e.addEventListener(l.Events.ElementAttached,this._elementAttached,this),e.addEventListener(l.Events.ElementExpanded,this._elementExpanded,this),e.addEventListener(l.Events.ElementCollapsed,this._elementCollapsed,this)}watchSection(e,t){ae.set(t,e),this._expandedProperties.has(e)&&t.expand()}stopWatchSectionsWithId(e){for(const t of this._expandedProperties)t.startsWith(e+":")&&this._expandedProperties.delete(t)}_elementAttached(e){const t=e.data;t.isExpandable()&&this._expandedProperties.has(this._propertyPath(t))&&t.expand()}_elementExpanded(e){const t=e.data;this._expandedProperties.add(this._propertyPath(t))}_elementCollapsed(e){const t=e.data;this._expandedProperties.delete(this._propertyPath(t))}_propertyPath(e){const t=le.get(e);if(t)return t;let n=e,i=n;if(!e.treeOutline)throw new Error("No tree outline available");const s=e.treeOutline.rootElement();let r;for(;n!==s;){let e="";e=n.property?n.property.name:"string"==typeof n.title?n.title:n.title.textContent||"",r=e+(r?"."+r:""),i=n,n.parent&&(n=n.parent)}return r=ae.get(i)+(r?":"+r:""),le.set(e,r),r}},Renderer:class{render(e,t){if(!(e instanceof P.RemoteObject))return Promise.reject(new Error("Can't render "+e));const n=(t=t||{title:void 0,editable:void 0}).title,i=new ee(e,n);return n||i.titleLessMode(),i._editable=Boolean(t.editable),Promise.resolve({node:i.element,tree:i})}},ObjectPropertyValue:ce,ExpandableTextPropertyValue:pe,TreeOutlineOptions:undefined});const he={showAsJavascriptObject:"Show as JavaScript object"},ue=i.registerUIStrings("object_ui/CustomPreviewComponent.js",he),me=i.getLocalizedString.bind(void 0,ue);class be{constructor(e){this._sectionElement=document.createElement("span"),this._sectionElement.classList.add("custom-expandable-section"),this._object=e,this._expanded=!1,this._cachedContent=null;const t=e.customPreview();if(!t)return;let i;try{i=JSON.parse(t.header)}catch(e){return void n.Console.instance().error("Broken formatter: header is invalid json "+e)}this._header=this._renderJSONMLTag(i),this._header.nodeType!==Node.TEXT_NODE?(t.bodyGetterId&&(this._header instanceof Element&&this._header.classList.add("custom-expandable-section-header"),this._header.addEventListener("click",this._onClick.bind(this),!1),this._expandIcon=u.Icon.create("smallicon-triangle-right","custom-expand-icon"),this._header.insertBefore(this._expandIcon,this._header.firstChild)),this._sectionElement.appendChild(this._header)):n.Console.instance().error("Broken formatter: header should be an element node.")}element(){return this._sectionElement}_renderJSONMLTag(e){if(!Array.isArray(e))return document.createTextNode(String(e));const t=e;return"object"===t[0]?this._layoutObjectTag(t):this._renderElement(t)}_renderElement(e){const t=e.shift();if(!be._allowedTags.has(t))return n.Console.instance().error("Broken formatter: element "+t+" is not allowed!"),document.createElement("span");const i=document.createElement(t);if("object"==typeof e[0]&&!Array.isArray(e[0])){const t=e.shift();for(const e in t){const n=t[e];"style"===e&&"string"==typeof n&&i.setAttribute(e,n)}}return this._appendJsonMLTags(i,e),i}_layoutObjectTag(e){e.shift();const t=e.shift(),n=this._object.runtimeModel().createRemoteObject(t);if(n.customPreview())return new be(n).element();const i=ee.defaultObjectPresentation(n);return i.classList.toggle("custom-expandable-section-standard-section",n.hasChildren),i}_appendJsonMLTags(e,t){for(let n=0;n<t.length;++n)e.appendChild(this._renderJSONMLTag(t[n]))}_onClick(e){e.consume(!0),this._cachedContent?this._toggleExpand():this._loadBody()}_toggleExpand(){this._expanded=!this._expanded,this._header instanceof Element&&this._header.classList.toggle("expanded",this._expanded),this._cachedContent instanceof Element&&this._cachedContent.classList.toggle("hidden",!this._expanded),this._expandIcon&&(this._expanded?this._expandIcon.setIconType("smallicon-triangle-down"):this._expandIcon.setIconType("smallicon-triangle-right"))}async _loadBody(){const e=this._object.customPreview();if(e&&e.bodyGetterId){const t=await this._object.callFunctionJSON((e=>e()),[{objectId:e.bodyGetterId}]);if(!t)return;this._cachedContent=this._renderJSONMLTag(t),this._sectionElement.appendChild(this._cachedContent),this._toggleExpand()}}}class ye{constructor(e){this._object=e,this._customPreviewSection=new be(e),this.element=document.createElement("span"),this.element.classList.add("source-code");const t=c.createShadowRootWithCoreStyles(this.element,{cssFile:"object_ui/customPreviewComponent.css",enableLegacyPatching:!1,delegatesFocus:void 0});this.element.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),!1),t.appendChild(this._customPreviewSection.element())}expandIfPossible(){const e=this._object.customPreview();e&&e.bodyGetterId&&this._customPreviewSection&&this._customPreviewSection._loadBody()}_contextMenuEventFired(e){const t=new p.ContextMenu(e);this._customPreviewSection&&t.revealSection().appendItem(me(he.showAsJavascriptObject),this._disassemble.bind(this)),t.appendApplicableItems(this._object),t.show()}_disassemble(){this.element.shadowRoot&&(this.element.shadowRoot.textContent="",this._customPreviewSection=null,this.element.shadowRoot.appendChild(ee.defaultObjectPresentation(this._object)))}}be._allowedTags=new Set(["span","div","ol","li","table","tr","td"]);var _e=Object.freeze({__proto__:null,UIStrings:he,CustomPreviewSection:be,CustomPreviewComponent:ye});class ge{constructor(e,t){this._linkifier=e,this._resultHighlightedAsDOM=t}dispose(){this._resultHighlightedAsDOM&&j.OverlayModel.hideDOMNodeHighlight(),this._linkifier&&this._linkifier.dispose()}static async buildObjectPopover(e,t){const n=f.trimEndWithMaxLength(e.description||"",fe);let i=null;if("object"===e.type){let s=null,r=!1;if("node"===e.subtype&&(j.OverlayModel.highlightObjectAsDOMNode(e),r=!0),e.customPreview()){const t=new ye(e);t.expandIfPossible(),i=t.element}else{i=document.createElement("div"),i.classList.add("object-popover-content"),c.appendStyle(i,"object_ui/objectPopover.css",{enableLegacyPatching:!0});i.createChild("div","monospace object-popover-title").createChild("span").textContent=n,s=new L.Linkifier;const t=new ee(e,"",s,void 0,void 0,void 0,!0);t.element.classList.add("object-popover-tree"),t.titleLessMode(),i.appendChild(t.element)}return i.dataset.stableNameForTest="object-popover-content",t.setMaxContentSize(new m.Size(300,250)),t.setSizeBehavior(b.SizeBehavior.SetExactSize),t.contentElement.appendChild(i),new ge(s,r)}i=document.createElement("span"),i.dataset.stableNameForTest="object-popover-content",c.appendStyle(i,"object_ui/objectValue.css",{enableLegacyPatching:!0}),c.appendStyle(i,"object_ui/objectPopover.css",{enableLegacyPatching:!0});const s=i.createChild("span","monospace object-value-"+e.type);if(s.style.whiteSpace="pre","string"===e.type?o.createTextChildren(s,`"${n}"`):"function"!==e.type&&(s.textContent=n),"function"!==e.type)return t.contentElement.appendChild(i),new ge(null,!1);ee.formatObjectAsFunction(e,s,!0);const r=await e.debuggerModel().functionDetailsPromise(e);if(!r)return null;const a=document.createElement("div");a.classList.add("object-popover-container");const l=a.createChild("div","function-popover-title source-code");l.createChild("span","function-name").textContent=o.beautifyFunctionName(r.functionName);const p=r.location,d=l.createChild("div","function-title-link-container"),h=p&&p.script(),u=h&&h.sourceURL;let y=null;return u&&(y=new L.Linkifier(void 0,void 0,t.positionContent.bind(t)),d.appendChild(y.linkifyRawLocation(p,u))),a.appendChild(i),t.contentElement.appendChild(a),new ge(y,!1)}}const fe=1e4;var ve=Object.freeze({__proto__:null,ObjectPopoverHelper:ge});const xe=F.instance();export{_e as CustomPreviewComponent,D as JavaScriptAutocomplete,q as JavaScriptREPL,ve as ObjectPopoverHelper,de as ObjectPropertiesSection,J as RemoteObjectPreviewFormatter,xe as javaScriptAutocomplete};
